<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TimeClock Enterprise v2.0</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Barlow+Condensed:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>* { box-sizing:border-box; margin:0; padding:0; } body { background:#030712; }</style>
</head>
<body>
  <div id="root"></div>
  <script>
// ── Inline SVG Icon Components (no CDN dependency)
const AlertCircle = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'}}) );
const AlertTriangle = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>'}}) );
const ArrowDownRight = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="3 3 3 21 21 21"/><polyline points="18 15 21 18 18 21"/><line x1="21" y1="18" x2="9" y2="18"/><line x1="3" y1="3" x2="21" y2="21"/>'}}) );
const ArrowUpRight = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="3 3 21 3 21 21"/><polyline points="15 3 21 3 21 9"/><line x1="3" y1="21" x2="21" y2="3"/>'}}) );
const Building2 = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/>'}}) );
const CheckCircle = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>'}}) );
const ChevronDown = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="6 9 12 15 18 9"/>'}}) );
const ChevronRight = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="9 18 15 12 9 6"/>'}}) );
const ChevronUp = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="18 15 12 9 6 15"/>'}}) );
const ClipboardList = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><line x1="12" y1="11" x2="16" y2="11"/><line x1="12" y1="16" x2="16" y2="16"/><line x1="8" y1="11" x2="8.01" y2="11"/><line x1="8" y1="16" x2="8.01" y2="16"/>'}}) );
const Clock = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>'}}) );
const Cpu = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/>'}}) );
const Database = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>'}}) );
const DollarSign = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>'}}) );
const Edit = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>'}}) );
const LayoutDashboard = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/>'}}) );
const Loader2 = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M21 12a9 9 0 1 1-6.219-8.56"/>'}}) );
const Lock = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>'}}) );
const MapPin = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>'}}) );
const Navigation = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polygon points="3 11 22 2 13 21 11 13 3 11"/>'}}) );
const Plus = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>'}}) );
const RefreshCw = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>'}}) );
const Satellite = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M13 7 9 3 5 7l4 4"/><path d="m17 11 4 4-4 4-4-4"/><path d="m8 12 4 4 6-6-4-4Z"/><path d="m16 8 3-3"/><path d="M9 21a6 6 0 0 0-6-6"/>'}}) );
const Search = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>'}}) );
const Shield = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>'}}) );
const Trash2 = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>'}}) );
const Users = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>'}}) );
const X = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>'}}) );

const BarChart2 = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>'}}) );
const BarChart3 = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M3 3v18h18"/><path d="M7 16v-5"/><path d="M11 16V8"/><path d="M15 16v-2"/><path d="M19 16v-9"/>'}}) );
const Calendar = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>'}}) );
const CalendarDays = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><rect width="2" height="2" x="8" y="14"/><rect width="2" height="2" x="12" y="14"/><rect width="2" height="2" x="16" y="14"/>'}}) );
const Activity = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>'}}) );
const TrendingUp = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/>'}}) );
const TrendingDown = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/>'}}) );
const Layers = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/>'}}) );
const LogOut = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/>'}}) );
const Settings = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>'}}) );
const Terminal = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/>'}}) );
const Download = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>'}}) );
const Filter = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>'}}) );
const Eye = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/>'}}) );
const Wifi = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/>'}}) );
const WifiOff = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<line x1="1" y1="1" x2="23" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.56 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/>'}}) );
const Circle = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<circle cx="12" cy="12" r="10"/>'}}) );
const Briefcase = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>'}}) );
const CreditCard = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/>'}}) );
const FileText = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/>'}}) );
const Target = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/>'}}) );
const Globe = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>'}}) );
const Zap = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>'}}) );
const Radio = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<circle cx="12" cy="12" r="2"/><path d="M4.93 4.93a10 10 0 0 0 0 14.14"/><path d="M9.17 9.17a5 5 0 0 0 0 5.66"/><path d="M14.83 9.17a5 5 0 0 1 0 5.66"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>'}}) );
const Fingerprint = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4"/><path d="M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2"/><path d="M17.29 21.02c.12-.6.43-2.3.5-3.02"/><path d="M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4"/><path d="M8.65 22c.21-.66.45-1.32.57-2"/><path d="M14 13.12c0 2.38 0 6.38-1 8.88"/><path d="M2 16h.01"/><path d="M21.8 16c.2-2 .131-5.354 0-6"/><path d="M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2"/>'}}) );
const ScanLine = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/><line x1="7" y1="12" x2="17" y2="12"/>'}}) );
const Network = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<rect x="9" y="2" width="6" height="6" rx="1"/><rect x="16" y="16" width="6" height="6" rx="1"/><rect x="2" y="16" width="6" height="6" rx="1"/><path d="M5 16v-4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v4"/><line x1="12" y1="8" x2="12" y2="11"/>'}}) );
const GitBranch = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/>'}}) );
const PieChart = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/>'}}) );
const Inbox = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>'}}) );
const Bell = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/>'}}) );
const UserCheck = ({size=24,color="currentColor",style={}}) => React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:size,height:size,viewBox:"0 0 24 24",fill:"none",stroke:color,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",style},React.createElement("g",{dangerouslySetInnerHTML:{__html:'<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/>'}}) );

const { useState, useEffect, useCallback, useRef } = React;
// ═══════════════════════════════════════════════
//  DESIGN SYSTEM — AEROSPACE/HUD
// ═══════════════════════════════════════════════
const DS = {
    bg: "#030712",
    bgAlt: "#060d1a",
    surface: "#0a1628",
    surfaceHi: "#0d1f38",
    border: "#0d2847",
    borderHi: "#1a4a7a",
    glow: "#00d4ff",
    glowGreen: "#00ff88",
    glowAmber: "#ffaa00",
    glowRed: "#ff3366",
    glowPurple: "#a855f7",
    text: "#c9e4f8",
    textDim: "#4a7a9b",
    textMid: "#7ba8c8",
    mono: "'JetBrains Mono', 'Fira Code', monospace",
    sans: "'Barlow Condensed', 'IBM Plex Sans Condensed', sans-serif",
};
const glow = (color, px = 8) => `0 0 ${px}px ${color}44, 0 0 ${px * 3}px ${color}22`;
const glowStrong = (color) => `0 0 8px ${color}88, 0 0 24px ${color}44, 0 0 48px ${color}18`;
const insetGlow = (color) => `inset 0 0 20px ${color}08`;
// ═══════════════════════════════════════════════
//  TAX ENGINE (SAT MX + IRS California)
// ═══════════════════════════════════════════════
const SAT_ISR = [
    { li: 0, ls: 746.04, ff: 0, pct: 1.92 }, { li: 746.05, ls: 6332.05, ff: 14.32, pct: 6.40 },
    { li: 6332.06, ls: 11128.01, ff: 371.83, pct: 10.88 }, { li: 11128.02, ls: 12935.82, ff: 893.63, pct: 16.00 },
    { li: 12935.83, ls: 15487.71, ff: 1182.88, pct: 17.92 }, { li: 15487.72, ls: 31236.49, ff: 1640.18, pct: 21.36 },
    { li: 31236.50, ls: 49233.00, ff: 5004.12, pct: 23.52 }, { li: 49233.01, ls: 93993.90, ff: 9236.89, pct: 30.00 },
    { li: 93993.91, ls: 125325.20, ff: 22665.17, pct: 32.00 }, { li: 125325.21, ls: 375975.61, ff: 32691.18, pct: 34.00 },
    { li: 375975.62, ls: Infinity, ff: 117912.32, pct: 35.00 },
];
const SAT_SUBSIDIO = [
    { li: 0, ls: 1768.96, s: 407.02 }, { li: 1768.97, ls: 2653.38, s: 406.83 }, { li: 2653.39, ls: 3472.84, s: 406.62 },
    { li: 3472.85, ls: 3537.87, s: 392.77 }, { li: 3537.88, ls: 4446.15, s: 382.46 }, { li: 4446.16, ls: 4717.18, s: 354.23 },
    { li: 4717.19, ls: 5335.42, s: 324.87 }, { li: 5335.43, ls: 6224.67, s: 294.63 }, { li: 6224.68, ls: 7113.90, s: 253.54 },
    { li: 7113.91, ls: 7382.33, s: 217.61 }, { li: 7382.34, ls: Infinity, s: 0 },
];
const IRS_FED = [
    { li: 0, ls: 11925, r: .10 }, { li: 11925, ls: 48475, r: .12 }, { li: 48475, ls: 103350, r: .22 },
    { li: 103350, ls: 197300, r: .24 }, { li: 197300, ls: 250525, r: .32 }, { li: 250525, ls: 626350, r: .35 },
    { li: 626350, ls: Infinity, r: .37 },
];
const CA_FTB = [
    { li: 0, ls: 10756, r: .01 }, { li: 10756, ls: 25499, r: .02 }, { li: 25499, ls: 40245, r: .04 },
    { li: 40245, ls: 55866, r: .06 }, { li: 55866, ls: 70606, r: .08 }, { li: 70606, ls: 360659, r: .093 },
    { li: 360659, ls: 432787, r: .103 }, { li: 432787, ls: 721314, r: .113 }, { li: 721314, ls: Infinity, r: .123 },
];
const progTax = (income, brackets) => brackets.reduce((t, b) => {
    if (income <= b.li)
        return t;
    return t + (Math.min(income, b.ls) - b.li) * (b.r || b.rate || 0);
}, 0);
const calcIMSS = (sal) => {
    const sbc = Math.min(sal, 113.14 * 25 * 30);
    return { enf: sbc * .00375 + sbc * .0025, inv: sbc * .00625, ces: sbc * .01125,
        total: Math.round((sbc * .00375 + sbc * .0025 + sbc * .00625 + sbc * .01125) * 100) / 100 };
};
const calcMX = (salary, payroll) => {
    const div = payroll === "semanal" ? 4.33 : payroll === "quincenal" ? 2 : 1;
    const base = Math.round(salary / div);
    const imss = calcIMSS(salary);
    const baseISR = salary - imss.total;
    const row = SAT_ISR.find(r => baseISR >= r.li && baseISR <= r.ls) || SAT_ISR[SAT_ISR.length - 1];
    const isrBruto = Math.round((row.ff + (baseISR - row.li) * (row.pct / 100)) * 100) / 100;
    const subRow = SAT_SUBSIDIO.find(r => baseISR >= r.li && baseISR <= r.ls);
    const subsidio = subRow ? subRow.s : 0;
    const isrNeto = Math.max(0, isrBruto - subsidio);
    const f = 1 / div;
    const deds = {
        "ISR Art. 96 LISR": Math.round(isrNeto * f),
        "IMSS Enf. y Maternidad": Math.round(imss.enf * f),
        "IMSS Invalidez y Vida": Math.round(imss.inv * f),
        "IMSS Cesantía y Vejez": Math.round(imss.ces * f),
        "Subsidio al Empleo": -Math.round(subsidio * f),
    };
    const totalDed = Math.round((imss.total + isrNeto) * f);
    return { currency: "MXN", regime: "SAT MX", base, deds, totalDed, net: base - totalDed,
        effectiveRate: ((totalDed / base) * 100).toFixed(1) };
};
const calcUS = (salary, payroll) => {
    const periods = payroll === "weekly" ? 52 : payroll === "biweekly" ? 26 : 12;
    const annual = salary * periods;
    const fedAGI = Math.max(0, annual - 15000);
    const fedTax = progTax(fedAGI, IRS_FED);
    const ss = Math.min(annual, 176100) * .062;
    const med = annual * .0145 + Math.max(0, annual - 200000) * .009;
    const caAGI = Math.max(0, annual - 5363);
    const caState = progTax(caAGI, CA_FTB);
    const sdi = annual * .011;
    const fedPer = Math.round(fedTax / periods);
    const ssPer = Math.round(ss / periods);
    const medPer = Math.round(med / periods);
    const caPer = Math.round(caState / periods);
    const sdiPer = Math.round(sdi / periods);
    const totalDed = fedPer + ssPer + medPer + caPer + sdiPer;
    const deds = {
        "Federal Income Tax (IRS)": fedPer,
        "Social Security 6.2%": ssPer,
        "Medicare 1.45%": medPer,
        "CA State Tax (FTB)": caPer,
        "CA SDI 1.1%": sdiPer,
    };
    return { currency: "USD", regime: "IRS+CA", base: salary, deds, totalDed, net: salary - totalDed,
        effectiveRate: ((totalDed / salary) * 100).toFixed(1),
        fedRate: ((fedTax / annual) * 100).toFixed(1),
        caRate: ((caState / annual) * 100).toFixed(1) };
};
// ─────────────────────────────────────────────────────────
//  MOTOR FISCAL — REPÚBLICA DOMINICANA (DGII 2025)
//  Ley 11-92 · Resolución RES-DDG-AR1-2025-00001
//  TSS: SFS 3.04% + AFP 2.87% = 5.91% (Ley 87-01)
//  ISR: 4 tramos anuales, base = salario anual - TSS
// ─────────────────────────────────────────────────────────
const RD_ISR = [
    // { li, ls, ff (cuota fija anual), pct }
    { li: 0, ls: 416220, ff: 0, pct: 0 }, // exento
    { li: 416220.01, ls: 624329, ff: 0, pct: 15 }, // 15% sobre excedente
    { li: 624329.01, ls: 867123, ff: 31216, pct: 20 }, // RD$31,216 + 20% excedente
    { li: 867123.01, ls: Infinity, ff: 79776, pct: 25 }, // RD$79,776 + 25% excedente
];
const calcRD = (salary, payroll) => {
    // Períodos al año
    const periods = payroll === "semanal" ? 52 : payroll === "quincenal" ? 24 : payroll === "mensual" ? 12 : 12;
    const annual = salary * periods;
    // TSS empleado: SFS 3.04% + AFP 2.87% = 5.91%
    const sfsAmt = Math.round(annual * 0.0304 * 100) / 100;
    const afpAmt = Math.round(annual * 0.0287 * 100) / 100;
    const tssAmt = sfsAmt + afpAmt; // 5.91% sin tope (simplificado)
    // Base ISR anual = ingreso anual - TSS
    const baseISR = Math.max(0, annual - tssAmt);
    // ISR progresivo anual
    let isrAnual = 0;
    if (baseISR <= 416220) {
        isrAnual = 0;
    }
    else if (baseISR <= 624329) {
        isrAnual = (baseISR - 416220) * 0.15;
    }
    else if (baseISR <= 867123) {
        isrAnual = 31216 + (baseISR - 624329) * 0.20;
    }
    else {
        isrAnual = 79776 + (baseISR - 867123) * 0.25;
    }
    // Prorratear al período
    const isrPer = Math.round(isrAnual / periods);
    const sfsPer = Math.round(sfsAmt / periods);
    const afpPer = Math.round(afpAmt / periods);
    const totalDed = isrPer + sfsPer + afpPer;
    const deds = {
        "ISR DGII (Ley 11-92)": isrPer,
        "SFS Salud 3.04% (TSS)": sfsPer,
        "AFP Pensiones 2.87% (TSS)": afpPer,
    };
    return {
        currency: "DOP",
        regime: "DGII RD",
        base: salary,
        deds,
        totalDed,
        net: salary - totalDed,
        effectiveRate: ((totalDed / salary) * 100).toFixed(1),
        isrAnual: Math.round(isrAnual),
    };
};
// ─────────────────────────────────────────────────────────
//  MOTOR FISCAL — EL SALVADOR (MH · Decreto Nº 10, 2025)
//  ISR: Decreto Legislativo 293 · Art. 37 LISR (vigente 8-may-2025)
//  ISSS: 3% (tope $30/mes = base máx $1,000) · Ley ISSS
//  AFP:  7.25% sin tope · Ley del Sistema de Pensiones
//  Base ISR = salario bruto - ISSS - AFP
// ─────────────────────────────────────────────────────────
// Tabla mensual Decreto No. 10 (2025)
const SV_ISR_MENSUAL = [
    { desde: 0.01, hasta: 550.00, pct: 0, exceso: 0, fija: 0 }, // Sin retención
    { desde: 550.01, hasta: 895.24, pct: 10, exceso: 550.00, fija: 17.67 }, // 10% + $17.67
    { desde: 895.25, hasta: 2038.10, pct: 20, exceso: 895.24, fija: 60.00 }, // 20% + $60.00
    { desde: 2038.11, hasta: Infinity, pct: 30, exceso: 2038.10, fija: 288.57 }, // 30% + $288.57
];
// Tabla quincenal
const SV_ISR_QUINCENAL = [
    { desde: 0.01, hasta: 275.00, pct: 0, exceso: 0, fija: 0 },
    { desde: 275.01, hasta: 447.62, pct: 10, exceso: 275.00, fija: 8.83 },
    { desde: 447.63, hasta: 1019.05, pct: 20, exceso: 447.62, fija: 30.00 },
    { desde: 1019.06, hasta: Infinity, pct: 30, exceso: 1019.05, fija: 144.28 },
];
// Tabla semanal
const SV_ISR_SEMANAL = [
    { desde: 0.01, hasta: 137.50, pct: 0, exceso: 0, fija: 0 },
    { desde: 137.51, hasta: 223.81, pct: 10, exceso: 137.50, fija: 4.42 },
    { desde: 223.82, hasta: 509.52, pct: 20, exceso: 223.81, fija: 15.00 },
    { desde: 509.53, hasta: Infinity, pct: 30, exceso: 509.52, fija: 72.14 },
];
const svISRTable = (payroll) => payroll === "semanal" ? SV_ISR_SEMANAL :
    payroll === "quincenal" ? SV_ISR_QUINCENAL :
        SV_ISR_MENSUAL;
const calcSV = (salary, payroll) => {
    // ISSS: 3% con tope de $30 (base máxima $1,000)
    const isssBase = Math.min(salary, 1000);
    const isssMt = Math.round(isssBase * 0.03 * 100) / 100; // máx $30
    // AFP: 7.25% sin tope
    const afpMt = Math.round(salary * 0.0725 * 100) / 100;
    // Base gravable ISR = salario - ISSS - AFP
    const baseISR = Math.max(0, salary - isssMt - afpMt);
    // Aplicar tabla según período
    const tabla = svISRTable(payroll);
    const tramo = tabla.find(t => baseISR >= t.desde && baseISR <= t.hasta)
        || tabla[tabla.length - 1];
    const isrMt = tramo.pct === 0 ? 0
        : Math.round(((baseISR - tramo.exceso) * (tramo.pct / 100) + tramo.fija) * 100) / 100;
    const totalDed = Math.round((isssMt + afpMt + isrMt) * 100) / 100;
    const deds = {
        "ISR (Decreto Nº 10 · 2025)": isrMt,
        "ISSS Salud 3% (tope $30)": isssMt,
        "AFP Pensiones 7.25%": afpMt,
    };
    return {
        currency: "USD",
        regime: "MH El Salvador",
        base: salary,
        deds,
        totalDed,
        net: Math.round((salary - totalDed) * 100) / 100,
        effectiveRate: ((totalDed / salary) * 100).toFixed(1),
        tramo: tramo.pct > 0 ? `Tramo ${tramo.pct}%` : "Exento",
    };
};
// ─────────────────────────────────────────────────────────
//  DISPATCHER CENTRAL
// ─────────────────────────────────────────────────────────
const calcPayroll = (emp) => {
    const country = emp.country || "MX";
    if (country === "US")
        return calcUS(emp.salary, emp.payroll);
    if (country === "RD")
        return calcRD(emp.salary, emp.payroll);
    if (country === "SV")
        return calcSV(emp.salary, emp.payroll);
    return calcMX(emp.salary, emp.payroll); // MX default
};
// ═══════════════════════════════════════════════
//  SEED DATA
// ═══════════════════════════════════════════════
const SEED = {
    employees: [
        { id: "e1", name: "Ana García", dept: "d1", role: "Desarrolladora Senior", status: "active", payroll: "quincenal", salary: 25000, avatar: "AG", location: "l1", country: "MX", currency: "MXN", hireDate: "2021-03-15", pin: "1234" },
        { id: "e2", name: "Carlos López", dept: "d2", role: "Ejecutivo de Ventas", status: "active", payroll: "semanal", salary: 12000, avatar: "CL", location: "l2", country: "MX", currency: "MXN", hireDate: "2022-06-01", pin: "1234" },
        { id: "e3", name: "María Rodríguez", dept: "d3", role: "Coordinadora RRHH", status: "active", payroll: "quincenal", salary: 18000, avatar: "MR", location: "l1", country: "MX", currency: "MXN", hireDate: "2020-11-10", pin: "1234" },
        { id: "e4", name: "Roberto Martínez", dept: "d4", role: "Supervisor Ops", status: "inactive", payroll: "mensual", salary: 20000, avatar: "RM", location: "l3", country: "MX", currency: "MXN", hireDate: "2019-08-20", pin: "1234" },
        { id: "e5", name: "Sofía Hernández", dept: "d1", role: "UX Designer", status: "active", payroll: "quincenal", salary: 22000, avatar: "SH", location: "l1", country: "MX", currency: "MXN", hireDate: "2022-01-05", pin: "1234" },
        { id: "e6", name: "Diego Flores", dept: "d5", role: "Contador Senior", status: "active", payroll: "mensual", salary: 19000, avatar: "DF", location: "l1", country: "MX", currency: "MXN", hireDate: "2021-09-14", pin: "1234" },
        { id: "e7", name: "James Wilson", dept: "d1", role: "Senior Engineer", status: "active", payroll: "biweekly", salary: 9615, avatar: "JW", location: "l4", country: "US", currency: "USD", hireDate: "2022-04-11", pin: "1234" },
        { id: "e8", name: "Sarah Chen", dept: "d2", role: "Sales Manager", status: "active", payroll: "biweekly", salary: 7692, avatar: "SC", location: "l5", country: "US", currency: "USD", hireDate: "2023-02-14", pin: "1234" },
        { id: "e9", name: "Michael Torres", dept: "d4", role: "Operations Lead", status: "active", payroll: "biweekly", salary: 6154, avatar: "MT", location: "l4", country: "US", currency: "USD", hireDate: "2022-08-30", pin: "1234" },
    ],
    departments: [
        { id: "d1", name: "Tecnología", color: "#00d4ff", head: "e1", budget: 450000 },
        { id: "d2", name: "Ventas", color: "#00ff88", head: "e2", budget: 280000 },
        { id: "d3", name: "Recursos Humanos", color: "#ffaa00", head: "e3", budget: 180000 },
        { id: "d4", name: "Operaciones", color: "#a855f7", head: "e4", budget: 320000 },
        { id: "d5", name: "Finanzas", color: "#ff3366", head: "e6", budget: 220000 },
    ],
    locations: [
        { id: "l1", name: "CDMX HQ", address: "Av. Paseo de la Reforma 350, Col. Juárez, CDMX", lat: 19.4284, lng: -99.1639, radius: 150, country: "MX", timezone: "America/Mexico_City" },
        { id: "l2", name: "Monterrey Norte", address: "Av. Revolución 2703, Monterrey, NL", lat: 25.6866, lng: -100.3161, radius: 120, country: "MX", timezone: "America/Monterrey" },
        { id: "l3", name: "Guadalajara Sur", address: "Carretera Guadalajara-Chapala Km 6.5", lat: 20.6597, lng: -103.3496, radius: 200, country: "MX", timezone: "America/Mexico_City" },
        { id: "l4", name: "Los Angeles Office", address: "1100 Wilshire Blvd, Suite 800, Los Angeles, CA 90017", lat: 34.0522, lng: -118.2437, radius: 120, country: "US", timezone: "America/Los_Angeles" },
        { id: "l5", name: "San Francisco Office", address: "101 California St, Floor 12, San Francisco, CA 94111", lat: 37.7749, lng: -122.4194, radius: 100, country: "US", timezone: "America/Los_Angeles" },
    ],
    timeRecords: [
        { id: "t1", empId: "e1", date: "2025-02-24", entry: "08:02", exit: "17:15", type: "geocerca", hours: 9.2, status: "normal" },
        { id: "t2", empId: "e2", date: "2025-02-24", entry: "09:45", exit: "18:30", type: "manual", hours: 8.75, status: "tardanza" },
        { id: "t3", empId: "e3", date: "2025-02-24", entry: "07:58", exit: "17:00", type: "geocerca", hours: 9.03, status: "normal" },
        { id: "t4", empId: "e5", date: "2025-02-24", entry: "08:10", exit: "16:45", type: "geocerca", hours: 8.58, status: "normal" },
        { id: "t5", empId: "e6", date: "2025-02-24", entry: "10:00", exit: null, type: "manual", hours: null, status: "activo" },
        { id: "t6", empId: "e7", date: "2025-02-24", entry: "09:00", exit: "18:00", type: "geocerca", hours: 9.0, status: "normal" },
        { id: "t7", empId: "e8", date: "2025-02-24", entry: "08:30", exit: "17:30", type: "geocerca", hours: 9.0, status: "normal" },
        { id: "t8", empId: "e1", date: "2025-02-23", entry: "08:00", exit: "17:00", type: "geocerca", hours: 9.0, status: "normal" },
        { id: "t9", empId: "e2", date: "2025-02-23", entry: "08:30", exit: "17:30", type: "manual", hours: 9.0, status: "normal" },
    ],
    payrollCuts: [
        { id: "p1", period: "1-15 Feb 2025", type: "quincenal", country: "MX", employees: 5, grossTotal: 97000, totalDed: 14200, netTotal: 82800, status: "pagado", date: "2025-02-15", createdBy: "admin" },
        { id: "p2", period: "Sem 7 Feb 2025", type: "semanal", country: "MX", employees: 1, grossTotal: 12000, totalDed: 2100, netTotal: 9900, status: "pendiente", date: "2025-02-21", createdBy: "admin" },
        { id: "p3", period: "Ene 2025", type: "mensual", country: "all", employees: 3, grossTotal: 45000, totalDed: 8900, netTotal: 36100, status: "pagado", date: "2025-01-31", createdBy: "admin" },
    ],
};
// ═══════════════════════════════════════════════
//  AUTH — CREDENTIALS & HOOK
// ═══════════════════════════════════════════════
const ADMIN_USERS = [
    { id: "admin", username: "admin", password: "admin123", name: "Administrador", role: "superadmin" },
    { id: "rrhh", username: "rrhh", password: "rrhh2025", name: "RRHH Manager", role: "admin" },
];
const AUTH_KEY = "timeclock-auth-session";
const useAuth = () => {
    const [session, setSession] = useState(() => {
        try {
            const s = localStorage.getItem(AUTH_KEY);
            return s ? JSON.parse(s) : null;
        }
        catch (_a) {
            return null;
        }
    });
    const loginAdmin = (username, password) => {
        const user = ADMIN_USERS.find(u => u.username === username && u.password === password);
        if (!user)
            return false;
        const s = { type: "admin", user, ts: Date.now() };
        localStorage.setItem(AUTH_KEY, JSON.stringify(s));
        setSession(s);
        return true;
    };
    const loginEmployee = (emp) => {
        const s = { type: "employee", user: emp, ts: Date.now() };
        localStorage.setItem(AUTH_KEY, JSON.stringify(s));
        setSession(s);
    };
    const logout = () => {
        localStorage.removeItem(AUTH_KEY);
        setSession(null);
    };
    return { session, loginAdmin, loginEmployee, logout };
};
// ═══════════════════════════════════════════════
//  LOGIN SCREEN
// ═══════════════════════════════════════════════
const LoginScreen = ({ db, onLoginAdmin, onLoginEmployee }) => {
    var _a;
    const [mode, setMode] = useState(null); // null | "admin" | "employee"
    const [username, setUsername] = useState("");
    const [password, setPassword] = useState("");
    const [showPass, setShowPass] = useState(false);
    const [empSearch, setEmpSearch] = useState("");
    const [selEmp, setSelEmp] = useState(null);
    const [pin, setPin] = useState("");
    const [error, setError] = useState("");
    const [clock, setClock] = useState(new Date());
    useEffect(() => {
        const t = setInterval(() => setClock(new Date()), 1000);
        return () => clearInterval(t);
    }, []);
    const handleAdminLogin = () => {
        if (!username || !password) {
            setError("Completa todos los campos.");
            return;
        }
        const ok = onLoginAdmin(username, password);
        if (!ok)
            setError("Credenciales incorrectas.");
    };
    const handleEmpLogin = () => {
        if (!selEmp) {
            setError("Selecciona tu nombre.");
            return;
        }
        if (pin.length !== 4) {
            setError("El PIN debe ser de 4 dígitos.");
            return;
        }
        const stored = ((db === null || db === void 0 ? void 0 : db.employees) || []).find(e => e.id === selEmp.id);
        const correctPin = (stored === null || stored === void 0 ? void 0 : stored.pin) || "1234";
        if (pin !== correctPin) {
            setError("PIN incorrecto.");
            setPin("");
            return;
        }
        onLoginEmployee(selEmp);
    };
    const handlePinKey = (digit) => {
        if (pin.length < 4)
            setPin(p => p + digit);
    };
    const handlePinDel = () => setPin(p => p.slice(0, -1));
    const empList = ((db === null || db === void 0 ? void 0 : db.employees) || [])
        .filter(e => e.status === "active")
        .filter(e => !empSearch || e.name.toLowerCase().includes(empSearch.toLowerCase()));
    const timeStr = clock.toLocaleTimeString("es-MX", { hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false });
    const dateStr = clock.toLocaleDateString("es-MX", { weekday: "long", year: "numeric", month: "long", day: "numeric" }).toUpperCase();
    return (React.createElement("div", { style: { background: DS.bg, minHeight: "100vh", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", fontFamily: DS.sans, color: DS.text, position: "relative", overflow: "hidden" } },
        React.createElement("div", { style: { position: "fixed", inset: 0, pointerEvents: "none", zIndex: 0,
                backgroundImage: `linear-gradient(${DS.border}44 1px, transparent 1px), linear-gradient(90deg, ${DS.border}44 1px, transparent 1px)`,
                backgroundSize: "48px 48px" } }),
        React.createElement("div", { style: { position: "fixed", inset: 0, pointerEvents: "none", zIndex: 0,
                background: `radial-gradient(ellipse 60% 50% at 50% 50%, ${DS.glow}08 0%, transparent 70%)` } }),
        React.createElement("div", { style: { position: "fixed", top: 20, left: 20, width: 40, height: 40, borderTop: `2px solid ${DS.glow}66`, borderLeft: `2px solid ${DS.glow}66` } }),
        React.createElement("div", { style: { position: "fixed", top: 20, right: 20, width: 40, height: 40, borderTop: `2px solid ${DS.glow}66`, borderRight: `2px solid ${DS.glow}66` } }),
        React.createElement("div", { style: { position: "fixed", bottom: 20, left: 20, width: 40, height: 40, borderBottom: `2px solid ${DS.glow}66`, borderLeft: `2px solid ${DS.glow}66` } }),
        React.createElement("div", { style: { position: "fixed", bottom: 20, right: 20, width: 40, height: 40, borderBottom: `2px solid ${DS.glow}66`, borderRight: `2px solid ${DS.glow}66` } }),
        React.createElement("div", { style: { position: "fixed", top: 0, left: 0, right: 0, height: 52, borderBottom: `1px solid ${DS.border}`, display: "flex", alignItems: "center", justifyContent: "space-between", padding: "0 28px", zIndex: 10 } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12 } },
                React.createElement("div", { style: { position: "relative", width: 28, height: 28 } },
                    React.createElement("div", { style: { position: "absolute", inset: 0, borderRadius: "50%", border: `1px dashed ${DS.glow}55`, animation: "spin 8s linear infinite" } }),
                    React.createElement("div", { style: { position: "absolute", inset: "28%", borderRadius: "50%", background: DS.glow, boxShadow: glowStrong(DS.glow) } })),
                React.createElement("span", { style: { fontFamily: DS.sans, fontWeight: 800, fontSize: 15, letterSpacing: "0.15em", color: DS.text } }, "TIMECLOCK"),
                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.glowGreen, letterSpacing: "0.1em", border: `1px solid ${DS.glowGreen}44`, padding: "2px 8px" } }, "ENTERPRISE v2.0")),
            React.createElement("div", { style: { textAlign: "right" } },
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 20, fontWeight: 900, color: DS.glow, letterSpacing: "0.05em", lineHeight: 1 } }, timeStr),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, marginTop: 2 } }, dateStr))),
        !mode && (React.createElement("div", { style: { position: "relative", zIndex: 1, textAlign: "center", maxWidth: 560, width: "100%", padding: "0 24px" } },
            React.createElement("div", { style: { marginBottom: 8, fontFamily: DS.mono, fontSize: 10, color: DS.glow, letterSpacing: "0.2em" } }, "ACCESO AL SISTEMA"),
            React.createElement("div", { style: { marginBottom: 40, fontFamily: DS.sans, fontSize: 28, fontWeight: 900, color: DS.text, letterSpacing: "0.06em" } }, "IDENTIFICACI\u00D3N"),
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 } },
                React.createElement("button", { onClick: () => { setMode("employee"); setError(""); }, style: { background: DS.surface, border: `1px solid ${DS.glowGreen}44`, padding: "32px 20px", cursor: "pointer", textAlign: "center", position: "relative", transition: "all .2s", boxShadow: `0 0 0 0 ${DS.glowGreen}` }, onMouseEnter: e => e.currentTarget.style.boxShadow = `0 0 24px ${DS.glowGreen}22`, onMouseLeave: e => e.currentTarget.style.boxShadow = "none" },
                    React.createElement(HudCorner, { pos: "tl", color: DS.glowGreen, size: 10 }),
                    React.createElement(HudCorner, { pos: "tr", color: DS.glowGreen, size: 10 }),
                    React.createElement(HudCorner, { pos: "bl", color: DS.glowGreen, size: 10 }),
                    React.createElement(HudCorner, { pos: "br", color: DS.glowGreen, size: 10 }),
                    React.createElement("div", { style: { width: 64, height: 64, borderRadius: "50%", border: `2px solid ${DS.glowGreen}66`, margin: "0 auto 16px", display: "flex", alignItems: "center", justifyContent: "center", background: `${DS.glowGreen}10` } },
                        React.createElement(Users, { size: 28, color: DS.glowGreen })),
                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 800, color: DS.glowGreen, letterSpacing: "0.1em", marginBottom: 6 } }, "EMPLEADO"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, lineHeight: 1.6 } },
                        "Registra tu entrada",
                        React.createElement("br", null),
                        "y salida con PIN")),
                React.createElement("button", { onClick: () => { setMode("admin"); setError(""); }, style: { background: DS.surface, border: `1px solid ${DS.glow}44`, padding: "32px 20px", cursor: "pointer", textAlign: "center", position: "relative", transition: "all .2s" }, onMouseEnter: e => e.currentTarget.style.boxShadow = `0 0 24px ${DS.glow}22`, onMouseLeave: e => e.currentTarget.style.boxShadow = "none" },
                    React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 10 }),
                    React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 10 }),
                    React.createElement(HudCorner, { pos: "bl", color: DS.glow, size: 10 }),
                    React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 10 }),
                    React.createElement("div", { style: { width: 64, height: 64, borderRadius: "50%", border: `2px solid ${DS.glow}66`, margin: "0 auto 16px", display: "flex", alignItems: "center", justifyContent: "center", background: `${DS.glow}10` } },
                        React.createElement(Shield, { size: 28, color: DS.glow })),
                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 800, color: DS.glow, letterSpacing: "0.1em", marginBottom: 6 } }, "ADMINISTRADOR"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, lineHeight: 1.6 } },
                        "Acceso completo",
                        React.createElement("br", null),
                        "al sistema"))),
            React.createElement("div", { style: { marginTop: 24, fontFamily: DS.mono, fontSize: 9, color: DS.textDim } },
                "PIN DEMO EMPLEADOS: ",
                React.createElement("span", { style: { color: DS.glowAmber } }, "1234"),
                "\u00A0\u00B7\u00A0 ADMIN: ",
                React.createElement("span", { style: { color: DS.glowAmber } }, "admin / admin123")))),
        mode === "admin" && (React.createElement("div", { style: { position: "relative", zIndex: 1, width: "100%", maxWidth: 400, padding: "0 24px" } },
            React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.borderHi}`, padding: "32px 28px", position: "relative", boxShadow: `0 0 40px ${DS.glow}12` } },
                React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 12 }),
                React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 12 }),
                React.createElement(HudCorner, { pos: "bl", color: DS.glow, size: 12 }),
                React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 12 }),
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 24 } },
                    React.createElement("div", { style: { width: 2, height: 18, background: DS.glow, boxShadow: glow(DS.glow) } }),
                    React.createElement(Shield, { size: 16, color: DS.glow }),
                    React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 15, fontWeight: 800, color: DS.text, letterSpacing: "0.12em" } }, "ACCESO ADMINISTRATIVO")),
                error && (React.createElement("div", { style: { marginBottom: 14, padding: "8px 12px", background: `${DS.glowRed}10`, border: `1px solid ${DS.glowRed}44`, display: "flex", gap: 8, alignItems: "center" } },
                    React.createElement(AlertCircle, { size: 12, color: DS.glowRed }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.glowRed } }, error))),
                React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 14 } },
                    React.createElement("div", null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginBottom: 6, letterSpacing: "0.1em" } }, "USUARIO"),
                        React.createElement("input", { value: username, onChange: e => { setUsername(e.target.value); setError(""); }, onKeyDown: e => e.key === "Enter" && handleAdminLogin(), placeholder: "admin", style: { width: "100%", padding: "10px 12px", background: DS.bg, border: `1px solid ${DS.borderHi}`, color: DS.text, fontFamily: DS.mono, fontSize: 13, outline: "none", boxSizing: "border-box" } })),
                    React.createElement("div", null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginBottom: 6, letterSpacing: "0.1em" } }, "CONTRASE\u00D1A"),
                        React.createElement("div", { style: { position: "relative" } },
                            React.createElement("input", { value: password, onChange: e => { setPassword(e.target.value); setError(""); }, onKeyDown: e => e.key === "Enter" && handleAdminLogin(), type: showPass ? "text" : "password", placeholder: "\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022", style: { width: "100%", padding: "10px 38px 10px 12px", background: DS.bg, border: `1px solid ${DS.borderHi}`, color: DS.text, fontFamily: DS.mono, fontSize: 13, outline: "none", boxSizing: "border-box" } }),
                            React.createElement("button", { onClick: () => setShowPass(p => !p), style: { position: "absolute", right: 10, top: "50%", transform: "translateY(-50%)", background: "none", border: "none", cursor: "pointer", color: DS.textDim } },
                                React.createElement(Eye, { size: 14 }))))),
                React.createElement("button", { onClick: handleAdminLogin, style: { marginTop: 22, width: "100%", padding: "12px", background: `${DS.glow}18`, border: `1px solid ${DS.glow}66`, color: DS.glow, fontFamily: DS.mono, fontSize: 13, fontWeight: 900, cursor: "pointer", letterSpacing: "0.08em", display: "flex", alignItems: "center", justifyContent: "center", gap: 8 } },
                    React.createElement(Lock, { size: 14 }),
                    " INGRESAR AL SISTEMA"),
                React.createElement("button", { onClick: () => { setMode(null); setError(""); setUsername(""); setPassword(""); }, style: { marginTop: 10, width: "100%", padding: "8px", background: "transparent", border: "none", color: DS.textDim, fontFamily: DS.mono, fontSize: 10, cursor: "pointer" } }, "\u2190 VOLVER")))),
        mode === "employee" && (React.createElement("div", { style: { position: "relative", zIndex: 1, width: "100%", maxWidth: 480, padding: "0 24px" } },
            React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.borderHi}`, padding: "28px", position: "relative", boxShadow: `0 0 40px ${DS.glowGreen}10` } },
                React.createElement(HudCorner, { pos: "tl", color: DS.glowGreen, size: 12 }),
                React.createElement(HudCorner, { pos: "tr", color: DS.glowGreen, size: 12 }),
                React.createElement(HudCorner, { pos: "bl", color: DS.glowGreen, size: 12 }),
                React.createElement(HudCorner, { pos: "br", color: DS.glowGreen, size: 12 }),
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 20 } },
                    React.createElement("div", { style: { width: 2, height: 18, background: DS.glowGreen, boxShadow: glow(DS.glowGreen) } }),
                    React.createElement(Users, { size: 16, color: DS.glowGreen }),
                    React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 15, fontWeight: 800, color: DS.text, letterSpacing: "0.12em" } }, "ACCESO EMPLEADO")),
                error && (React.createElement("div", { style: { marginBottom: 12, padding: "8px 12px", background: `${DS.glowRed}10`, border: `1px solid ${DS.glowRed}44`, display: "flex", gap: 8, alignItems: "center" } },
                    React.createElement(AlertCircle, { size: 12, color: DS.glowRed }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.glowRed } }, error))),
                !selEmp ? (React.createElement("div", null,
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginBottom: 8, letterSpacing: "0.1em" } }, "BUSCA TU NOMBRE"),
                    React.createElement("div", { style: { position: "relative", marginBottom: 12 } },
                        React.createElement(Search, { size: 12, color: DS.textDim, style: { position: "absolute", left: 10, top: "50%", transform: "translateY(-50%)" } }),
                        React.createElement("input", { value: empSearch, onChange: e => setEmpSearch(e.target.value), placeholder: "Escribe tu nombre...", autoFocus: true, style: { width: "100%", padding: "9px 12px 9px 30px", background: DS.bg, border: `1px solid ${DS.borderHi}`, color: DS.text, fontFamily: DS.mono, fontSize: 12, outline: "none", boxSizing: "border-box" } })),
                    React.createElement("div", { style: { maxHeight: 240, overflowY: "auto", display: "flex", flexDirection: "column", gap: 6 } },
                        empList.length === 0 && (React.createElement("div", { style: { padding: 16, textAlign: "center", fontFamily: DS.mono, fontSize: 10, color: DS.textDim } }, "SIN RESULTADOS")),
                        empList.map(emp => {
                            const dept = ((db === null || db === void 0 ? void 0 : db.departments) || []).find(d => d.id === emp.dept);
                            return (React.createElement("button", { key: emp.id, onClick: () => { setSelEmp(emp); setError(""); setPin(""); }, style: { display: "flex", alignItems: "center", gap: 12, padding: "10px 12px", background: DS.surface, border: `1px solid ${DS.border}`, cursor: "pointer", textAlign: "left" }, onMouseEnter: e => e.currentTarget.style.borderColor = DS.glowGreen, onMouseLeave: e => e.currentTarget.style.borderColor = DS.border },
                                React.createElement(Avatar, { initials: emp.avatar || "??", color: (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glowGreen, size: 36 }),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 700, color: DS.text } }, emp.name),
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } },
                                        emp.role,
                                        " \u00B7 ",
                                        (dept === null || dept === void 0 ? void 0 : dept.name) || "—")),
                                React.createElement(ChevronRight, { size: 14, color: DS.textDim, style: { marginLeft: "auto" } })));
                        })))) : (
                /* Step 2: PIN entry */
                React.createElement("div", null,
                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12, padding: "12px 14px", background: DS.surface, border: `1px solid ${DS.glowGreen}44`, marginBottom: 20 } },
                        React.createElement(Avatar, { initials: selEmp.avatar || "??", color: ((_a = ((db === null || db === void 0 ? void 0 : db.departments) || []).find(d => d.id === selEmp.dept)) === null || _a === void 0 ? void 0 : _a.color) || DS.glowGreen, size: 44 }),
                        React.createElement("div", { style: { flex: 1 } },
                            React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 800, color: DS.text } }, selEmp.name),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, selEmp.role)),
                        React.createElement("button", { onClick: () => { setSelEmp(null); setPin(""); setError(""); }, style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer" } },
                            React.createElement(X, { size: 14 }))),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, textAlign: "center", marginBottom: 14, letterSpacing: "0.15em" } }, "INGRESA TU PIN DE 4 D\u00CDGITOS"),
                    React.createElement("div", { style: { display: "flex", gap: 12, justifyContent: "center", marginBottom: 20 } }, [0, 1, 2, 3].map(i => (React.createElement("div", { key: i, style: { width: 18, height: 18, borderRadius: "50%", border: `2px solid ${pin.length > i ? DS.glowGreen : DS.border}`, background: pin.length > i ? DS.glowGreen : "transparent", boxShadow: pin.length > i ? glowStrong(DS.glowGreen) : "none", transition: "all .15s" } })))),
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 8, maxWidth: 240, margin: "0 auto" } }, [1, 2, 3, 4, 5, 6, 7, 8, 9, "", 0, "⌫"].map((k, i) => (React.createElement("button", { key: i, onClick: () => { if (k === "⌫")
                            handlePinDel();
                        else if (k !== "")
                            handlePinKey(String(k)); setError(""); }, style: { padding: "16px 0", background: k === "⌫" ? `${DS.glowRed}10` : DS.surface, border: `1px solid ${k === "⌫" ? DS.glowRed + "44" : DS.border}`, color: k === "⌫" ? DS.glowRed : DS.text, fontFamily: DS.mono, fontSize: 18, fontWeight: 700, cursor: k === "" ? "default" : "pointer", opacity: k === "" ? 0 : 1 }, disabled: k === "" }, k)))),
                    React.createElement("button", { onClick: handleEmpLogin, disabled: pin.length !== 4, style: { marginTop: 16, width: "100%", padding: "12px", background: pin.length === 4 ? `${DS.glowGreen}20` : "transparent", border: `1px solid ${pin.length === 4 ? DS.glowGreen + "66" : DS.border}`, color: pin.length === 4 ? DS.glowGreen : DS.textDim, fontFamily: DS.mono, fontSize: 13, fontWeight: 900, cursor: pin.length === 4 ? "pointer" : "not-allowed", letterSpacing: "0.08em", display: "flex", alignItems: "center", justifyContent: "center", gap: 8, transition: "all .2s" } },
                        React.createElement(CheckCircle, { size: 15 }),
                        " ENTRAR"))),
                React.createElement("button", { onClick: () => { setMode(null); setError(""); setSelEmp(null); setPin(""); setEmpSearch(""); }, style: { marginTop: 12, width: "100%", padding: "8px", background: "transparent", border: "none", color: DS.textDim, fontFamily: DS.mono, fontSize: 10, cursor: "pointer" } }, "\u2190 VOLVER")))),
        React.createElement("div", { style: { position: "fixed", bottom: 12, left: 0, right: 0, textAlign: "center", fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.15em", zIndex: 1 } }, "TIMECLOCK ENTERPRISE \u00B7 SISTEMA DE CONTROL DE ASISTENCIA")));
};
// ═══════════════════════════════════════════════
//  EMPLOYEE PORTAL — Vista del empleado al hacer login
// ═══════════════════════════════════════════════
const EmployeePortal = ({ db, session, addTimeRecord, updateTimeRecord, onLogout }) => {
    const emp = session.user;
    const dept = ((db === null || db === void 0 ? void 0 : db.departments) || []).find(d => d.id === emp.dept);
    const color = (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glowGreen;
    const today = new Date().toISOString().slice(0, 10);
    const [clock, setClock] = useState(new Date());
    const [checando, setChecando] = useState(false);
    const [done, setDone] = useState(null); // "entrada" | "salida"
    useEffect(() => {
        const t = setInterval(() => setClock(new Date()), 1000);
        return () => clearInterval(t);
    }, []);
    // Active shift today
    const activeShift = ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).find(r => r.empId === emp.id && r.date === today && !r.exit);
    // All shifts this month
    const myRecords = ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).filter(r => r.empId === emp.id).slice(0, 15);
    const timeStr = clock.toLocaleTimeString("es-MX", { hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false });
    const dateStr = clock.toLocaleDateString("es-MX", { weekday: "long", year: "numeric", month: "long", day: "numeric" }).toUpperCase();
    const handleCheck = () => {
        setChecando(true);
        const now = new Date();
        const nowStr = now.toTimeString().slice(0, 5);
        const action = activeShift ? "salida" : "entrada";
        setTimeout(() => {
            if (action === "entrada") {
                const status = parseInt(nowStr.split(":")[0]) >= 9 && parseInt(nowStr.split(":")[1]) > 5 ? "tardanza" : "normal";
                addTimeRecord({ empId: emp.id, date: today, entry: nowStr, exit: null, type: "portal", hours: null, status, approved: true });
            }
            else {
                const hours = Number(((now - new Date(`${today}T${activeShift.entry}`)) / 3600000).toFixed(2));
                updateTimeRecord(activeShift.id, { exit: nowStr, hours, approvedExit: true });
            }
            setChecando(false);
            setDone(action);
            setTimeout(() => setDone(null), 4000);
        }, 1200);
    };
    const payCalc = calcPayroll(emp);
    return (React.createElement("div", { style: { background: DS.bg, minHeight: "100vh", fontFamily: DS.sans, color: DS.text } },
        React.createElement("div", { style: { background: DS.bgAlt, borderBottom: `1px solid ${DS.border}`, padding: "0 28px", height: 56, display: "flex", alignItems: "center", justifyContent: "space-between" } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12 } },
                React.createElement("div", { style: { position: "relative", width: 24, height: 24 } },
                    React.createElement("div", { style: { position: "absolute", inset: 0, borderRadius: "50%", border: `1px dashed ${DS.glow}55`, animation: "spin 8s linear infinite" } }),
                    React.createElement("div", { style: { position: "absolute", inset: "28%", borderRadius: "50%", background: DS.glow, boxShadow: glowStrong(DS.glow) } })),
                React.createElement("span", { style: { fontFamily: DS.sans, fontWeight: 800, fontSize: 13, letterSpacing: "0.15em", color: DS.text } }, "TIMECLOCK")),
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 14 } },
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                    React.createElement(Avatar, { initials: emp.avatar || "??", color: color, size: 30 }),
                    React.createElement("div", null,
                        React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 12, fontWeight: 700, color: DS.text } }, emp.name),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, emp.role))),
                React.createElement("button", { onClick: onLogout, style: { display: "flex", alignItems: "center", gap: 6, padding: "6px 12px", background: "transparent", border: `1px solid ${DS.textDim}44`, color: DS.textDim, fontFamily: DS.mono, fontSize: 10, cursor: "pointer" } },
                    React.createElement(LogOut, { size: 11 }),
                    " SALIR"))),
        React.createElement("div", { style: { maxWidth: 700, margin: "0 auto", padding: "32px 24px" } },
            React.createElement("div", { style: { textAlign: "center", marginBottom: 36 } },
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 52, fontWeight: 900, color: DS.glow, letterSpacing: "0.05em", lineHeight: 1, textShadow: glowStrong(DS.glow) } }, timeStr),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim, marginTop: 6, letterSpacing: "0.15em" } }, dateStr)),
            activeShift ? (React.createElement("div", { style: { marginBottom: 24, padding: "14px 20px", background: `${DS.glowAmber}10`, border: `1px solid ${DS.glowAmber}44`, display: "flex", alignItems: "center", gap: 14 } },
                React.createElement("div", { style: { width: 10, height: 10, borderRadius: "50%", background: DS.glowAmber, boxShadow: glowStrong(DS.glowAmber), animation: "ping 2s ease-in-out infinite" } }),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 800, color: DS.glowAmber } }, "EN TURNO ACTIVO"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim, marginTop: 2 } },
                        "Entrada registrada a las ",
                        React.createElement("b", { style: { color: DS.glowAmber } }, activeShift.entry),
                        " ",
                        "\u00B7",
                        " ",
                        "Horas transcurridas: ",
                        React.createElement("b", { style: { color: DS.glowAmber } },
                            Math.max(0, ((clock - new Date(`${today}T${activeShift.entry}`)) / 3600000)).toFixed(1),
                            "h"))))) : (React.createElement("div", { style: { marginBottom: 24, padding: "14px 20px", background: `${DS.glowGreen}08`, border: `1px solid ${DS.glowGreen}33`, display: "flex", alignItems: "center", gap: 14 } },
                React.createElement("div", { style: { width: 10, height: 10, borderRadius: "50%", background: DS.glowGreen, boxShadow: glowStrong(DS.glowGreen) } }),
                React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 800, color: DS.glowGreen } }, "SIN TURNO ACTIVO \u2014 Registra tu entrada"))),
            done && (React.createElement("div", { style: { marginBottom: 24, padding: "16px 20px", background: `${DS.glowGreen}14`, border: `1px solid ${DS.glowGreen}66`, display: "flex", alignItems: "center", gap: 12, animation: "none" } },
                React.createElement(CheckCircle, { size: 20, color: DS.glowGreen }),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 15, fontWeight: 800, color: DS.glowGreen } }, done === "entrada" ? "¡ENTRADA REGISTRADA!" : "¡SALIDA REGISTRADA!"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim, marginTop: 2 } }, new Date().toLocaleTimeString("es-MX", { hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false }))))),
            React.createElement("div", { style: { textAlign: "center", marginBottom: 36 } },
                React.createElement("button", { onClick: handleCheck, disabled: checando, style: {
                        position: "relative", width: 180, height: 180, borderRadius: "50%",
                        background: activeShift ? `radial-gradient(circle, ${DS.glowRed}20, ${DS.bg})` : `radial-gradient(circle, ${DS.glowGreen}20, ${DS.bg})`,
                        border: `2px solid ${activeShift ? DS.glowRed : DS.glowGreen}88`,
                        cursor: checando ? "wait" : "pointer",
                        boxShadow: `0 0 40px ${activeShift ? DS.glowRed : DS.glowGreen}22, 0 0 80px ${activeShift ? DS.glowRed : DS.glowGreen}10`,
                        display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", gap: 8,
                        transition: "all .2s",
                    } },
                    React.createElement("div", { style: { position: "absolute", inset: -6, borderRadius: "50%", border: `1px dashed ${activeShift ? DS.glowRed : DS.glowGreen}44`, animation: "spin 8s linear infinite" } }),
                    React.createElement("div", { style: { position: "absolute", inset: -14, borderRadius: "50%", border: `1px dashed ${activeShift ? DS.glowRed : DS.glowGreen}22`, animation: "spin 14s linear infinite reverse" } }),
                    checando ? (React.createElement(Loader2, { size: 36, color: activeShift ? DS.glowRed : DS.glowGreen, style: { animation: "spin 1s linear infinite" } })) : activeShift ? (React.createElement(React.Fragment, null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowRed, fontWeight: 900, letterSpacing: "0.15em" } }, "REGISTRAR"),
                        React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 22, fontWeight: 900, color: DS.glowRed, letterSpacing: "0.08em" } }, "SALIDA"))) : (React.createElement(React.Fragment, null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowGreen, fontWeight: 900, letterSpacing: "0.15em" } }, "REGISTRAR"),
                        React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 22, fontWeight: 900, color: DS.glowGreen, letterSpacing: "0.08em" } }, "ENTRADA"))))),
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 12, marginBottom: 28 } }, [
                { label: "Días este mes", value: myRecords.filter(r => { var _a; return (_a = r.date) === null || _a === void 0 ? void 0 : _a.startsWith(today.slice(0, 7)); }).length, color: DS.glow },
                { label: "Horas totales", value: myRecords.reduce((s, r) => s + (r.hours || 0), 0).toFixed(1) + "h", color: DS.glowGreen },
                { label: "Tardanzas", value: myRecords.filter(r => r.status === "tardanza").length, color: DS.glowRed },
            ].map(({ label, value, color: c }) => (React.createElement("div", { key: label, style: { background: DS.surface, border: `1px solid ${DS.border}`, padding: "16px 14px", textAlign: "center" } },
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 22, fontWeight: 900, color: c, lineHeight: 1 } }, value),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, marginTop: 4, letterSpacing: "0.1em" } }, label.toUpperCase()))))),
            React.createElement("div", { style: { background: DS.surface, border: `1px solid ${DS.border}`, overflow: "hidden" } },
                React.createElement("div", { style: { padding: "12px 16px", borderBottom: `1px solid ${DS.border}`, display: "flex", alignItems: "center", gap: 8 } },
                    React.createElement(Clock, { size: 12, color: DS.glow }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, fontWeight: 700, color: DS.glow, letterSpacing: "0.1em" } }, "MIS REGISTROS RECIENTES")),
                myRecords.length === 0 ? (React.createElement("div", { style: { padding: 24, textAlign: "center", fontFamily: DS.mono, fontSize: 10, color: DS.textDim } }, "SIN REGISTROS A\u00DAN")) : (React.createElement("table", { style: { width: "100%", borderCollapse: "collapse" } },
                    React.createElement("thead", null,
                        React.createElement("tr", { style: { background: DS.bgAlt } }, ["Fecha", "Entrada", "Salida", "Horas", "Estado"].map(h => (React.createElement("th", { key: h, style: { padding: "8px 14px", textAlign: "left", fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.1em", fontWeight: 700, borderBottom: `1px solid ${DS.border}` } }, h))))),
                    React.createElement("tbody", null, myRecords.map((r, i) => (React.createElement("tr", { key: r.id, style: { borderBottom: `1px solid ${DS.border}`, background: i % 2 === 0 ? "transparent" : DS.bgAlt + "66" } },
                        React.createElement("td", { style: { padding: "9px 14px", fontFamily: DS.mono, fontSize: 11, color: DS.text } }, r.date),
                        React.createElement("td", { style: { padding: "9px 14px", fontFamily: DS.mono, fontSize: 11, color: DS.glowGreen, fontWeight: 700 } }, r.entry || "—"),
                        React.createElement("td", { style: { padding: "9px 14px", fontFamily: DS.mono, fontSize: 11, color: r.exit ? DS.glowRed : DS.glowAmber, fontWeight: 700 } }, r.exit || "EN TURNO"),
                        React.createElement("td", { style: { padding: "9px 14px", fontFamily: DS.mono, fontSize: 11, color: DS.text } }, r.hours ? `${r.hours}h` : "—"),
                        React.createElement("td", { style: { padding: "9px 14px" } },
                            React.createElement("span", { style: { padding: "2px 8px", border: `1px solid ${r.status === "tardanza" ? DS.glowRed : r.status === "activo" ? DS.glowAmber : DS.glowGreen}44`, fontFamily: DS.mono, fontSize: 8, color: r.status === "tardanza" ? DS.glowRed : r.status === "activo" ? DS.glowAmber : DS.glowGreen } }, (r.status || "normal").toUpperCase()))))))))),
            React.createElement("div", { style: { marginTop: 16, padding: "14px 18px", background: DS.bgAlt, border: `1px solid ${DS.border}`, display: "flex", gap: 20, flexWrap: "wrap", alignItems: "center" } },
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.1em", marginRight: 4 } }, "MI N\u00D3MINA ESTIMADA"),
                payCalc && [
                    ["Bruto", `${payCalc.currency} $${payCalc.base.toLocaleString()}`, DS.textMid],
                    ["Deducc.", `-$${payCalc.totalDed.toLocaleString()}`, DS.glowRed],
                    ["NETO", `${payCalc.currency} $${payCalc.net.toLocaleString()}`, DS.glowGreen],
                    ["Régimen", payCalc.regime, DS.glow],
                ].map(([l, v, c]) => (React.createElement("div", { key: l },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 7, color: DS.textDim } }, l),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 12, fontWeight: 800, color: c } }, v))))))));
};
const STORAGE_KEY = "timeclock-v2-data";
const persist = (data) => {
    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    catch (e) { }
};
const useDB = () => {
    const [db, setDb] = useState(null);
    const [loading, setLoading] = useState(true);
    // Keep a ref so callbacks always see latest db without stale closure
    const dbRef = useRef(null);
    useEffect(() => {
        const init = () => {
            try {
                const _raw = localStorage.getItem(STORAGE_KEY);
                const stored = _raw ? { value: _raw } : null;
                if (stored === null || stored === void 0 ? void 0 : stored.value) {
                    const parsed = JSON.parse(stored.value);
                    dbRef.current = parsed;
                    setDb(parsed);
                }
                else {
                    dbRef.current = SEED;
                    setDb(SEED);
                    persist(SEED);
                }
            }
            catch (_a) {
                dbRef.current = SEED;
                setDb(SEED);
            }
            setLoading(false);
        };
        init();
    }, []);
    const commit = useCallback((next) => {
        dbRef.current = next;
        setDb(Object.assign({}, next)); // new reference forces re-render
        persist(next);
    }, []);
    const upsertEmployee = useCallback((emp) => {
        const cur = dbRef.current;
        const isNew = !emp.id || !cur.employees.find(e => e.id === emp.id);
        const record = isNew
            ? Object.assign(Object.assign({}, emp), { id: "e" + Date.now() }) : Object.assign({}, emp);
        const next = Object.assign(Object.assign({}, cur), { employees: isNew
                ? [...cur.employees, record]
                : cur.employees.map(e => e.id === emp.id ? record : e) });
        commit(next);
    }, [commit]);
    const deleteEmployee = useCallback((id) => {
        const cur = dbRef.current;
        commit(Object.assign(Object.assign({}, cur), { employees: cur.employees.filter(e => e.id !== id) }));
    }, [commit]);
    const upsertLocation = useCallback((loc) => {
        const cur = dbRef.current;
        const isNew = !loc.id || !cur.locations.find(l => l.id === loc.id);
        const record = isNew
            ? Object.assign(Object.assign({}, loc), { id: "l" + Date.now() }) : Object.assign({}, loc);
        const next = Object.assign(Object.assign({}, cur), { locations: isNew
                ? [...cur.locations, record]
                : cur.locations.map(l => l.id === loc.id ? record : l) });
        commit(next);
    }, [commit]);
    const deleteLocation = useCallback((id) => {
        const cur = dbRef.current;
        commit(Object.assign(Object.assign({}, cur), { locations: cur.locations.filter(l => l.id !== id) }));
    }, [commit]);
    const upsertDepartment = useCallback((dept) => {
        const cur = dbRef.current;
        const isNew = !dept.id || !cur.departments.find(d => d.id === dept.id);
        const record = isNew
            ? Object.assign(Object.assign({}, dept), { id: "d" + Date.now() }) : Object.assign({}, dept);
        const next = Object.assign(Object.assign({}, cur), { departments: isNew
                ? [...cur.departments, record]
                : cur.departments.map(d => d.id === dept.id ? record : d) });
        commit(next);
    }, [commit]);
    const deleteDepartment = useCallback((id) => {
        const cur = dbRef.current;
        commit(Object.assign(Object.assign({}, cur), { departments: cur.departments.filter(d => d.id !== id) }));
    }, [commit]);
    const addTimeRecord = useCallback((rec) => {
        const cur = dbRef.current;
        const record = Object.assign(Object.assign({}, rec), { id: "t" + Date.now() });
        commit(Object.assign(Object.assign({}, cur), { timeRecords: [record, ...cur.timeRecords] }));
    }, [commit]);
    const updateTimeRecord = useCallback((id, patch) => {
        const cur = dbRef.current;
        commit(Object.assign(Object.assign({}, cur), { timeRecords: cur.timeRecords.map(r => r.id === id ? Object.assign(Object.assign({}, r), patch) : r) }));
    }, [commit]);
    const savePayrollCut = useCallback((cut) => {
        const cur = dbRef.current;
        const record = Object.assign(Object.assign({}, cut), { id: "p" + Date.now() });
        commit(Object.assign(Object.assign({}, cur), { payrollCuts: [record, ...cur.payrollCuts] }));
    }, [commit]);
    const resetDB = useCallback(() => {
        commit(SEED);
    }, [commit]);
    return { db, loading, upsertEmployee, deleteEmployee, upsertLocation, deleteLocation, upsertDepartment, deleteDepartment, addTimeRecord, updateTimeRecord, savePayrollCut, resetDB };
};
// ═══════════════════════════════════════════════
//  DESIGN COMPONENTS
// ═══════════════════════════════════════════════
const HudCorner = ({ pos = "tl", size = 10, color = DS.glow }) => {
    const styles = {
        tl: { top: 0, left: 0, borderTop: `1.5px solid ${color}`, borderLeft: `1.5px solid ${color}` },
        tr: { top: 0, right: 0, borderTop: `1.5px solid ${color}`, borderRight: `1.5px solid ${color}` },
        bl: { bottom: 0, left: 0, borderBottom: `1.5px solid ${color}`, borderLeft: `1.5px solid ${color}` },
        br: { bottom: 0, right: 0, borderBottom: `1.5px solid ${color}`, borderRight: `1.5px solid ${color}` },
    };
    return React.createElement("div", { style: Object.assign({ position: "absolute", width: size, height: size }, styles[pos]) });
};
const Panel = ({ children, style, glowColor = DS.glow, noPad }) => (React.createElement("div", { style: Object.assign({ background: DS.surface, border: `1px solid ${DS.border}`, borderRadius: 2, position: "relative", padding: noPad ? 0 : "20px 22px", boxShadow: `${insetGlow(glowColor)}, 0 4px 24px rgba(0,0,0,0.4)` }, style) },
    React.createElement(HudCorner, { pos: "tl", color: glowColor }),
    React.createElement(HudCorner, { pos: "tr", color: glowColor }),
    React.createElement(HudCorner, { pos: "bl", color: glowColor }),
    React.createElement(HudCorner, { pos: "br", color: glowColor }),
    children));
const Tag = ({ label, value, color = DS.glow }) => (React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 4 } },
    React.createElement("span", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em", textTransform: "uppercase" } }, label),
    React.createElement("span", { style: { fontSize: 10, color, fontFamily: DS.mono, fontWeight: 700 } }, value)));
const StatusDot = ({ status }) => {
    const c = status === "active" || status === "normal" || status === "pagado" ? DS.glowGreen
        : status === "activo" ? DS.glow
            : status === "tardanza" || status === "pendiente" ? DS.glowAmber
                : DS.glowRed;
    return (React.createElement("span", { style: { position: "relative", display: "inline-flex", alignItems: "center", justifyContent: "center", width: 10, height: 10 } },
        React.createElement("span", { style: { position: "absolute", width: 10, height: 10, borderRadius: "50%", background: c, opacity: .3, animation: "ping 1.8s ease infinite" } }),
        React.createElement("span", { style: { width: 6, height: 6, borderRadius: "50%", background: c, boxShadow: `0 0 6px ${c}` } })));
};
const Chip = ({ children, color = DS.glow }) => (React.createElement("span", { style: {
        display: "inline-flex", alignItems: "center", gap: 4,
        padding: "2px 8px", borderRadius: 1,
        background: `${color}12`, border: `1px solid ${color}33`,
        color, fontSize: 10, fontFamily: DS.mono, fontWeight: 700,
        letterSpacing: "0.06em", textTransform: "uppercase",
    } }, children));
const Avatar = ({ initials, color = DS.glow, size = 36 }) => (React.createElement("div", { style: {
        width: size, height: size, borderRadius: 1, flexShrink: 0,
        background: `${color}10`, border: `1px solid ${color}40`,
        display: "flex", alignItems: "center", justifyContent: "center",
        fontSize: size * .3, fontWeight: 800, color, fontFamily: DS.mono,
        boxShadow: `0 0 12px ${color}20`,
        letterSpacing: "0.05em",
    } }, initials));
const KpiCard = ({ icon: Icon, label, value, sub, color = DS.glow, trend }) => (React.createElement(Panel, { glowColor: color, style: { overflow: "hidden" } },
    React.createElement("div", { style: { position: "absolute", bottom: -10, right: -10, opacity: .04 } },
        React.createElement(Icon, { size: 80, color: color })),
    React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "flex-start" } },
        React.createElement("div", { style: { width: 32, height: 32, border: `1px solid ${color}44`, borderRadius: 1, display: "flex", alignItems: "center", justifyContent: "center" } },
            React.createElement(Icon, { size: 16, color: color })),
        trend != null && (React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 3, fontSize: 10, color: trend >= 0 ? DS.glowGreen : DS.glowRed, fontFamily: DS.mono } },
            trend >= 0 ? React.createElement(ArrowUpRight, { size: 10 }) : React.createElement(ArrowDownRight, { size: 10 }),
            Math.abs(trend),
            "%"))),
    React.createElement("div", { style: { marginTop: 16, fontFamily: DS.mono, fontSize: 26, fontWeight: 800, color, lineHeight: 1, letterSpacing: "-0.02em" } }, value),
    React.createElement("div", { style: { marginTop: 6, fontSize: 10, color: DS.textDim, fontFamily: DS.sans, letterSpacing: "0.08em", textTransform: "uppercase" } }, label),
    sub && React.createElement("div", { style: { marginTop: 4, fontSize: 10, color: DS.textMid, fontFamily: DS.mono } }, sub)));
const Btn = ({ children, onClick, color = DS.glow, variant = "primary", size = "md", icon: Icon, disabled }) => {
    const pad = size === "sm" ? "5px 12px" : "9px 18px";
    const fs = size === "sm" ? 11 : 13;
    return (React.createElement("button", { onClick: disabled ? undefined : onClick, style: {
            display: "inline-flex", alignItems: "center", gap: 6,
            padding: pad, borderRadius: 1, cursor: disabled ? "not-allowed" : "pointer",
            fontSize: fs, fontFamily: DS.mono, fontWeight: 700, letterSpacing: "0.06em",
            border: `1px solid ${color}${disabled ? "22" : "66"}`,
            background: variant === "primary" ? `${color}18` : "transparent",
            color: disabled ? DS.textDim : color,
            boxShadow: disabled ? "none" : `0 0 12px ${color}18`,
            transition: "all .15s", opacity: disabled ? .6 : 1,
        } },
        Icon && React.createElement(Icon, { size: fs - 1 }),
        children));
};
const Input = ({ label, value, onChange, type = "text", options, placeholder, required }) => (React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 5 } },
    label && React.createElement("label", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em", textTransform: "uppercase" } },
        label,
        required && React.createElement("span", { style: { color: DS.glowRed } }, " *")),
    type === "select" ? (React.createElement("select", { value: value, onChange: e => onChange(e.target.value), style: {
            background: DS.bgAlt, border: `1px solid ${DS.border}`, borderRadius: 1,
            color: DS.text, fontSize: 12, fontFamily: DS.mono, padding: "8px 10px",
            outline: "none", colorScheme: "dark",
        } }, options === null || options === void 0 ? void 0 : options.map(o => React.createElement("option", { key: o.v, value: o.v }, o.l)))) : (React.createElement("input", { type: type, value: value, onChange: e => onChange(e.target.value), placeholder: placeholder, style: {
            background: DS.bgAlt, border: `1px solid ${DS.border}`, borderRadius: 1,
            color: DS.text, fontSize: 12, fontFamily: DS.mono, padding: "8px 10px",
            outline: "none", width: "100%", boxSizing: "border-box",
        } }))));
const Modal = ({ title, children, onClose, width = 560 }) => (React.createElement("div", { style: {
        position: "fixed", inset: 0, background: "rgba(3,7,18,.88)",
        display: "flex", alignItems: "center", justifyContent: "center",
        zIndex: 1000, backdropFilter: "blur(8px)",
    }, onClick: onClose },
    React.createElement(Panel, { style: { width, maxHeight: "88vh", overflow: "auto" }, onClick: e => e.stopPropagation() },
        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 } },
            React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 15, fontWeight: 700, color: DS.text, letterSpacing: "0.1em", textTransform: "uppercase" } }, title),
            React.createElement("button", { onClick: onClose, style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer", display: "flex" } },
                React.createElement(X, { size: 16 }))),
        children)));
const Drawer = ({ title, children, onClose }) => (React.createElement("div", { style: {
        position: "fixed", inset: 0, background: "rgba(3,7,18,.7)",
        display: "flex", justifyContent: "flex-end",
        zIndex: 1000, backdropFilter: "blur(4px)",
    }, onClick: onClose },
    React.createElement("div", { style: {
            width: 520, background: DS.bgAlt, borderLeft: `1px solid ${DS.borderHi}`,
            overflowY: "auto", padding: "28px 28px",
            boxShadow: `-8px 0 40px rgba(0,0,0,.5)`,
        }, onClick: e => e.stopPropagation() },
        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 } },
            React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 700, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, title),
            React.createElement("button", { onClick: onClose, style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer", display: "flex" } },
                React.createElement(X, { size: 16 }))),
        children)));
const SectionHeader = ({ icon: Icon, label, action }) => (React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 20 } },
    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
        React.createElement("div", { style: { width: 2, height: 18, background: DS.glow, boxShadow: glow(DS.glow, 4) } }),
        React.createElement(Icon, { size: 15, color: DS.glow }),
        React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 700, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, label)),
    action));
// ═══════════════════════════════════════════════
//  TABLE COMPONENT
// ═══════════════════════════════════════════════
const Table = ({ cols, rows }) => (React.createElement("div", { style: { overflowX: "auto" } },
    React.createElement("table", { style: { width: "100%", borderCollapse: "collapse" } },
        React.createElement("thead", null,
            React.createElement("tr", { style: { borderBottom: `1px solid ${DS.border}` } }, cols.map(c => (React.createElement("th", { key: c.key, style: { padding: "8px 14px", textAlign: "left", fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.12em", textTransform: "uppercase", whiteSpace: "nowrap" } }, c.label))))),
        React.createElement("tbody", null, rows.map((row, i) => (React.createElement("tr", { key: i, style: { borderBottom: `1px solid ${DS.border}44`, transition: "background .1s" }, onMouseEnter: e => e.currentTarget.style.background = `${DS.glow}06`, onMouseLeave: e => e.currentTarget.style.background = "transparent" }, cols.map(c => (React.createElement("td", { key: c.key, style: { padding: "11px 14px", fontSize: 12, color: DS.text, fontFamily: c.mono ? DS.mono : "inherit", whiteSpace: "nowrap" } }, c.render ? c.render(row) : row[c.key]))))))))));
// ═══════════════════════════════════════════════
//  VIEWS
// ═══════════════════════════════════════════════
const ViewDashboard = ({ db }) => {
    const [clock, setClock] = useState(new Date());
    useEffect(() => { const t = setInterval(() => setClock(new Date()), 1000); return () => clearInterval(t); }, []);
    if (!db)
        return null;
    const activeEmps = db.employees.filter(e => e.status === "active");
    const todayRecs = db.timeRecords.filter(r => r.date === "2025-02-24");
    const openRecs = todayRecs.filter(r => !r.exit);
    const lateRecs = todayRecs.filter(r => r.status === "tardanza");
    const pendingCuts = db.payrollCuts.filter(p => p.status === "pendiente");
    return (React.createElement("div", null,
        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 28 } },
            React.createElement("div", null,
                React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 24, fontWeight: 800, color: DS.text, letterSpacing: "0.06em", textTransform: "uppercase" } }, "SISTEMA ACTIVO"),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim, marginTop: 3 } }, clock.toLocaleDateString("es-MX", { weekday: "long", year: "numeric", month: "long", day: "numeric" }).toUpperCase())),
            React.createElement(Panel, { style: { padding: "12px 20px", display: "flex", gap: 24, alignItems: "center" } },
                React.createElement("div", { style: { textAlign: "center" } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 28, fontWeight: 900, color: DS.glow, lineHeight: 1, letterSpacing: "0.05em" } }, clock.toLocaleTimeString("es-MX", { hour: "2-digit", minute: "2-digit", second: "2-digit" })),
                    React.createElement("div", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em", marginTop: 3 } }, "UTC-6 / CDMX")),
                React.createElement("div", { style: { width: 1, height: 40, background: DS.border } }),
                React.createElement("div", { style: { textAlign: "center" } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 20, fontWeight: 900, color: DS.glowGreen, lineHeight: 1 } }, clock.toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit", second: "2-digit", timeZone: "America/Los_Angeles" })),
                    React.createElement("div", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em", marginTop: 3 } }, "PST / LA")))),
        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 14, marginBottom: 22 } },
            React.createElement(KpiCard, { icon: Users, label: "Empleados Activos", value: activeEmps.length, sub: `${db.employees.length} total`, color: DS.glow, trend: 5 }),
            React.createElement(KpiCard, { icon: UserCheck, label: "Presentes Hoy", value: `${todayRecs.length}`, sub: `${openRecs.length} en turno`, color: DS.glowGreen, trend: 2 }),
            React.createElement(KpiCard, { icon: AlertTriangle, label: "Tardanzas", value: lateRecs.length, sub: "d\u00EDa de hoy", color: DS.glowAmber, trend: -12 }),
            React.createElement(KpiCard, { icon: CreditCard, label: "Cortes Pendientes", value: pendingCuts.length, sub: `${db.payrollCuts.length} total`, color: DS.glowPurple })),
        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1.4fr 1fr", gap: 16 } },
            React.createElement(Panel, null,
                React.createElement(SectionHeader, { icon: Clock, label: "Registros de Tiempo \u2014 Hoy" }),
                React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } }, todayRecs.slice(0, 6).map(r => {
                    const emp = db.employees.find(e => e.id === r.empId);
                    if (!emp)
                        return null;
                    const dept = db.departments.find(d => d.id === emp.dept);
                    return (React.createElement("div", { key: r.id, style: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "9px 12px", background: DS.bgAlt, border: `1px solid ${DS.border}` } },
                        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                            React.createElement(Avatar, { initials: emp.avatar, color: (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glow, size: 32 }),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: DS.text, fontFamily: DS.mono } }, emp.name),
                                React.createElement("div", { style: { fontSize: 10, color: DS.textDim } }, emp.role))),
                        React.createElement("div", { style: { display: "flex", gap: 8, alignItems: "center" } },
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowGreen } }, r.entry),
                            React.createElement("span", { style: { color: DS.textDim, fontSize: 10 } }, "\u2192"),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: r.exit ? DS.glowRed : DS.glowAmber } }, r.exit || "ACTIVO"),
                            React.createElement(StatusDot, { status: r.status }),
                            React.createElement(Chip, { color: r.type === "geocerca" ? DS.glowPurple : DS.glow }, r.type === "geocerca" ? "GEO" : "MAN"))));
                }))),
            React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 14 } },
                React.createElement(Panel, null,
                    React.createElement(SectionHeader, { icon: Building2, label: "Departamentos" }),
                    db.departments.map(dept => {
                        const count = db.employees.filter(e => e.dept === dept.id && e.status === "active").length;
                        const maxCount = Math.max(...db.departments.map(d => db.employees.filter(e => e.dept === d.id && e.status === "active").length));
                        return (React.createElement("div", { key: dept.id, style: { marginBottom: 10 } },
                            React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 4 } },
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid } }, dept.name),
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: dept.color, fontWeight: 700 } },
                                    count,
                                    " EMP")),
                            React.createElement("div", { style: { height: 3, background: DS.bgAlt, borderRadius: 0 } },
                                React.createElement("div", { style: { height: "100%", width: `${(count / maxCount) * 100}%`, background: dept.color, boxShadow: `0 0 8px ${dept.color}88`, transition: "width 1s ease" } }))));
                    })),
                React.createElement(Panel, { glowColor: DS.glowAmber },
                    React.createElement(SectionHeader, { icon: Globe, label: "Cobertura Global" }),
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 } },
                        React.createElement("div", { style: { padding: "12px 14px", background: DS.bgAlt, border: `1px solid ${DS.border}` } },
                            React.createElement("div", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em" } }, "MEXICO"),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 20, fontWeight: 800, color: DS.glowGreen, marginTop: 4 } }, db.employees.filter(e => e.country === "MX" && e.status === "active").length),
                            React.createElement("div", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono } }, "SAT \u00B7 LISR \u00B7 IMSS")),
                        React.createElement("div", { style: { padding: "12px 14px", background: DS.bgAlt, border: `1px solid ${DS.border}` } },
                            React.createElement("div", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em" } }, "CALIFORNIA"),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 20, fontWeight: 800, color: DS.glow, marginTop: 4 } }, db.employees.filter(e => e.country === "US" && e.status === "active").length),
                            React.createElement("div", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono } }, "IRS \u00B7 CA FTB \u00B7 SDI"))))))));
};
// Standalone overlay — must NOT be defined inside another component
const EmpModalOverlay = ({ onClose, children }) => (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.9)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000, backdropFilter: "blur(8px)" }, onClick: onClose },
    React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.borderHi}`, borderRadius: 2, width: 600, maxHeight: "90vh", overflowY: "auto", padding: 28, position: "relative", boxShadow: `0 0 40px ${DS.glow}18` }, onClick: e => e.stopPropagation() },
        React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "bl", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 12 }),
        children)));
const ViewEmployees = ({ db, upsertEmployee, deleteEmployee }) => {
    const [search, setSearch] = useState("");
    const [modal, setModal] = useState(false);
    const [editMode, setEditMode] = useState(false);
    const [form, setForm] = useState({});
    const [confirm, setConfirm] = useState(null);
    const [saved, setSaved] = useState(false);
    const [error, setError] = useState("");
    const filtered = ((db === null || db === void 0 ? void 0 : db.employees) || []).filter(e => {
        var _a;
        return e.name.toLowerCase().includes(search.toLowerCase()) ||
            (((_a = db.departments.find(d => d.id === e.dept)) === null || _a === void 0 ? void 0 : _a.name) || "").toLowerCase().includes(search.toLowerCase());
    });
    const openNew = () => {
        setError("");
        setForm({
            name: "", dept: "d1", role: "", salary: "",
            payroll: "quincenal", location: "l1",
            country: "MX", currency: "MXN",
            status: "active",
            hireDate: new Date().toISOString().slice(0, 10)
        });
        setEditMode(false);
        setModal(true);
    };
    const openEdit = (emp) => {
        setError("");
        setForm(Object.assign(Object.assign({}, emp), { salary: String(emp.salary) }));
        setEditMode(true);
        setModal(true);
    };
    const handleSave = () => {
        if (!form.name.trim()) {
            setError("El nombre es requerido.");
            return;
        }
        if (!form.role.trim()) {
            setError("El puesto es requerido.");
            return;
        }
        if (!form.salary || isNaN(Number(form.salary)) || Number(form.salary) <= 0) {
            setError("El salario debe ser un número mayor a 0.");
            return;
        }
        setError("");
        const avatar = form.name.trim().split(" ").map(n => n[0]).join("").toUpperCase().slice(0, 2);
        const record = Object.assign(Object.assign(Object.assign({}, form), { salary: Number(form.salary), avatar }), (editMode && form.id ? { id: form.id } : {}));
        upsertEmployee(record);
        setSaved(true);
        setTimeout(() => setSaved(false), 2500);
        setModal(false);
    };
    const handleDelete = (id) => {
        deleteEmployee(id);
        setConfirm(null);
    };
    const deptOpts = ((db === null || db === void 0 ? void 0 : db.departments) || []).map(d => ({ v: d.id, l: d.name }));
    const locOpts = ((db === null || db === void 0 ? void 0 : db.locations) || []).map(l => ({ v: l.id, l: l.name }));
    return (React.createElement("div", null,
        React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 20 } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                React.createElement("div", { style: { width: 2, height: 18, background: DS.glow, boxShadow: glow(DS.glow, 4) } }),
                React.createElement(Users, { size: 15, color: DS.glow }),
                React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 700, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, "Gesti\u00F3n de Empleados"),
                React.createElement(Chip, { color: DS.textDim },
                    db.employees.length,
                    " TOTAL")),
            React.createElement("button", { onClick: openNew, style: { display: "inline-flex", alignItems: "center", gap: 8, padding: "9px 18px", borderRadius: 1, cursor: "pointer", fontSize: 12, fontFamily: DS.mono, fontWeight: 700, letterSpacing: "0.06em", border: `1px solid ${DS.glow}66`, background: `${DS.glow}18`, color: DS.glow, boxShadow: `0 0 12px ${DS.glow}18` } },
                React.createElement(Plus, { size: 14 }),
                " NUEVO EMPLEADO")),
        saved && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 16px", background: `${DS.glowGreen}10`, border: `1px solid ${DS.glowGreen}44`, display: "flex", gap: 8, alignItems: "center" } },
            React.createElement(CheckCircle, { size: 13, color: DS.glowGreen }),
            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowGreen } }, "EMPLEADO GUARDADO CORRECTAMENTE EN BASE DE DATOS"))),
        React.createElement(Panel, { noPad: true },
            React.createElement("div", { style: { padding: "14px 18px", borderBottom: `1px solid ${DS.border}`, display: "flex", gap: 12, alignItems: "center" } },
                React.createElement(Search, { size: 14, color: DS.textDim }),
                React.createElement("input", { value: search, onChange: e => setSearch(e.target.value), placeholder: "Buscar por nombre o departamento...", style: { flex: 1, background: "none", border: "none", outline: "none", color: DS.text, fontSize: 12, fontFamily: DS.mono } }),
                React.createElement("span", { style: { fontSize: 10, color: DS.textDim, fontFamily: DS.mono } },
                    filtered.length,
                    " REGISTROS")),
            React.createElement(Table, { cols: [
                    { key: "name", label: "Empleado", render: row => {
                            const dept = db.departments.find(d => d.id === row.dept);
                            return (React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                                React.createElement(Avatar, { initials: row.avatar || "??", color: (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glow, size: 30 }),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 12, fontWeight: 700, color: DS.text } }, row.name),
                                    React.createElement("div", { style: { fontSize: 10, color: DS.textDim } }, row.role))));
                        } },
                    { key: "dept", label: "Depto.", render: row => {
                            const dept = db.departments.find(d => d.id === row.dept);
                            return React.createElement(Chip, { color: (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glow }, (dept === null || dept === void 0 ? void 0 : dept.name) || "—");
                        } },
                    { key: "location", label: "Ubicación", render: row => {
                            const loc = db.locations.find(l => l.id === row.location);
                            return React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid } }, (loc === null || loc === void 0 ? void 0 : loc.name) || "—");
                        } },
                    { key: "country", label: "Régimen", render: row => {
                            const color = row.country === "MX" ? DS.glowGreen : row.country === "RD" ? DS.glowAmber : row.country === "SV" ? DS.glowPurple : DS.glow;
                            const label = row.country === "MX" ? "MX · SAT" : row.country === "RD" ? "RD · DGII" : row.country === "SV" ? "SV · MH" : "US · IRS";
                            return React.createElement(Chip, { color: color }, label);
                        } },
                    { key: "payroll", label: "Nómina", render: row => React.createElement(Chip, { color: DS.glowAmber }, row.payroll) },
                    { key: "salary", label: "Salario", render: row => (React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, color: DS.glow } },
                            row.currency,
                            " $",
                            Number(row.salary).toLocaleString())) },
                    { key: "status", label: "Estado", render: row => (React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } },
                            React.createElement(StatusDot, { status: row.status }),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: row.status === "active" ? DS.glowGreen : DS.glowRed } }, row.status === "active" ? "ACTIVO" : "INACTIVO"))) },
                    { key: "actions", label: "", render: row => (React.createElement("div", { style: { display: "flex", gap: 6 } },
                            React.createElement("button", { onClick: () => openEdit(row), style: { display: "inline-flex", alignItems: "center", gap: 5, padding: "4px 10px", border: `1px solid ${DS.glow}44`, background: `${DS.glow}10`, color: DS.glow, fontFamily: DS.mono, fontSize: 10, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                                React.createElement(Edit, { size: 10 }),
                                " EDITAR"),
                            React.createElement("button", { onClick: () => setConfirm(row), style: { display: "inline-flex", alignItems: "center", gap: 5, padding: "4px 10px", border: `1px solid ${DS.glowRed}44`, background: `${DS.glowRed}08`, color: DS.glowRed, fontFamily: DS.mono, fontSize: 10, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                                React.createElement(Trash2, { size: 10 }),
                                " BAJA"))) },
                ], rows: filtered }),
            filtered.length === 0 && (React.createElement("div", { style: { padding: "32px", textAlign: "center", fontFamily: DS.mono, fontSize: 11, color: DS.textDim } }, search ? "SIN RESULTADOS PARA LA BÚSQUEDA" : "SIN EMPLEADOS REGISTRADOS"))),
        modal && (React.createElement(EmpModalOverlay, { onClose: () => setModal(false) },
            React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 } },
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                    React.createElement("div", { style: { width: 2, height: 16, background: DS.glow, boxShadow: glow(DS.glow) } }),
                    React.createElement(Users, { size: 14, color: DS.glow }),
                    React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, editMode ? "EDITAR EMPLEADO" : "ALTA DE NUEVO EMPLEADO")),
                React.createElement("button", { onClick: () => setModal(false), style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer", display: "flex" } },
                    React.createElement(X, { size: 16 }))),
            error && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 14px", background: `${DS.glowRed}10`, border: `1px solid ${DS.glowRed}44`, display: "flex", gap: 8, alignItems: "center" } },
                React.createElement(AlertCircle, { size: 12, color: DS.glowRed }),
                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowRed } }, error))),
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 } },
                React.createElement("div", { style: { gridColumn: "1/-1" } },
                    React.createElement(Input, { label: "Nombre Completo *", value: form.name || "", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { name: v }))), placeholder: "Ej: Juan P\u00E9rez Garc\u00EDa", required: true })),
                React.createElement(Input, { label: "Departamento", type: "select", value: form.dept || "d1", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { dept: v }))), options: deptOpts }),
                React.createElement(Input, { label: "Puesto / Rol *", value: form.role || "", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { role: v }))), placeholder: "Ej: Analista Senior", required: true }),
                React.createElement(Input, { label: "Salario Base *", type: "number", value: form.salary || "", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { salary: v }))), placeholder: "Ej: 15000", required: true }),
                React.createElement(Input, { label: "Tipo de N\u00F3mina", type: "select", value: form.payroll || "quincenal", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { payroll: v }))), options: [{ v: "semanal", l: "Semanal (MX)" }, { v: "quincenal", l: "Quincenal (MX)" }, { v: "mensual", l: "Mensual (MX)" }, { v: "biweekly", l: "Biweekly (US)" }] }),
                React.createElement(Input, { label: "Sede / Ubicaci\u00F3n", type: "select", value: form.location || "l1", onChange: v => {
                        const loc = db.locations.find(l => l.id === v);
                        const c = (loc === null || loc === void 0 ? void 0 : loc.country) || "MX";
                        setForm(p => (Object.assign(Object.assign({}, p), { location: v, country: c, currency: c === "US" ? "USD" : c === "RD" ? "DOP" : c === "SV" ? "USD" : "MXN" })));
                    }, options: locOpts }),
                React.createElement(Input, { label: "Fecha de Ingreso", type: "date", value: form.hireDate || "", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { hireDate: v }))) }),
                React.createElement(Input, { label: "Estado", type: "select", value: form.status || "active", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { status: v }))), options: [{ v: "active", l: "Activo" }, { v: "inactive", l: "Inactivo" }] })),
            React.createElement("div", { style: { margin: "16px 0", padding: "10px 14px", background: DS.surface, border: `1px solid ${DS.border}`, display: "flex", gap: 16, alignItems: "center" } },
                React.createElement(Shield, { size: 13, color: form.country === "MX" ? DS.glowGreen : form.country === "RD" ? DS.glowAmber : form.country === "SV" ? DS.glowPurple : DS.glow }),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.1em" } }, "R\u00C9GIMEN FISCAL APLICABLE"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, marginTop: 2, color: form.country === "MX" ? DS.glowGreen : form.country === "RD" ? DS.glowAmber : form.country === "SV" ? DS.glowPurple : DS.glow } },
                        form.country === "MX" && "SAT México · ISR Art.96 LISR + IMSS + Subsidio Empleo",
                        form.country === "US" && "IRS Federal 10–37% + CA FTB 1–12.3% + FICA 7.65% + SDI 1.1%",
                        form.country === "RD" && "DGII RD · ISR 0–25% (Ley 11-92) + SFS 3.04% + AFP 2.87% (TSS)",
                        form.country === "SV" && "MH El Salvador · ISR Decreto Nº10/2025 + ISSS 3% + AFP 7.25%")),
                React.createElement(Chip, { color: form.currency === "USD" ? DS.glow : form.currency === "DOP" ? DS.glowAmber : DS.glowGreen }, form.currency || "MXN")),
            React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "flex-end" } },
                React.createElement("button", { onClick: () => setModal(false), style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "9px 18px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                    React.createElement(X, { size: 13 }),
                    " CANCELAR"),
                React.createElement("button", { onClick: handleSave, style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "9px 18px", border: `1px solid ${DS.glowGreen}66`, background: `${DS.glowGreen}18`, color: DS.glowGreen, fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                    React.createElement(CheckCircle, { size: 13 }),
                    " ",
                    editMode ? "ACTUALIZAR" : "DAR DE ALTA")))),
        confirm && (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.88)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1001, backdropFilter: "blur(8px)" }, onClick: () => setConfirm(null) },
            React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.glowRed}55`, padding: 28, width: 420, position: "relative" }, onClick: e => e.stopPropagation() },
                React.createElement(HudCorner, { pos: "tl", color: DS.glowRed, size: 10 }),
                React.createElement(HudCorner, { pos: "br", color: DS.glowRed, size: 10 }),
                React.createElement("div", { style: { display: "flex", gap: 10, alignItems: "center", marginBottom: 12 } },
                    React.createElement(AlertTriangle, { size: 16, color: DS.glowRed }),
                    React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.glowRed, letterSpacing: "0.1em" } }, "CONFIRMAR BAJA")),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid, lineHeight: 1.8, marginBottom: 20 } },
                    "\u00BFConfirma la baja del empleado",
                    React.createElement("br", null),
                    React.createElement("span", { style: { color: DS.glowRed, fontWeight: 700 } }, confirm.name),
                    "?",
                    React.createElement("br", null),
                    "Esta acci\u00F3n no se puede deshacer."),
                React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "flex-end" } },
                    React.createElement("button", { onClick: () => setConfirm(null), style: { padding: "8px 18px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 11, cursor: "pointer", borderRadius: 1 } }, "CANCELAR"),
                    React.createElement("button", { onClick: () => handleDelete(confirm.id), style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "8px 18px", border: `1px solid ${DS.glowRed}66`, background: `${DS.glowRed}18`, color: DS.glowRed, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                        React.createElement(Trash2, { size: 11 }),
                        " CONFIRMAR BAJA")))))));
};
// ═══════════════════════════════════════════════
//  CLOCK MODAL — Reloj Checador
// ═══════════════════════════════════════════════
const ClockModalOverlay = ({ onClose, children }) => (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.92)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000, backdropFilter: "blur(10px)" }, onClick: onClose },
    React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.borderHi}`, width: 640, maxHeight: "92vh", overflowY: "auto", position: "relative", boxShadow: `0 0 60px ${DS.glow}18, 0 0 120px ${DS.glow}08` }, onClick: e => e.stopPropagation() },
        React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 14 }),
        React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 14 }),
        React.createElement(HudCorner, { pos: "bl", color: DS.glow, size: 14 }),
        React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 14 }),
        children)));
const ClockModal = ({ db, addTimeRecord, updateTimeRecord, onClose }) => {
    var _a;
    const now = new Date();
    const todayStr = now.toISOString().slice(0, 10);
    const timeStr = now.toTimeString().slice(0, 5);
    const [mode, setMode] = useState("manual"); // "manual" | "geocerca"
    const [action, setAction] = useState("entrada"); // "entrada" | "salida"
    const [search, setSearch] = useState("");
    const [selEmp, setSelEmp] = useState(null);
    const [date, setDate] = useState(todayStr);
    const [time, setTime] = useState(timeStr);
    const [exitTime, setExitTime] = useState("");
    const [notes, setNotes] = useState("");
    const [locId, setLocId] = useState("");
    const [supervisor, setSupervisor] = useState("");
    const [step, setStep] = useState(1); // 1=empleado, 2=detalle, 3=confirmado
    const [error, setError] = useState("");
    const [liveClock, setLiveClock] = useState(new Date());
    const [geoStatus, setGeoStatus] = useState("idle"); // "idle"|"searching"|"found"|"error"
    const [geoCoords, setGeoCoords] = useState(null);
    const [matchedLoc, setMatchedLoc] = useState(null);
    // Live clock tick
    useEffect(() => {
        const t = setInterval(() => setLiveClock(new Date()), 1000);
        return () => clearInterval(t);
    }, []);
    // When employee selected, check if already has active shift today
    const activeShift = selEmp
        ? ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).find(r => r.empId === selEmp.id && r.date === date && !r.exit)
        : null;
    useEffect(() => {
        if (activeShift)
            setAction("salida");
        else
            setAction("entrada");
    }, [selEmp === null || selEmp === void 0 ? void 0 : selEmp.id, activeShift === null || activeShift === void 0 ? void 0 : activeShift.id]);
    // Set default location from employee's location
    useEffect(() => {
        if (selEmp === null || selEmp === void 0 ? void 0 : selEmp.location)
            setLocId(selEmp.location);
    }, [selEmp === null || selEmp === void 0 ? void 0 : selEmp.id]);
    // Simulate geolocation check
    const runGeocheck = () => {
        setGeoStatus("searching");
        setMatchedLoc(null);
        setTimeout(() => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    const { latitude, longitude } = pos.coords;
                    setGeoCoords({ lat: latitude, lng: longitude });
                    // Check which location is within radius
                    const hit = ((db === null || db === void 0 ? void 0 : db.locations) || []).find(loc => {
                        const R = 6371000;
                        const φ1 = latitude * Math.PI / 180, φ2 = loc.lat * Math.PI / 180;
                        const Δφ = (loc.lat - latitude) * Math.PI / 180;
                        const Δλ = (loc.lng - longitude) * Math.PI / 180;
                        const a = Math.sin(Δφ / 2) ** 2 + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) ** 2;
                        const dist = R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                        return dist <= loc.radius;
                    });
                    setMatchedLoc(hit || null);
                    setGeoStatus(hit ? "found" : "error");
                    if (hit)
                        setLocId(hit.id);
                }, () => setGeoStatus("error"));
            }
            else {
                // Fallback: simulate for demo purposes
                const demoLoc = ((db === null || db === void 0 ? void 0 : db.locations) || [])[0];
                setGeoStatus("found");
                setMatchedLoc(demoLoc);
                if (demoLoc)
                    setLocId(demoLoc.id);
            }
        }, 1500);
    };
    // Filtered employee list for search
    const empList = ((db === null || db === void 0 ? void 0 : db.employees) || [])
        .filter(e => e.status === "active")
        .filter(e => !search || e.name.toLowerCase().includes(search.toLowerCase()) || e.id.includes(search));
    const getDept = (empId) => {
        const e = ((db === null || db === void 0 ? void 0 : db.employees) || []).find(x => x.id === empId);
        return ((db === null || db === void 0 ? void 0 : db.departments) || []).find(d => d.id === ((e === null || e === void 0 ? void 0 : e.dept_id) || (e === null || e === void 0 ? void 0 : e.dept)));
    };
    const handleConfirm = () => {
        if (!selEmp) {
            setError("Selecciona un empleado.");
            return;
        }
        if (!time) {
            setError("La hora es requerida.");
            return;
        }
        setError("");
        if (action === "entrada") {
            // Check no duplicate entry today
            const existing = ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).find(r => r.empId === selEmp.id && r.date === date && !r.exit);
            if (existing) {
                setError("Este empleado ya tiene una entrada activa para esta fecha.");
                return;
            }
            const entryHour = parseInt(time.split(":")[0]);
            const status = entryHour > 9 ? "tardanza" : "normal";
            addTimeRecord({
                empId: selEmp.id,
                date,
                entry: time,
                exit: null,
                type: mode,
                hours: null,
                status,
                notes,
                location: locId,
                supervisor,
                geoLat: (geoCoords === null || geoCoords === void 0 ? void 0 : geoCoords.lat) || null,
                geoLng: (geoCoords === null || geoCoords === void 0 ? void 0 : geoCoords.lng) || null,
                approved: mode === "geocerca",
            });
        }
        else {
            // Salida: update existing record
            if (!activeShift) {
                setError("No se encontró turno activo para este empleado hoy.");
                return;
            }
            if (exitTime && exitTime <= activeShift.entry) {
                setError("La hora de salida debe ser posterior a la entrada.");
                return;
            }
            const finalExit = exitTime || time;
            const hours = Number(((new Date(`2000-01-01T${finalExit}`) - new Date(`2000-01-01T${activeShift.entry}`)) / 3600000).toFixed(2));
            const entryHour = parseInt(activeShift.entry.split(":")[0]);
            const status = entryHour > 9 ? "tardanza" : "normal";
            updateTimeRecord(activeShift.id, {
                exit: finalExit,
                hours,
                status,
                exitNotes: notes,
                exitLat: (geoCoords === null || geoCoords === void 0 ? void 0 : geoCoords.lat) || null,
                exitLng: (geoCoords === null || geoCoords === void 0 ? void 0 : geoCoords.lng) || null,
                approvedExit: mode === "geocerca",
            });
        }
        setStep(3);
    };
    // ── Payroll preview for selected employee
    const payCalc = selEmp ? calcPayroll(selEmp) : null;
    const dept = selEmp ? getDept(selEmp.id) : null;
    const loc = ((db === null || db === void 0 ? void 0 : db.locations) || []).find(l => l.id === (locId || (selEmp === null || selEmp === void 0 ? void 0 : selEmp.location)));
    const liveTimeStr = liveClock.toLocaleTimeString("es-MX", { hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: false });
    const liveDateStr = liveClock.toLocaleDateString("es-MX", { weekday: "short", day: "2-digit", month: "short", year: "numeric" }).toUpperCase();
    return (React.createElement(ClockModalOverlay, { onClose: onClose },
        React.createElement("div", { style: { padding: "18px 24px", borderBottom: `1px solid ${DS.border}`, display: "flex", alignItems: "center", justifyContent: "space-between" } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12 } },
                React.createElement("div", { style: { position: "relative", width: 36, height: 36 } },
                    React.createElement("div", { style: { position: "absolute", inset: 0, borderRadius: "50%", border: `1px dashed ${DS.glow}66`, animation: "spin 8s linear infinite" } }),
                    React.createElement("div", { style: { position: "absolute", inset: "25%", borderRadius: "50%", background: DS.glow, boxShadow: glowStrong(DS.glow) } })),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.text, letterSpacing: "0.12em" } }, "RELOJ CHECADOR"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, liveDateStr))),
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 16 } },
                React.createElement("div", { style: { textAlign: "right" } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 22, fontWeight: 900, color: DS.glow, letterSpacing: "0.05em", lineHeight: 1 } }, liveTimeStr),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, marginTop: 2 } }, "HORA DEL SISTEMA")),
                React.createElement("button", { onClick: onClose, style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer" } },
                    React.createElement(X, { size: 16 })))),
        React.createElement("div", { style: { padding: "12px 24px", borderBottom: `1px solid ${DS.border}`, display: "flex", gap: 0 } }, [["1", "Empleado"], ["2", "Detalle"], ["3", "Confirmado"]].map(([n, l], i) => {
            const st = parseInt(n);
            const active = step === st, done = step > st;
            const color = done ? DS.glowGreen : active ? DS.glow : DS.textDim;
            return (React.createElement("div", { key: n, style: { display: "flex", alignItems: "center" } },
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } },
                    React.createElement("div", { style: { width: 22, height: 22, borderRadius: "50%", border: `1px solid ${color}`, background: done ? `${DS.glowGreen}20` : active ? `${DS.glow}18` : "transparent", display: "flex", alignItems: "center", justifyContent: "center" } }, done ? React.createElement(CheckCircle, { size: 11, color: DS.glowGreen }) : React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, fontWeight: 700, color } }, n)),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, fontWeight: 700, color, letterSpacing: "0.08em" } }, l)),
                i < 2 && React.createElement("div", { style: { width: 40, height: 1, background: DS.border, margin: "0 10px" } })));
        })),
        React.createElement("div", { style: { padding: "20px 24px" } },
            step === 1 && (React.createElement("div", null,
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.12em", marginBottom: 14 } }, "BUSCAR EMPLEADO"),
                React.createElement("div", { style: { position: "relative", marginBottom: 14 } },
                    React.createElement(Search, { size: 13, color: DS.textDim, style: { position: "absolute", left: 12, top: "50%", transform: "translateY(-50%)" } }),
                    React.createElement("input", { value: search, onChange: e => setSearch(e.target.value), placeholder: "Nombre o ID del empleado...", autoFocus: true, style: { width: "100%", padding: "10px 12px 10px 34px", background: DS.bg, border: `1px solid ${DS.borderHi}`, color: DS.text, fontFamily: DS.mono, fontSize: 12, outline: "none", boxSizing: "border-box" } })),
                React.createElement("div", { style: { maxHeight: 280, overflowY: "auto", display: "flex", flexDirection: "column", gap: 6 } },
                    empList.length === 0 && (React.createElement("div", { style: { padding: "24px", textAlign: "center", fontFamily: DS.mono, fontSize: 11, color: DS.textDim } }, "SIN RESULTADOS")),
                    empList.map(emp => {
                        const d = getDept(emp.id);
                        const active = ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).find(r => r.empId === emp.id && r.date === todayStr && !r.exit);
                        const color = (d === null || d === void 0 ? void 0 : d.color) || DS.glow;
                        const selected = (selEmp === null || selEmp === void 0 ? void 0 : selEmp.id) === emp.id;
                        return (React.createElement("div", { key: emp.id, onClick: () => setSelEmp(emp), style: { display: "flex", alignItems: "center", gap: 12, padding: "10px 14px", background: selected ? `${color}14` : DS.surface, border: `1px solid ${selected ? color : DS.border}`, cursor: "pointer", transition: "all .15s", boxShadow: selected ? `0 0 12px ${color}18` : "none" } },
                            React.createElement(Avatar, { initials: emp.avatar || "??", color: color, size: 36 }),
                            React.createElement("div", { style: { flex: 1 } },
                                React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 700, color: DS.text } }, emp.name),
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } },
                                    emp.role,
                                    " \u00B7 ",
                                    (d === null || d === void 0 ? void 0 : d.name) || "Sin dept.",
                                    " \u00B7 ",
                                    emp.country)),
                            React.createElement("div", { style: { textAlign: "right" } }, active ? (React.createElement("div", null,
                                React.createElement(Chip, { color: DS.glowAmber }, "EN TURNO"),
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.glowAmber, marginTop: 3 } },
                                    "Desde ",
                                    active.entry))) : (React.createElement(Chip, { color: DS.glowGreen }, "DISPONIBLE"))),
                            selected && React.createElement(CheckCircle, { size: 16, color: color })));
                    })),
                error && React.createElement("div", { style: { marginTop: 12, padding: "8px 12px", background: `${DS.glowRed}10`, border: `1px solid ${DS.glowRed}33`, fontFamily: DS.mono, fontSize: 10, color: DS.glowRed, display: "flex", gap: 8 } },
                    React.createElement(AlertCircle, { size: 11 }),
                    " ",
                    error),
                React.createElement("div", { style: { marginTop: 16, display: "flex", justifyContent: "flex-end" } },
                    React.createElement("button", { onClick: () => { if (!selEmp) {
                            setError("Selecciona un empleado.");
                            return;
                        } setError(""); setStep(2); setTime(new Date().toTimeString().slice(0, 5)); }, style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "10px 22px", border: `1px solid ${DS.glow}66`, background: `${DS.glow}18`, color: DS.glow, fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer" } },
                        "SIGUIENTE ",
                        React.createElement(ChevronRight, { size: 14 }))))),
            step === 2 && selEmp && (React.createElement("div", null,
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 14, padding: "12px 16px", background: DS.surface, border: `1px solid ${(dept === null || dept === void 0 ? void 0 : dept.color) || DS.glow}44`, marginBottom: 18 } },
                    React.createElement(Avatar, { initials: selEmp.avatar || "??", color: (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glow, size: 44 }),
                    React.createElement("div", { style: { flex: 1 } },
                        React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 800, color: DS.text } }, selEmp.name),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginTop: 2 } },
                            selEmp.role,
                            " \u00B7 ",
                            (dept === null || dept === void 0 ? void 0 : dept.name) || "Sin dept.",
                            " \u00B7 ", (_a = selEmp.payroll) === null || _a === void 0 ? void 0 :
                            _a.toUpperCase())),
                    payCalc && (React.createElement("div", { style: { textAlign: "right" } },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, "SALARIO PER\u00CDODO"),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 13, fontWeight: 800, color: DS.glowGreen } },
                            payCalc.currency,
                            " $",
                            payCalc.net.toLocaleString()),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, payCalc.regime)))),
                activeShift && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 14px", background: `${DS.glowAmber}10`, border: `1px solid ${DS.glowAmber}44`, display: "flex", gap: 10, alignItems: "center" } },
                    React.createElement(AlertTriangle, { size: 13, color: DS.glowAmber }),
                    React.createElement("div", { style: { flex: 1, fontFamily: DS.mono, fontSize: 10, color: DS.glowAmber } },
                        "TURNO ACTIVO DETECTADO \u2014 Entrada: ",
                        React.createElement("b", null, activeShift.entry),
                        " \u00B7 Tipo: ",
                        activeShift.type,
                        ". Se registrar\u00E1 la SALIDA."))),
                React.createElement("div", { style: { marginBottom: 16 } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.1em", marginBottom: 8 } }, "MODO DE REGISTRO"),
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 } }, [
                        { v: "manual", icon: Edit, label: "MANUAL", sub: "Hora ingresada por admin", color: DS.glow },
                        { v: "geocerca", icon: Satellite, label: "GEOCERCA", sub: "Verificación GPS automática", color: DS.glowPurple },
                    ].map(({ v, icon: Icon, label, sub, color }) => (React.createElement("button", { key: v, onClick: () => { setMode(v); if (v === "geocerca")
                            runGeocheck(); }, style: { display: "flex", alignItems: "center", gap: 10, padding: "12px 14px", background: mode === v ? `${color}18` : DS.bg, border: `1px solid ${mode === v ? color : DS.border}`, cursor: "pointer", textAlign: "left", boxShadow: mode === v ? `0 0 12px ${color}14` : "none" } },
                        React.createElement(Icon, { size: 16, color: mode === v ? color : DS.textDim }),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, fontWeight: 700, color: mode === v ? color : DS.textMid } }, label),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, marginTop: 2 } }, sub)),
                        mode === v && React.createElement(CheckCircle, { size: 13, color: color, style: { marginLeft: "auto" } })))))),
                mode === "geocerca" && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 14px", background: DS.surface, border: `1px solid ${geoStatus === "found" ? DS.glowGreen : geoStatus === "error" ? DS.glowRed : DS.glowPurple}44`, display: "flex", gap: 10, alignItems: "center" } },
                    geoStatus === "searching" && React.createElement(Loader2, { size: 13, color: DS.glowPurple, style: { animation: "spin 1s linear infinite" } }),
                    geoStatus === "found" && React.createElement(CheckCircle, { size: 13, color: DS.glowGreen }),
                    geoStatus === "error" && React.createElement(AlertCircle, { size: 13, color: DS.glowRed }),
                    geoStatus === "idle" && React.createElement(MapPin, { size: 13, color: DS.textDim }),
                    React.createElement("div", { style: { flex: 1, fontFamily: DS.mono, fontSize: 10 } },
                        geoStatus === "searching" && React.createElement("span", { style: { color: DS.glowPurple } }, "LOCALIZANDO COORDENADAS GPS..."),
                        geoStatus === "found" && React.createElement("span", { style: { color: DS.glowGreen } },
                            "GEOCERCA DETECTADA: ",
                            React.createElement("b", null, (matchedLoc === null || matchedLoc === void 0 ? void 0 : matchedLoc.name) || "—"),
                            " \u00B7 Radio: ", matchedLoc === null || matchedLoc === void 0 ? void 0 :
                            matchedLoc.radius,
                            "m"),
                        geoStatus === "error" && React.createElement("span", { style: { color: DS.glowRed } }, "FUERA DE GEOCERCA \u00B7 No se detect\u00F3 ninguna sede en el rango permitido"),
                        geoStatus === "idle" && React.createElement("span", { style: { color: DS.textDim } }, "Haz clic en GEOCERCA para iniciar verificaci\u00F3n GPS")),
                    geoStatus !== "searching" && React.createElement("button", { onClick: runGeocheck, style: { background: "none", border: `1px solid ${DS.glowPurple}44`, color: DS.glowPurple, fontFamily: DS.mono, fontSize: 9, padding: "4px 10px", cursor: "pointer" } }, "REINTENTAR"))),
                React.createElement("div", { style: { marginBottom: 16 } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.1em", marginBottom: 8 } }, "TIPO DE REGISTRO"),
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 } }, [
                        { v: "entrada", label: "ENTRADA", color: DS.glowGreen, disabled: !!activeShift },
                        { v: "salida", label: "SALIDA", color: DS.glowRed, disabled: !activeShift },
                    ].map(({ v, label, color, disabled }) => (React.createElement("button", { key: v, onClick: () => !disabled && setAction(v), disabled: disabled, style: { padding: "10px", background: action === v ? `${color}18` : DS.bg, border: `1px solid ${action === v ? color : DS.border}`, cursor: disabled ? "not-allowed" : "pointer", opacity: disabled ? 0.4 : 1 } },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 13, fontWeight: 900, color: action === v ? color : DS.textMid } }, label),
                        v === "salida" && activeShift && React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, marginTop: 2 } },
                            "Entrada registrada: ",
                            activeShift.entry)))))),
                React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 14 } },
                    React.createElement(Input, { label: "Fecha *", type: "date", value: date, onChange: v => setDate(v) }),
                    action === "entrada" ? (React.createElement(Input, { label: "Hora de Entrada *", type: "time", value: time, onChange: v => setTime(v) })) : (React.createElement(Input, { label: "Hora de Salida *", type: "time", value: exitTime || time, onChange: v => setExitTime(v) })),
                    React.createElement(Input, { label: "Sede / Ubicaci\u00F3n", type: "select", value: locId, onChange: v => setLocId(v), options: ((db === null || db === void 0 ? void 0 : db.locations) || []).map(l => ({ v: l.id, l: `${l.name} (${l.country})` })) }),
                    React.createElement(Input, { label: "Supervisor (opcional)", value: supervisor, onChange: v => setSupervisor(v), placeholder: "Nombre o c\u00F3digo" }),
                    React.createElement("div", { style: { gridColumn: "1/-1" } },
                        React.createElement(Input, { label: "Notas", value: notes, onChange: v => setNotes(v), placeholder: "Observaciones, justificaci\u00F3n..." }))),
                action === "salida" && activeShift && (exitTime || time) && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 16px", background: DS.surface, border: `1px solid ${DS.border}`, display: "flex", gap: 20, alignItems: "center" } },
                    React.createElement("div", null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, "ENTRADA"),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 18, fontWeight: 900, color: DS.glowGreen } }, activeShift.entry)),
                    React.createElement(ChevronRight, { size: 14, color: DS.textDim }),
                    React.createElement("div", null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, "SALIDA"),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 18, fontWeight: 900, color: DS.glowRed } }, exitTime || time)),
                    React.createElement(ChevronRight, { size: 14, color: DS.textDim }),
                    React.createElement("div", null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, "HORAS TRABAJADAS"),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 18, fontWeight: 900, color: DS.glow } }, (() => {
                            const h = ((new Date(`2000-01-01T${exitTime || time}`) - new Date(`2000-01-01T${activeShift.entry}`)) / 3600000);
                            return h > 0 ? h.toFixed(2) + "h" : "—";
                        })())),
                    payCalc && (React.createElement(React.Fragment, null,
                        React.createElement(ChevronRight, { size: 14, color: DS.textDim }),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, "COSTO HORA"),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 14, fontWeight: 900, color: DS.glowAmber } },
                                payCalc.currency,
                                " $",
                                (payCalc.net / 160).toFixed(0),
                                "/h")))))),
                mode === "manual" && (React.createElement("div", { style: { marginBottom: 14, padding: "8px 12px", background: `${DS.glowAmber}08`, border: `1px solid ${DS.glowAmber}33`, display: "flex", gap: 8, alignItems: "center" } },
                    React.createElement(AlertTriangle, { size: 11, color: DS.glowAmber }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.glowAmber } }, "REGISTRO MANUAL \u2014 REQUIERE APROBACI\u00D3N DEL SUPERVISOR \u00B7 QUEDAR\u00C1 MARCADO COMO PENDIENTE"))),
                error && React.createElement("div", { style: { marginBottom: 14, padding: "8px 12px", background: `${DS.glowRed}10`, border: `1px solid ${DS.glowRed}33`, display: "flex", gap: 8, alignItems: "center", fontFamily: DS.mono, fontSize: 10, color: DS.glowRed } },
                    React.createElement(AlertCircle, { size: 11 }),
                    " ",
                    error),
                React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "space-between" } },
                    React.createElement("button", { onClick: () => { setStep(1); setError(""); }, style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "10px 18px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer" } }, "\u2190 ATR\u00C1S"),
                    React.createElement("button", { onClick: handleConfirm, style: { display: "inline-flex", alignItems: "center", gap: 8, padding: "10px 24px", border: `1px solid ${action === "entrada" ? DS.glowGreen : DS.glowRed}66`, background: `${action === "entrada" ? DS.glowGreen : DS.glowRed}18`, color: action === "entrada" ? DS.glowGreen : DS.glowRed, fontFamily: DS.mono, fontSize: 13, fontWeight: 900, cursor: "pointer", letterSpacing: "0.06em" } },
                        React.createElement(CheckCircle, { size: 15 }),
                        " REGISTRAR ",
                        action.toUpperCase())))),
            step === 3 && (React.createElement("div", { style: { textAlign: "center", padding: "20px 0" } },
                React.createElement("div", { style: { position: "relative", width: 80, height: 80, margin: "0 auto 20px" } },
                    React.createElement("div", { style: { position: "absolute", inset: 0, borderRadius: "50%", border: `2px solid ${action === "entrada" ? DS.glowGreen : DS.glowRed}`, animation: "spin 3s linear infinite" } }),
                    React.createElement("div", { style: { position: "absolute", inset: "20%", borderRadius: "50%", background: `${action === "entrada" ? DS.glowGreen : DS.glowRed}22`, display: "flex", alignItems: "center", justifyContent: "center" } },
                        React.createElement(CheckCircle, { size: 28, color: action === "entrada" ? DS.glowGreen : DS.glowRed }))),
                React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 18, fontWeight: 900, color: action === "entrada" ? DS.glowGreen : DS.glowRed, letterSpacing: "0.1em", marginBottom: 6 } }, action === "entrada" ? "ENTRADA REGISTRADA" : "SALIDA REGISTRADA"),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 13, color: DS.text, marginBottom: 4 } }, selEmp === null || selEmp === void 0 ? void 0 : selEmp.name),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textDim, marginBottom: 20 } },
                    date,
                    " \u00B7 ",
                    action === "entrada" ? time : (exitTime || time),
                    " \u00B7 ",
                    mode === "geocerca" ? "GEOCERCA" : "MANUAL",
                    loc && ` · ${loc.name}`),
                React.createElement("div", { style: { padding: "12px 20px", background: DS.surface, border: `1px solid ${DS.border}`, display: "inline-block", textAlign: "left", marginBottom: 20 } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, marginBottom: 8, letterSpacing: "0.1em" } }, "RESUMEN FISCAL"),
                    payCalc && (React.createElement("div", { style: { display: "flex", gap: 20 } }, [["Bruto", `${payCalc.currency} $${payCalc.base.toLocaleString()}`, DS.text], ["Deducciones", `-$${payCalc.totalDed.toLocaleString()}`, DS.glowRed], ["Neto", `$${payCalc.net.toLocaleString()}`, DS.glowGreen], ["Régimen", payCalc.regime, DS.glow]].map(([l, v, c]) => (React.createElement("div", { key: l },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, l),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 800, color: c, marginTop: 2 } }, v))))))),
                React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "center" } },
                    React.createElement("button", { onClick: () => { setStep(1); setSelEmp(null); setSearch(""); setNotes(""); setExitTime(""); setGeoStatus("idle"); setGeoCoords(null); setMatchedLoc(null); }, style: { padding: "10px 20px", border: `1px solid ${DS.glow}44`, background: `${DS.glow}10`, color: DS.glow, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer" } }, "NUEVO REGISTRO"),
                    React.createElement("button", { onClick: onClose, style: { padding: "10px 20px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer" } }, "CERRAR")))))));
};
const TimeModalOverlay = ({ onClose, children }) => (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.9)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000, backdropFilter: "blur(8px)" }, onClick: onClose },
    React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.borderHi}`, borderRadius: 2, width: 560, maxHeight: "90vh", overflowY: "auto", padding: 28, position: "relative", boxShadow: `0 0 40px ${DS.glow}18` }, onClick: e => e.stopPropagation() },
        React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "bl", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 12 }),
        children)));
const ViewTime = ({ db, addTimeRecord, updateTimeRecord }) => {
    const today = new Date().toISOString().slice(0, 10);
    const [clockModal, setClockModal] = useState(false);
    const [manualModal, setManualModal] = useState(false);
    const [saved, setSaved] = useState(false);
    const [error, setError] = useState("");
    const [form, setForm] = useState({ empId: "", date: today, entry: "", exit: "", type: "manual", notes: "" });
    useEffect(() => {
        var _a;
        const id = ((_a = ((db === null || db === void 0 ? void 0 : db.employees) || []).find(e => e.status === "active")) === null || _a === void 0 ? void 0 : _a.id) || "";
        setForm(p => (Object.assign(Object.assign({}, p), { empId: p.empId || id })));
    }, [db]);
    const openManual = () => {
        var _a;
        setError("");
        setForm({ empId: ((_a = ((db === null || db === void 0 ? void 0 : db.employees) || []).find(e => e.status === "active")) === null || _a === void 0 ? void 0 : _a.id) || "", date: today, entry: "", exit: "", type: "manual", notes: "" });
        setManualModal(true);
    };
    const handleAdd = () => {
        if (!form.empId) {
            setError("Selecciona un empleado.");
            return;
        }
        if (!form.date) {
            setError("La fecha es requerida.");
            return;
        }
        if (!form.entry) {
            setError("La hora de entrada es requerida.");
            return;
        }
        if (form.exit && form.exit <= form.entry) {
            setError("La salida debe ser posterior a la entrada.");
            return;
        }
        setError("");
        const hours = form.exit ? Number(((new Date(`2000-01-01T${form.exit}`) - new Date(`2000-01-01T${form.entry}`)) / 3600000).toFixed(2)) : null;
        const status = !form.exit ? "activo" : form.entry > "09:00" ? "tardanza" : "normal";
        addTimeRecord({ empId: form.empId, date: form.date, entry: form.entry, exit: form.exit || null, type: form.type, hours, status, notes: form.notes });
        setSaved(true);
        setTimeout(() => setSaved(false), 2500);
        setManualModal(false);
    };
    const getDept = (empId) => {
        const e = ((db === null || db === void 0 ? void 0 : db.employees) || []).find(x => x.id === empId);
        return ((db === null || db === void 0 ? void 0 : db.departments) || []).find(d => d.id === ((e === null || e === void 0 ? void 0 : e.dept_id) || (e === null || e === void 0 ? void 0 : e.dept)));
    };
    const todayRecs = ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).filter(r => r.date === today);
    const activeRecs = ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).filter(r => !r.exit);
    return (React.createElement("div", null,
        React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 20 } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                React.createElement("div", { style: { width: 2, height: 18, background: DS.glow, boxShadow: glow(DS.glow, 4) } }),
                React.createElement(Clock, { size: 15, color: DS.glow }),
                React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 700, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, "Control de Tiempo")),
            React.createElement("div", { style: { display: "flex", gap: 10 } },
                React.createElement("button", { onClick: () => setClockModal(true), style: { display: "inline-flex", alignItems: "center", gap: 8, padding: "9px 22px", borderRadius: 1, cursor: "pointer", fontSize: 13, fontFamily: DS.mono, fontWeight: 900, letterSpacing: "0.06em", border: `1px solid ${DS.glow}88`, background: `${DS.glow}22`, color: DS.glow, boxShadow: `0 0 18px ${DS.glow}22`, textTransform: "uppercase" } },
                    React.createElement("div", { style: { position: "relative", width: 16, height: 16 } },
                        React.createElement("div", { style: { position: "absolute", inset: 0, borderRadius: "50%", border: `1px solid ${DS.glow}`, animation: "spin 4s linear infinite" } }),
                        React.createElement("div", { style: { position: "absolute", inset: "30%", borderRadius: "50%", background: DS.glow } })),
                    "CHECAR ENTRADA / SALIDA"),
                React.createElement("button", { onClick: openManual, style: { display: "inline-flex", alignItems: "center", gap: 8, padding: "9px 16px", cursor: "pointer", fontSize: 11, fontFamily: DS.mono, fontWeight: 700, border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim } },
                    React.createElement(Edit, { size: 12 }),
                    " REGISTRO MANUAL"),
                React.createElement("button", { style: { display: "inline-flex", alignItems: "center", gap: 8, padding: "9px 16px", cursor: "pointer", fontSize: 11, fontFamily: DS.mono, fontWeight: 700, border: `1px solid ${DS.glowPurple}44`, background: `${DS.glowPurple}10`, color: DS.glowPurple } },
                    React.createElement(Satellite, { size: 12 }),
                    " GEOCERCA CONFIG"))),
        saved && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 16px", background: `${DS.glowGreen}10`, border: `1px solid ${DS.glowGreen}44`, display: "flex", gap: 8, alignItems: "center" } },
            React.createElement(CheckCircle, { size: 13, color: DS.glowGreen }),
            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowGreen } }, "REGISTRO GUARDADO CORRECTAMENTE"))),
        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 12, marginBottom: 16 } },
            React.createElement(KpiCard, { icon: Clock, label: "Total Registros", value: ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).length, color: DS.glow }),
            React.createElement(KpiCard, { icon: CheckCircle, label: "Registros Hoy", value: todayRecs.length, color: DS.glowGreen }),
            React.createElement(KpiCard, { icon: AlertTriangle, label: "En Turno", value: activeRecs.length, color: DS.glowAmber }),
            React.createElement(KpiCard, { icon: Users, label: "Tardanzas Hoy", value: todayRecs.filter(r => r.status === "tardanza").length, color: DS.glowRed })),
        React.createElement(Panel, { glowColor: DS.glowPurple, style: { marginBottom: 16 } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 20 } },
                React.createElement("div", { style: { position: "relative", width: 44, height: 44, flexShrink: 0 } },
                    React.createElement("div", { style: { position: "absolute", inset: 0, borderRadius: "50%", border: `1px dashed ${DS.glowPurple}44`, animation: "spin 12s linear infinite" } }),
                    React.createElement("div", { style: { position: "absolute", inset: "20%", borderRadius: "50%", border: `1px solid ${DS.glowPurple}88` } }),
                    React.createElement("div", { style: { position: "absolute", inset: "38%", borderRadius: "50%", background: DS.glowPurple, boxShadow: glowStrong(DS.glowPurple) } })),
                React.createElement("div", { style: { flex: 1 } },
                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 700, color: DS.text, letterSpacing: "0.1em", textTransform: "uppercase" } }, "M\u00F3dulo Geocerca \u2014 Activo"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim, marginTop: 4 } }, "Registro autom\u00E1tico v\u00EDa GPS. Usa el bot\u00F3n \"CHECAR ENTRADA / SALIDA\" \u2192 modo Geocerca para verificaci\u00F3n en tiempo real.")),
                React.createElement("div", { style: { display: "flex", gap: 10, flexWrap: "wrap" } }, ((db === null || db === void 0 ? void 0 : db.locations) || []).map(l => (React.createElement("div", { key: l.id, style: { padding: "8px 12px", background: DS.bgAlt, border: `1px solid ${DS.border}`, textAlign: "center", minWidth: 70 } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 13, fontWeight: 800, color: DS.glowPurple } },
                        l.radius,
                        "m"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, marginTop: 2 } }, l.name.split(" ")[0].toUpperCase()))))))),
        React.createElement(Panel, { noPad: true },
            React.createElement("div", { style: { padding: "12px 18px", borderBottom: `1px solid ${DS.border}`, display: "flex", justifyContent: "space-between", alignItems: "center" } },
                React.createElement(Tag, { label: "REGISTROS TOTALES", value: `${((db === null || db === void 0 ? void 0 : db.timeRecords) || []).length}` }),
                React.createElement("div", { style: { display: "flex", gap: 14 } },
                    React.createElement(Tag, { label: "HOY", value: todayRecs.length, color: DS.glowGreen }),
                    React.createElement(Tag, { label: "EN TURNO", value: activeRecs.length, color: DS.glowAmber }))),
            React.createElement(Table, { cols: [
                    { key: "empId", label: "Empleado", render: row => {
                            var _a;
                            const empId = row.empId || row.employee_id;
                            const emp = ((db === null || db === void 0 ? void 0 : db.employees) || []).find(e => e.id === empId);
                            const dept = getDept(empId);
                            return (React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                                React.createElement(Avatar, { initials: (emp === null || emp === void 0 ? void 0 : emp.avatar) || "??", color: (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glow, size: 28 }),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: DS.text } }, (emp === null || emp === void 0 ? void 0 : emp.name) || empId || "—"),
                                    row.location && React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, ((_a = ((db === null || db === void 0 ? void 0 : db.locations) || []).find(l => l.id === row.location)) === null || _a === void 0 ? void 0 : _a.name) || ""))));
                        } },
                    { key: "date", label: "Fecha", mono: true },
                    { key: "entry", label: "Entrada", render: row => {
                            const t = row.entry || row.entry_time;
                            return React.createElement("span", { style: { fontFamily: DS.mono, color: DS.glowGreen, fontWeight: 700 } }, t || "—");
                        } },
                    { key: "exit", label: "Salida", render: row => {
                            const t = row.exit || row.exit_time;
                            return React.createElement("span", { style: { fontFamily: DS.mono, color: t ? DS.glowRed : DS.glowAmber, fontWeight: 700 } }, t || "EN TURNO");
                        } },
                    { key: "hours", label: "Horas", render: row => React.createElement("span", { style: { fontFamily: DS.mono, color: DS.text } }, row.hours ? `${row.hours}h` : "—") },
                    { key: "type", label: "Tipo", render: row => React.createElement(Chip, { color: row.type === "geocerca" ? DS.glowPurple : DS.glow }, row.type === "geocerca" ? "GEOCERCA" : "MANUAL") },
                    { key: "status", label: "Estado", render: row => {
                            const s = row.status || "normal";
                            const c = s === "tardanza" ? DS.glowRed : s === "activo" ? DS.glowAmber : DS.glowGreen;
                            return React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } },
                                React.createElement(StatusDot, { status: s }),
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: c } }, s.toUpperCase()));
                        } },
                    { key: "approved", label: "Aprob.", render: row => (React.createElement(Chip, { color: row.approved || row.type === "geocerca" ? DS.glowGreen : DS.glowAmber }, row.approved || row.type === "geocerca" ? "AUTO" : "PEND.")) },
                ], rows: (db === null || db === void 0 ? void 0 : db.timeRecords) || [] }),
            ((db === null || db === void 0 ? void 0 : db.timeRecords) || []).length === 0 && (React.createElement("div", { style: { padding: "32px", textAlign: "center" } },
                React.createElement(Clock, { size: 28, color: DS.textDim, style: { margin: "0 auto 10px" } }),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textDim } }, "SIN REGISTROS DE TIEMPO"),
                React.createElement("button", { onClick: () => setClockModal(true), style: { marginTop: 12, padding: "8px 18px", border: `1px solid ${DS.glow}44`, background: `${DS.glow}10`, color: DS.glow, fontFamily: DS.mono, fontSize: 10, fontWeight: 700, cursor: "pointer" } }, "+ CHECAR AHORA")))),
        clockModal && (React.createElement(ClockModal, { db: db, addTimeRecord: addTimeRecord, updateTimeRecord: updateTimeRecord, onClose: () => setClockModal(false) })),
        manualModal && (React.createElement(TimeModalOverlay, { onClose: () => setManualModal(false) },
            React.createElement("div", { style: { padding: 24 } },
                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 } },
                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                        React.createElement("div", { style: { width: 2, height: 16, background: DS.glow, boxShadow: glow(DS.glow) } }),
                        React.createElement(Edit, { size: 14, color: DS.glow }),
                        React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 800, color: DS.text, letterSpacing: "0.12em" } }, "REGISTRO MANUAL ADMIN")),
                    React.createElement("button", { onClick: () => setManualModal(false), style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer" } },
                        React.createElement(X, { size: 16 }))),
                error && React.createElement("div", { style: { marginBottom: 12, padding: "8px 12px", background: `${DS.glowRed}10`, border: `1px solid ${DS.glowRed}33`, display: "flex", gap: 8, alignItems: "center", fontFamily: DS.mono, fontSize: 10, color: DS.glowRed } },
                    React.createElement(AlertCircle, { size: 11 }),
                    error),
                React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 14 } },
                    React.createElement("div", { style: { gridColumn: "1/-1" } },
                        React.createElement(Input, { label: "Empleado *", type: "select", value: form.empId, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { empId: v }))), options: ((db === null || db === void 0 ? void 0 : db.employees) || []).filter(e => e.status === "active").map(e => ({ v: e.id, l: e.name })) })),
                    React.createElement(Input, { label: "Fecha *", type: "date", value: form.date, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { date: v }))) }),
                    React.createElement(Input, { label: "Tipo", type: "select", value: form.type, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { type: v }))), options: [{ v: "manual", l: "Manual" }, { v: "geocerca", l: "Geocerca" }] }),
                    React.createElement(Input, { label: "Hora Entrada *", type: "time", value: form.entry, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { entry: v }))) }),
                    React.createElement(Input, { label: "Hora Salida", type: "time", value: form.exit, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { exit: v }))) }),
                    React.createElement("div", { style: { gridColumn: "1/-1" } },
                        React.createElement(Input, { label: "Notas", value: form.notes, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { notes: v }))), placeholder: "Motivo del registro manual..." }))),
                form.entry && form.exit && (React.createElement("div", { style: { marginBottom: 14, padding: "8px 14px", background: DS.surface, border: `1px solid ${DS.border}`, display: "flex", gap: 16, alignItems: "center" } },
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.glowGreen } }, form.entry),
                    React.createElement(ChevronRight, { size: 12, color: DS.textDim }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.glowRed } }, form.exit),
                    React.createElement(ChevronRight, { size: 12, color: DS.textDim }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, fontWeight: 800, color: DS.glow } },
                        ((new Date(`2000-01-01T${form.exit}`) - new Date(`2000-01-01T${form.entry}`)) / 3600000).toFixed(2),
                        "h"))),
                React.createElement("div", { style: { padding: "8px 12px", background: `${DS.glowAmber}08`, border: `1px solid ${DS.glowAmber}33`, marginBottom: 16, display: "flex", gap: 8, alignItems: "center" } },
                    React.createElement(AlertTriangle, { size: 11, color: DS.glowAmber }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.glowAmber } }, "REGISTRO MANUAL \u2014 REQUIERE APROBACI\u00D3N DEL SUPERVISOR")),
                React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "flex-end" } },
                    React.createElement("button", { onClick: () => setManualModal(false), style: { padding: "9px 18px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer" } },
                        React.createElement(X, { size: 12 }),
                        " CANCELAR"),
                    React.createElement("button", { onClick: handleAdd, style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "9px 18px", border: `1px solid ${DS.glowGreen}66`, background: `${DS.glowGreen}18`, color: DS.glowGreen, fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer" } },
                        React.createElement(CheckCircle, { size: 13 }),
                        " GUARDAR")))))));
};
const ViewLocations = ({ db, upsertLocation, deleteLocation }) => {
    const [modal, setModal] = useState(false);
    const [editMode, setEditMode] = useState(false);
    const [form, setForm] = useState({ name: "", address: "", lat: "", lng: "", radius: "150", country: "MX", timezone: "America/Mexico_City" });
    const [deleteConfirm, setDeleteConfirm] = useState(null);
    const [saved, setSaved] = useState(false);
    const openNew = () => {
        setForm({ name: "", address: "", lat: "", lng: "", radius: "150", country: "MX", timezone: "America/Mexico_City" });
        setEditMode(false);
        setModal(true);
    };
    const openEdit = (loc) => {
        setForm(Object.assign(Object.assign({}, loc), { lat: String(loc.lat), lng: String(loc.lng), radius: String(loc.radius) }));
        setEditMode(true);
        setModal(true);
    };
    const handleSave = async () => {
        if (!form.name || !form.lat || !form.lng)
            return;
        await upsertLocation(Object.assign(Object.assign({}, form), { lat: Number(form.lat), lng: Number(form.lng), radius: Number(form.radius), id: editMode ? form.id : undefined }));
        setSaved(true);
        setTimeout(() => setSaved(false), 2000);
        setModal(false);
    };
    const handleDelete = (loc) => {
        deleteLocation(loc.id);
        setDeleteConfirm(null);
    };
    const countryOpts = [
        { v: "MX", l: "🇲🇽 México (SAT)" },
        { v: "US", l: "🇺🇸 California (IRS+FTB)" },
        { v: "RD", l: "🇩🇴 República Dominicana (DGII)" },
        { v: "SV", l: "🇸🇻 El Salvador (MH)" },
    ];
    const tzOpts = [
        // México
        { v: "America/Mexico_City", l: "🇲🇽 Mexico City / Centro (UTC-6)" },
        { v: "America/Monterrey", l: "🇲🇽 Monterrey / Noreste (UTC-6)" },
        { v: "America/Chihuahua", l: "🇲🇽 Chihuahua / Pacífico (UTC-7)" },
        { v: "America/Tijuana", l: "🇲🇽 Tijuana / Baja California (UTC-8)" },
        // USA
        { v: "America/Los_Angeles", l: "🇺🇸 Los Angeles / Pacific (UTC-8)" },
        { v: "America/Denver", l: "🇺🇸 Denver / Mountain (UTC-7)" },
        { v: "America/Chicago", l: "🇺🇸 Chicago / Central (UTC-6)" },
        { v: "America/New_York", l: "🇺🇸 New York / Eastern (UTC-5)" },
        // República Dominicana
        { v: "America/Santo_Domingo", l: "🇩🇴 Santo Domingo (UTC-4, fijo)" },
        // El Salvador
        { v: "America/El_Salvador", l: "🇸🇻 El Salvador / San Salvador (UTC-6)" },
        // Guatemala / Honduras / Nicaragua (vecinos de SV)
        { v: "America/Guatemala", l: "🇬🇹 Guatemala / Honduras (UTC-6)" },
        { v: "America/Managua", l: "🇳🇮 Nicaragua / Costa Rica (UTC-6)" },
    ];
    // Zona horaria por defecto sugerida al cambiar el país
    const defaultTzByCountry = {
        MX: "America/Mexico_City",
        US: "America/Los_Angeles",
        RD: "America/Santo_Domingo",
        SV: "America/El_Salvador",
    };
    return (React.createElement("div", null,
        React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 20 } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                React.createElement("div", { style: { width: 2, height: 18, background: DS.glow, boxShadow: glow(DS.glow, 4) } }),
                React.createElement(MapPin, { size: 15, color: DS.glow }),
                React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 700, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, "Ubicaciones & Geocercas"),
                React.createElement(Chip, { color: DS.textDim },
                    db.locations.length,
                    " SEDES")),
            React.createElement("button", { onClick: openNew, style: {
                    display: "inline-flex", alignItems: "center", gap: 8,
                    padding: "9px 18px", borderRadius: 1, cursor: "pointer",
                    fontSize: 12, fontFamily: DS.mono, fontWeight: 700, letterSpacing: "0.06em",
                    border: `1px solid ${DS.glow}66`,
                    background: `${DS.glow}18`,
                    color: DS.glow,
                    boxShadow: `0 0 12px ${DS.glow}18`,
                } },
                React.createElement(Plus, { size: 14 }),
                "NUEVA UBICACI\u00D3N")),
        saved && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 16px", background: `${DS.glowGreen}10`, border: `1px solid ${DS.glowGreen}44`, display: "flex", gap: 8, alignItems: "center" } },
            React.createElement(CheckCircle, { size: 13, color: DS.glowGreen }),
            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowGreen } }, "UBICACI\u00D3N GUARDADA CORRECTAMENTE EN BASE DE DATOS"))),
        React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 12 } },
            db.locations.map(loc => {
                var _a, _b;
                const isMX = loc.country === "MX";
                const color = isMX ? DS.glowGreen : DS.glow;
                const empCount = db.employees.filter(e => e.location === loc.id && e.status === "active").length;
                return (React.createElement("div", { key: loc.id, style: {
                        background: DS.surface,
                        border: `1px solid ${DS.border}`,
                        borderLeft: `3px solid ${color}`,
                        position: "relative",
                        padding: "18px 22px",
                        display: "grid",
                        gridTemplateColumns: "72px 1fr auto",
                        gap: 20,
                        alignItems: "center",
                        boxShadow: `inset 0 0 20px ${color}06, 0 4px 24px rgba(0,0,0,.4)`,
                    } },
                    React.createElement(HudCorner, { pos: "tl", color: color, size: 8 }),
                    React.createElement(HudCorner, { pos: "br", color: color, size: 8 }),
                    React.createElement("div", { style: { position: "relative", width: 72, height: 72, flexShrink: 0 } },
                        React.createElement("div", { style: { position: "absolute", inset: 0, borderRadius: "50%", border: `1px dashed ${color}33`, animation: "spin 18s linear infinite" } }),
                        React.createElement("div", { style: { position: "absolute", inset: "18%", borderRadius: "50%", border: `1px solid ${color}55` } }),
                        React.createElement("div", { style: { position: "absolute", inset: "36%", borderRadius: "50%", border: `1px solid ${color}88` } }),
                        React.createElement("div", { style: { position: "absolute", inset: "50%", borderRadius: "50%", background: color, boxShadow: glowStrong(color), transform: "translate(-50%,-50%)", width: 10, height: 10 } }),
                        React.createElement("div", { style: { position: "absolute", top: 2, right: 8, fontFamily: DS.mono, fontSize: 7, color, fontWeight: 800, letterSpacing: "0.1em" } }, isMX ? "MX" : "US"),
                        React.createElement("div", { style: { position: "absolute", bottom: 2, left: "50%", transform: "translateX(-50%)", fontFamily: DS.mono, fontSize: 7, color: DS.textDim } },
                            loc.radius,
                            "m")),
                    React.createElement("div", null,
                        React.createElement("div", { style: { display: "flex", gap: 10, alignItems: "center", marginBottom: 6 } },
                            React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 17, fontWeight: 800, color: DS.text, letterSpacing: "0.08em", textTransform: "uppercase" } }, loc.name),
                            React.createElement(Chip, { color: color }, isMX ? "SAT MX" : "IRS+CA"),
                            empCount > 0 && React.createElement(Chip, { color: DS.glowAmber },
                                empCount,
                                " EMP.")),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim, marginBottom: 12 } },
                            React.createElement(Navigation, { size: 9, color: DS.textDim, style: { display: "inline", marginRight: 4 } }),
                            loc.address),
                        React.createElement("div", { style: { display: "flex", gap: 20, flexWrap: "wrap" } }, [
                            { l: "LATITUD", v: Number(loc.lat).toFixed(4) },
                            { l: "LONGITUD", v: Number(loc.lng).toFixed(4) },
                            { l: "RADIO", v: `${loc.radius} m`, c: color },
                            { l: "ZONA HORARIA", v: ((_b = (_a = loc.timezone) === null || _a === void 0 ? void 0 : _a.split("/")[1]) === null || _b === void 0 ? void 0 : _b.replace("_", " ")) || "—" },
                            { l: "RÉGIMEN FISCAL", v: isMX ? "SAT · LISR · IMSS" : "IRS FED. + CA FTB", c: color },
                        ].map(t => (React.createElement("div", { key: t.l },
                            React.createElement("div", { style: { fontSize: 8, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em", marginBottom: 2 } }, t.l),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: t.c || DS.textMid } }, t.v)))))),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } },
                        React.createElement("button", { onClick: () => openEdit(loc), style: {
                                display: "inline-flex", alignItems: "center", gap: 6,
                                padding: "6px 14px", border: `1px solid ${DS.glow}44`,
                                background: `${DS.glow}10`, color: DS.glow,
                                fontFamily: DS.mono, fontSize: 10, fontWeight: 700, cursor: "pointer", borderRadius: 1,
                            } },
                            React.createElement(Edit, { size: 11 }),
                            " EDITAR"),
                        React.createElement("button", { onClick: () => setDeleteConfirm(loc), style: {
                                display: "inline-flex", alignItems: "center", gap: 6,
                                padding: "6px 14px", border: `1px solid ${DS.glowRed}44`,
                                background: `${DS.glowRed}08`, color: DS.glowRed,
                                fontFamily: DS.mono, fontSize: 10, fontWeight: 700, cursor: "pointer", borderRadius: 1,
                            } },
                            React.createElement(Trash2, { size: 11 }),
                            " BAJA"))));
            }),
            db.locations.length === 0 && (React.createElement("div", { style: { padding: "40px", textAlign: "center", border: `1px dashed ${DS.border}`, background: DS.surface } },
                React.createElement(MapPin, { size: 32, color: DS.textDim, style: { margin: "0 auto 12px" } }),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textDim } }, "SIN UBICACIONES REGISTRADAS"),
                React.createElement("button", { onClick: openNew, style: { marginTop: 16, padding: "8px 20px", background: `${DS.glow}18`, border: `1px solid ${DS.glow}44`, color: DS.glow, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer", borderRadius: 1 } }, "+ REGISTRAR PRIMERA UBICACI\u00D3N")))),
        modal && (React.createElement("div", { style: {
                position: "fixed", inset: 0, background: "rgba(3,7,18,.9)",
                display: "flex", alignItems: "center", justifyContent: "center",
                zIndex: 1000, backdropFilter: "blur(8px)",
            }, onClick: () => setModal(false) },
            React.createElement("div", { style: {
                    background: DS.bgAlt, border: `1px solid ${DS.borderHi}`,
                    borderRadius: 2, width: 580, maxHeight: "90vh", overflowY: "auto",
                    padding: 28, position: "relative",
                    boxShadow: `0 0 40px ${DS.glow}18`,
                }, onClick: e => e.stopPropagation() },
                React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 12 }),
                React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 12 }),
                React.createElement(HudCorner, { pos: "bl", color: DS.glow, size: 12 }),
                React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 12 }),
                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 } },
                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                        React.createElement("div", { style: { width: 2, height: 16, background: DS.glow, boxShadow: glow(DS.glow) } }),
                        React.createElement(MapPin, { size: 14, color: DS.glow }),
                        React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, editMode ? "EDITAR GEOCERCA" : "ALTA DE NUEVA UBICACIÓN")),
                    React.createElement("button", { onClick: () => setModal(false), style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer", display: "flex" } },
                        React.createElement(X, { size: 16 }))),
                React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 } },
                    React.createElement("div", { style: { gridColumn: "1/-1" } },
                        React.createElement(Input, { label: "Nombre de la Sucursal / Sede *", value: form.name, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { name: v }))), placeholder: "Ej: Oficina Monterrey Norte", required: true })),
                    React.createElement("div", { style: { gridColumn: "1/-1" } },
                        React.createElement(Input, { label: "Direcci\u00F3n Completa", value: form.address, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { address: v }))), placeholder: "Av. Principal 100, Colonia, Ciudad, CP" })),
                    React.createElement(Input, { label: "Latitud *", value: form.lat, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { lat: v }))), placeholder: "19.4326" }),
                    React.createElement(Input, { label: "Longitud *", value: form.lng, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { lng: v }))), placeholder: "-99.1332" }),
                    React.createElement(Input, { label: "Radio de Geocerca (metros)", type: "number", value: form.radius, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { radius: v }))) }),
                    React.createElement(Input, { label: "Pa\u00EDs / R\u00E9gimen Fiscal", type: "select", value: form.country, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { country: v, timezone: defaultTzByCountry[v] || p.timezone }))), options: countryOpts }),
                    React.createElement("div", { style: { gridColumn: "1/-1" } },
                        React.createElement(Input, { label: "Zona Horaria", type: "select", value: form.timezone, onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { timezone: v }))), options: tzOpts }))),
                React.createElement("div", { style: { margin: "16px 0", padding: "10px 14px", background: `${DS.glow}08`, border: `1px solid ${DS.glow}22`, display: "flex", gap: 8, alignItems: "flex-start" } },
                    React.createElement(Satellite, { size: 12, color: DS.glow, style: { marginTop: 1, flexShrink: 0 } }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim, lineHeight: 1.6 } }, "Para obtener coordenadas exactas: Google Maps \u2192 clic derecho \u2192 \"\u00BFQu\u00E9 hay aqu\u00ED?\" \u00B7 El radio define el per\u00EDmetro de la geocerca para registro autom\u00E1tico desde la app m\u00F3vil.")),
                React.createElement("div", { style: { padding: "10px 14px", background: DS.surface, border: `1px solid ${DS.border}`, marginBottom: 20 } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.1em", marginBottom: 8 } }, "R\u00C9GIMEN FISCAL APLICABLE"),
                    form.country === "MX" && (React.createElement("div", { style: { display: "flex", gap: 16 } }, [["ISR Art. 96", "1.92–35%", DS.glowRed], ["IMSS Empleado", "~2.1%", DS.glowPurple], ["Subsidio Emp.", "Art. 113 LISR", DS.glowGreen]].map(([l, v, c]) => (React.createElement("div", { key: l },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, l),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: c, marginTop: 2 } }, v)))))),
                    form.country === "US" && (React.createElement("div", { style: { display: "flex", gap: 16 } }, [["IRS Federal", "10–37%", DS.glowRed], ["FICA SS+Med", "7.65%", DS.glowAmber], ["CA State FTB", "1–12.3%", DS.glowPurple], ["CA SDI", "1.1%", DS.glow]].map(([l, v, c]) => (React.createElement("div", { key: l },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, l),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: c, marginTop: 2 } }, v)))))),
                    form.country === "RD" && (React.createElement("div", { style: { display: "flex", gap: 16 } }, [["ISR DGII", "0–25% (Ley 11-92)", DS.glowRed], ["SFS Salud", "3.04% (TSS)", DS.glowPurple], ["AFP Pensiones", "2.87% (TSS)", DS.glowAmber]].map(([l, v, c]) => (React.createElement("div", { key: l },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, l),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: c, marginTop: 2 } }, v)))))),
                    form.country === "SV" && (React.createElement("div", { style: { display: "flex", gap: 16 } }, [["ISR MH", "0–30% (Decreto Nº10)", DS.glowRed], ["ISSS Salud", "3% tope $30", DS.glowAmber], ["AFP Pensiones", "7.25%", DS.glowPurple]].map(([l, v, c]) => (React.createElement("div", { key: l },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, l),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: c, marginTop: 2 } }, v))))))),
                React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "flex-end" } },
                    React.createElement("button", { onClick: () => setModal(false), style: {
                            display: "inline-flex", alignItems: "center", gap: 6, padding: "9px 18px",
                            border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim,
                            fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer", borderRadius: 1,
                        } },
                        React.createElement(X, { size: 13 }),
                        " CANCELAR"),
                    React.createElement("button", { onClick: handleSave, disabled: !form.name || !form.lat || !form.lng, style: {
                            display: "inline-flex", alignItems: "center", gap: 6, padding: "9px 18px",
                            border: `1px solid ${DS.glowGreen}66`, background: `${DS.glowGreen}18`, color: DS.glowGreen,
                            fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer", borderRadius: 1,
                            opacity: (!form.name || !form.lat || !form.lng) ? 0.5 : 1,
                        } },
                        React.createElement(CheckCircle, { size: 13 }),
                        " ",
                        editMode ? "ACTUALIZAR" : "GUARDAR UBICACIÓN"))))),
        deleteConfirm && (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.85)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1001, backdropFilter: "blur(8px)" } },
            React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.glowRed}55`, padding: 28, width: 400, position: "relative" } },
                React.createElement(HudCorner, { pos: "tl", color: DS.glowRed, size: 10 }),
                React.createElement(HudCorner, { pos: "br", color: DS.glowRed, size: 10 }),
                React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.glowRed, letterSpacing: "0.1em", marginBottom: 12 } }, "CONFIRMAR ELIMINACI\u00D3N"),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid, lineHeight: 1.7, marginBottom: 20 } },
                    "\u00BFEliminar la ubicaci\u00F3n ",
                    React.createElement("span", { style: { color: DS.glowRed, fontWeight: 700 } }, deleteConfirm.name),
                    "?",
                    React.createElement("br", null),
                    "Los empleados asignados quedar\u00E1n sin sede activa."),
                React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "flex-end" } },
                    React.createElement("button", { onClick: () => setDeleteConfirm(null), style: { padding: "7px 16px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 11, cursor: "pointer", borderRadius: 1 } }, "CANCELAR"),
                    React.createElement("button", { onClick: () => handleDelete(deleteConfirm), style: { padding: "7px 16px", border: `1px solid ${DS.glowRed}66`, background: `${DS.glowRed}18`, color: DS.glowRed, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer", borderRadius: 1 } }, "ELIMINAR")))))));
};
// ── Payroll Result Modal ──────────────────────────────────────
const PayrollResultModal = ({ data, onClose, savePayrollCut }) => {
    const [tab, setTab] = useState("employees");
    const [expanded, setExpanded] = useState(null);
    const { emps, form, db } = data;
    const results = emps.map(e => ({ emp: e, calc: calcPayroll(e) }));
    const totalGross = results.reduce((s, r) => s + r.calc.base, 0);
    const totalDed = results.reduce((s, r) => s + r.calc.totalDed, 0);
    const totalNet = results.reduce((s, r) => s + r.calc.net, 0);
    const byLoc = (db.locations || []).map(loc => {
        const locR = results.filter(r => r.emp.location === loc.id);
        if (!locR.length)
            return null;
        const g = locR.reduce((s, r) => s + r.calc.base, 0), d = locR.reduce((s, r) => s + r.calc.totalDed, 0), n = locR.reduce((s, r) => s + r.calc.net, 0);
        return { loc, results: locR, gross: g, ded: d, net: n };
    }).filter(Boolean);
    const handleConfirm = async () => {
        await savePayrollCut({
            period: `${form.from || "—"} al ${form.to || "—"}`,
            type: form.type, country: form.country,
            employees: emps.length,
            grossTotal: totalGross, totalDed, netTotal: totalNet,
            status: "pendiente", date: new Date().toISOString().slice(0, 10),
            createdBy: "admin",
        });
        onClose();
    };
    const TABS = [
        { id: "employees", label: "POR EMPLEADO", icon: Users },
        { id: "locations", label: "POR UBICACIÓN", icon: MapPin },
        { id: "summary", label: "RESUMEN FISCAL", icon: BarChart3 },
    ];
    return (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.92)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 2000, backdropFilter: "blur(10px)", padding: 20 } },
        React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.borderHi}`, borderRadius: 2, width: "100%", maxWidth: 1000, maxHeight: "93vh", display: "flex", flexDirection: "column", boxShadow: `0 0 60px rgba(0,212,255,.08)` } },
            React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 14 }),
            React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 14 }),
            React.createElement("div", { style: { padding: "20px 28px", borderBottom: `1px solid ${DS.border}`, flexShrink: 0 } },
                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "flex-start" } },
                    React.createElement("div", null,
                        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 14 } },
                            React.createElement("div", { style: { width: 2, height: 20, background: DS.glow, boxShadow: glow(DS.glow) } }),
                            React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 18, fontWeight: 800, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, "RESULTADOS DEL CORTE DE N\u00D3MINA"),
                            React.createElement(Chip, { color: DS.glowAmber }, form.type.toUpperCase())),
                        React.createElement("div", { style: { display: "flex", gap: 28 } }, [
                            { l: "BRUTO TOTAL", v: `$${Math.round(totalGross).toLocaleString()}`, c: DS.text },
                            { l: "RETENCIONES", v: `-$${Math.round(totalDed).toLocaleString()}`, c: DS.glowRed },
                            { l: "NETO A DISPERSAR", v: `$${Math.round(totalNet).toLocaleString()}`, c: DS.glowGreen },
                            { l: "EMPLEADOS", v: results.length, c: DS.glow },
                            { l: "TASA EFECTIVA", v: `${((totalDed / totalGross) * 100).toFixed(1)}%`, c: DS.glowAmber },
                        ].map(k => (React.createElement("div", { key: k.l },
                            React.createElement("div", { style: { fontSize: 8, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.12em", marginBottom: 3 } }, k.l),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 16, fontWeight: 900, color: k.c } }, k.v)))))),
                    React.createElement("button", { onClick: onClose, style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer" } },
                        React.createElement(X, { size: 18 }))),
                React.createElement("div", { style: { display: "flex", gap: 4, marginTop: 16 } }, TABS.map(t => (React.createElement("button", { key: t.id, onClick: () => setTab(t.id), style: {
                        display: "flex", alignItems: "center", gap: 6, padding: "6px 16px", borderRadius: 1, border: "none", cursor: "pointer",
                        background: tab === t.id ? `${DS.glow}20` : "transparent",
                        color: tab === t.id ? DS.glow : DS.textDim,
                        fontFamily: DS.mono, fontSize: 11, fontWeight: 700, letterSpacing: "0.08em",
                        borderBottom: tab === t.id ? `2px solid ${DS.glow}` : "2px solid transparent",
                    } },
                    React.createElement(t.icon, { size: 12 }),
                    t.label))))),
            React.createElement("div", { style: { flex: 1, overflowY: "auto", padding: "20px 28px" } },
                tab === "employees" && (React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } }, results.map(({ emp, calc }) => {
                    const isMX = emp.country === "MX";
                    const dept = db.departments.find(d => d.id === emp.dept);
                    const isExp = expanded === emp.id;
                    const color = isMX ? DS.glowGreen : DS.glow;
                    return (React.createElement("div", { key: emp.id, style: { border: `1px solid ${isExp ? color + "55" : DS.border}`, background: DS.surface } },
                        React.createElement("div", { onClick: () => setExpanded(isExp ? null : emp.id), style: { display: "grid", gridTemplateColumns: "2fr 1fr 1fr 1fr 1fr 1fr 28px", alignItems: "center", padding: "12px 16px", cursor: "pointer", gap: 8 } },
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                                React.createElement(Avatar, { initials: emp.avatar, color: (dept === null || dept === void 0 ? void 0 : dept.color) || color, size: 30 }),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 12, fontWeight: 700, color: DS.text } }, emp.name),
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, emp.role))),
                            React.createElement(Chip, { color: color }, isMX ? "SAT MX" : "IRS+CA"),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "BRUTO"),
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 12, color: DS.text } },
                                    calc.currency,
                                    " $",
                                    calc.base.toLocaleString())),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "DEDUC."),
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 12, color: DS.glowRed } },
                                    "-$",
                                    calc.totalDed.toLocaleString())),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "NETO"),
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 13, fontWeight: 800, color: DS.glowGreen } },
                                    "$",
                                    calc.net.toLocaleString())),
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } },
                                React.createElement("div", { style: { width: 36, height: 3, background: DS.bg } },
                                    React.createElement("div", { style: { height: "100%", width: `${calc.effectiveRate}%`, background: DS.glowAmber } })),
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.glowAmber } },
                                    calc.effectiveRate,
                                    "%")),
                            React.createElement("div", { style: { color: isExp ? DS.glow : DS.textDim, display: "flex" } }, isExp ? React.createElement(ChevronUp, { size: 14 }) : React.createElement(ChevronDown, { size: 14 }))),
                        isExp && (React.createElement("div", { style: { borderTop: `1px solid ${DS.border}`, padding: "16px", display: "grid", gridTemplateColumns: "1fr 1fr", gap: 20, background: DS.bgAlt } },
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.12em", marginBottom: 10 } }, "DESGLOSE DE RETENCIONES"),
                                Object.entries(calc.deds).map(([k, v]) => {
                                    const isCredit = v < 0;
                                    return (React.createElement("div", { key: k, style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 7, paddingBottom: 7, borderBottom: `1px solid ${DS.border}33` } },
                                        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 7 } },
                                            React.createElement("div", { style: { width: 3, height: 14, background: isCredit ? DS.glowGreen : DS.glowRed } }),
                                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid } }, k)),
                                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: isCredit ? DS.glowGreen : DS.glowRed } },
                                            isCredit ? "+" : " -",
                                            calc.currency,
                                            " $",
                                            Math.abs(v).toLocaleString())));
                                }),
                                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginTop: 6, paddingTop: 6, borderTop: `1px solid ${DS.border}` } },
                                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: DS.text } }, "TOTAL RETENCIONES"),
                                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, fontWeight: 800, color: DS.glowRed } },
                                        "-",
                                        calc.currency,
                                        " $",
                                        calc.totalDed.toLocaleString()))),
                            React.createElement("div", null,
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.12em", marginBottom: 10 } }, "DISTRIBUCI\u00D3N SALARIAL"),
                                React.createElement("div", { style: { height: 20, display: "flex", marginBottom: 10, borderRadius: 1, overflow: "hidden" } },
                                    Object.entries(calc.deds).filter(([, v]) => v > 0).map(([k, v], i) => {
                                        const colors = [DS.glowRed, "#ff7043", "#ff9800", DS.glowAmber, "#cddc39"];
                                        return React.createElement("div", { key: k, title: `${k}: $${v}`, style: { width: `${(v / calc.base) * 100}%`, background: colors[i % colors.length] } });
                                    }),
                                    React.createElement("div", { style: { flex: 1, background: DS.glowGreen }, title: "Neto" })),
                                React.createElement("div", { style: { padding: "12px 14px", background: DS.surface, border: `1px solid ${DS.glowGreen}33`, marginTop: 10 } },
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "NETO A DEPOSITAR"),
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 22, fontWeight: 900, color: DS.glowGreen, marginTop: 4 } },
                                        calc.currency,
                                        " $",
                                        calc.net.toLocaleString())),
                                !isMX && (React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 8, marginTop: 10 } }, [["FED. RATE", calc.fedRate + "%"], ["CA RATE", calc.caRate + "%"], ["TOTAL", calc.effectiveRate + "%"]].map(([l, v]) => (React.createElement("div", { key: l, style: { padding: "8px", background: DS.surface, border: `1px solid ${DS.border}`, textAlign: "center" } },
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, l),
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 13, fontWeight: 800, color: DS.glowAmber } }, v)))))))))));
                }))),
                tab === "locations" && (React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 16 } }, byLoc.map(({ loc, results: lr, gross, ded, net }) => {
                    const isMX = loc.country === "MX";
                    const color = isMX ? DS.glowGreen : DS.glow;
                    const curr = isMX ? "MXN" : "USD";
                    const dedTypes = {};
                    lr.forEach(r => Object.entries(r.calc.deds).forEach(([k, v]) => { dedTypes[k] = (dedTypes[k] || 0) + Math.abs(v); }));
                    return (React.createElement(Panel, { key: loc.id, glowColor: color, noPad: true },
                        React.createElement("div", { style: { padding: "16px 20px", borderBottom: `1px solid ${DS.border}`, display: "flex", justifyContent: "space-between", alignItems: "center", background: `${color}06` } },
                            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 14 } },
                                React.createElement(Navigation, { size: 18, color: color }),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 15, fontWeight: 800, color: DS.text, letterSpacing: "0.1em", textTransform: "uppercase" } }, loc.name),
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim } }, loc.address),
                                    React.createElement(Chip, { color: color, style: { marginTop: 4 } }, isMX ? "SAT MÉXICO · LISR + LSS" : "IRS FEDERAL + CA FTB + SDI 2025"))),
                            React.createElement("div", { style: { display: "flex", gap: 20 } }, [
                                { l: "EMP.", v: lr.length, c: DS.text },
                                { l: "BRUTO", v: `${curr} $${Math.round(gross).toLocaleString()}`, c: DS.text },
                                { l: "IMPUESTOS", v: `-$${Math.round(ded).toLocaleString()}`, c: DS.glowRed },
                                { l: "NETO", v: `${curr} $${Math.round(net).toLocaleString()}`, c: DS.glowGreen },
                            ].map(k => (React.createElement("div", { key: k.l, style: { textAlign: "right" } },
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.12em" } }, k.l),
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 14, fontWeight: 800, color: k.c } }, k.v)))))),
                        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 0 } },
                            React.createElement("div", { style: { padding: "16px 20px", borderRight: `1px solid ${DS.border}` } },
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.12em", marginBottom: 12 } }, "RETENCIONES POR CONCEPTO"),
                                Object.entries(dedTypes).map(([k, v]) => {
                                    const pct = ((v / gross) * 100).toFixed(1);
                                    return (React.createElement("div", { key: k, style: { marginBottom: 8 } },
                                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 3 } },
                                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid } }, k),
                                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowRed, fontWeight: 700 } },
                                                "-",
                                                curr,
                                                " $",
                                                Math.round(v).toLocaleString(),
                                                " ",
                                                React.createElement("span", { style: { color: DS.textDim, fontWeight: 400 } },
                                                    "(",
                                                    pct,
                                                    "%)"))),
                                        React.createElement("div", { style: { height: 2, background: DS.bg } },
                                            React.createElement("div", { style: { height: "100%", width: `${(v / ded) * 100}%`, background: DS.glowRed } }))));
                                })),
                            React.createElement("div", { style: { padding: "16px 20px" } },
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.12em", marginBottom: 12 } },
                                    "EMPLEADOS (",
                                    lr.length,
                                    ")"),
                                lr.map(({ emp, calc }) => (React.createElement("div", { key: emp.id, style: { display: "flex", justifyContent: "space-between", alignItems: "center", padding: "7px 10px", background: DS.bg, border: `1px solid ${DS.border}`, marginBottom: 6 } },
                                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                                        React.createElement(Avatar, { initials: emp.avatar, color: color, size: 24 }),
                                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.text } }, emp.name)),
                                    React.createElement("div", { style: { textAlign: "right" } },
                                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 12, fontWeight: 700, color: DS.glowGreen } },
                                            "$",
                                            calc.net.toLocaleString()),
                                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } },
                                            "de $",
                                            calc.base.toLocaleString()))))),
                                React.createElement("div", { style: { height: 16, display: "flex", marginTop: 10, borderRadius: 1, overflow: "hidden" } },
                                    React.createElement("div", { style: { width: `${(net / gross) * 100}%`, background: DS.glowGreen } }),
                                    React.createElement("div", { style: { flex: 1, background: DS.glowRed } })),
                                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginTop: 4 } },
                                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.glowGreen } },
                                        "NETO ",
                                        ((net / gross) * 100).toFixed(1),
                                        "%"),
                                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.glowRed } },
                                        "IMPUESTOS ",
                                        ((ded / gross) * 100).toFixed(1),
                                        "%"))))));
                }))),
                tab === "summary" && (React.createElement("div", null,
                    React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16, marginBottom: 20 } }, [
                        { country: "MX", flag: "MX", label: "MÉXICO — SAT LISR + LSS", color: DS.glowGreen, curr: "MXN" },
                        { country: "US", flag: "US", label: "CALIFORNIA — IRS + CA FTB", color: DS.glow, curr: "USD" },
                    ].map(({ country, flag, label, color, curr }) => {
                        const r = results.filter(x => x.emp.country === country);
                        if (!r.length)
                            return React.createElement("div", { key: country, style: { padding: 20, border: `1px solid ${DS.border}`, display: "flex", alignItems: "center", justifyContent: "center" } },
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textDim } }, "SIN EMPLEADOS EN ESTE R\u00C9GIMEN"));
                        const g = r.reduce((s, x) => s + x.calc.base, 0), d = r.reduce((s, x) => s + x.calc.totalDed, 0), n = r.reduce((s, x) => s + x.calc.net, 0);
                        const dedByType = {};
                        r.forEach(x => Object.entries(x.calc.deds).forEach(([k, v]) => { dedByType[k] = (dedByType[k] || 0) + Math.abs(v); }));
                        return (React.createElement(Panel, { key: country, glowColor: color },
                            React.createElement("div", { style: { display: "flex", gap: 10, alignItems: "center", marginBottom: 16 } },
                                React.createElement(Chip, { color: color }, flag),
                                React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 13, fontWeight: 700, color: DS.text, letterSpacing: "0.08em" } }, label),
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim } },
                                    r.length,
                                    " emp.")),
                            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 10, marginBottom: 16 } }, [["BRUTO", g, DS.text], ["DEDUC.", d, DS.glowRed], ["NETO", n, DS.glowGreen]].map(([l, v, c]) => (React.createElement("div", { key: l, style: { padding: "10px 12px", background: DS.bgAlt, border: `1px solid ${DS.border}` } },
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.1em" } }, l),
                                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 14, fontWeight: 800, color: c, marginTop: 4 } },
                                    curr,
                                    " $",
                                    Math.round(v).toLocaleString()))))),
                            Object.entries(dedByType).sort((a, b) => b[1] - a[1]).map(([k, v]) => (React.createElement("div", { key: k, style: { display: "flex", justifyContent: "space-between", marginBottom: 7 } },
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textMid } }, k),
                                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                                    React.createElement("div", { style: { width: 50, height: 3, background: DS.bg } },
                                        React.createElement("div", { style: { height: "100%", width: `${(v / d) * 100}%`, background: color } })),
                                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.glowRed, fontWeight: 700 } },
                                        "-",
                                        curr,
                                        " $",
                                        Math.round(v).toLocaleString())))))));
                    })),
                    React.createElement(Panel, null,
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.12em", marginBottom: 16 } }, "DISTRIBUCI\u00D3N SALARIAL \u2014 TODOS LOS EMPLEADOS"),
                        results.sort((a, b) => b.calc.net - a.calc.net).map(({ emp, calc }) => {
                            var _a;
                            return (React.createElement("div", { key: emp.id, style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 7 } },
                                React.createElement("div", { style: { width: 120, fontFamily: DS.mono, fontSize: 10, color: DS.textMid, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" } },
                                    emp.name.split(" ")[0],
                                    " ", (_a = emp.name.split(" ")[1]) === null || _a === void 0 ? void 0 :
                                    _a[0],
                                    "."),
                                React.createElement("div", { style: { flex: 1, height: 16, display: "flex", borderRadius: 0, overflow: "hidden" } },
                                    React.createElement("div", { style: { width: `${(calc.net / calc.base) * 100}%`, background: emp.country === "MX" ? `${DS.glowGreen}cc` : `${DS.glow}cc` } }),
                                    React.createElement("div", { style: { flex: 1, background: `${DS.glowRed}44` } })),
                                React.createElement("div", { style: { width: 130, display: "flex", justifyContent: "space-between", fontFamily: DS.mono, fontSize: 10 } },
                                    React.createElement("span", { style: { color: DS.glowGreen } },
                                        "$",
                                        calc.net.toLocaleString()),
                                    React.createElement("span", { style: { color: DS.textDim } },
                                        "/",
                                        calc.base.toLocaleString()))));
                        }))))),
            React.createElement("div", { style: { padding: "14px 28px", borderTop: `1px solid ${DS.border}`, display: "flex", justifyContent: "space-between", alignItems: "center", flexShrink: 0, background: DS.surface } },
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "C\u00C1LCULO ESTIMADO \u00B7 SAT LISR 2025 \u00B7 IRS PUB. 15-T 2025 \u00B7 CA FTB 2025 \u00B7 SINGLE FILER"),
                React.createElement("div", { style: { display: "flex", gap: 10 } },
                    React.createElement(Btn, { icon: Download, color: DS.textDim, variant: "ghost", size: "sm" }, "EXPORTAR"),
                    React.createElement(Btn, { onClick: handleConfirm, icon: CheckCircle, color: DS.glowGreen }, "CONFIRMAR Y GUARDAR CORTE"))))));
};
const ViewPayroll = ({ db, savePayrollCut }) => {
    const [showCut, setShowCut] = useState(false);
    const [cutForm, setCutForm] = useState({ type: "quincenal", from: "", to: "", country: "MX" });
    const [payrollResult, setPayrollResult] = useState(null);
    const [filterCountry, setFilterCountry] = useState("all");
    const activeEmps = ((db === null || db === void 0 ? void 0 : db.employees) || []).filter(e => e.status === "active");
    const filtered = filterCountry === "all" ? activeEmps : activeEmps.filter(e => e.country === filterCountry);
    const handleProcess = () => {
        const emps = activeEmps.filter(e => (cutForm.country === "all" || e.country === cutForm.country) &&
            (cutForm.type === "all" || e.payroll === cutForm.type));
        setPayrollResult({ emps, form: Object.assign({}, cutForm), db });
        setShowCut(false);
    };
    if (!db)
        return null;
    return (React.createElement("div", null,
        React.createElement(SectionHeader, { icon: DollarSign, label: "N\u00F3mina & Motor Fiscal", action: React.createElement(Btn, { onClick: () => setShowCut(true), icon: Zap, color: DS.glowAmber }, "NUEVO CORTE") }),
        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr 1fr", gap: 12, marginBottom: 20 } }, [
            { country: "MX", flag: "🇲🇽", label: "SAT MÉXICO", sub: "LISR · IMSS 2025", color: DS.glowGreen, curr: "MXN",
                items: [{ l: "ISR", v: "1.92–35%" }, { l: "IMSS", v: "~2.1%" }, { l: "Subsidio", v: "Art.113" }] },
            { country: "US", flag: "🇺🇸", label: "IRS + CALIFORNIA", sub: "IRS Pub.15-T · FTB 2025", color: DS.glow, curr: "USD",
                items: [{ l: "Fed IRS", v: "10–37%" }, { l: "FICA", v: "7.65%" }, { l: "CA State", v: "1–12.3%" }] },
            { country: "RD", flag: "🇩🇴", label: "DGII RD", sub: "Ley 11-92 · TSS 2025", color: DS.glowAmber, curr: "DOP",
                items: [{ l: "ISR", v: "0–25%" }, { l: "SFS", v: "3.04%" }, { l: "AFP", v: "2.87%" }] },
            { country: "SV", flag: "🇸🇻", label: "MH EL SALVADOR", sub: "Decreto Nº10 · 2025", color: DS.glowPurple, curr: "USD",
                items: [{ l: "ISR", v: "0–30%" }, { l: "ISSS", v: "3% (tope $30)" }, { l: "AFP", v: "7.25%" }] },
        ].map(({ country, flag, label, sub, color, curr, items }) => {
            const r = activeEmps.filter(e => e.country === country);
            const net = r.reduce((s, e) => s + calcPayroll(e).net, 0);
            return (React.createElement(Panel, { key: country, glowColor: color, style: { overflow: "hidden" } },
                React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 10 } },
                    React.createElement("div", null,
                        React.createElement("div", { style: { display: "flex", gap: 6, alignItems: "center", marginBottom: 3 } },
                            React.createElement("span", { style: { fontSize: 14 } }, flag),
                            React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 11, fontWeight: 800, color: DS.text, letterSpacing: "0.08em", textTransform: "uppercase" } }, label)),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, sub))),
                React.createElement("div", { style: { marginBottom: 10 } },
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, "NETO PER\u00CDODO"),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 16, fontWeight: 900, color: DS.glowGreen } },
                        curr,
                        " $",
                        Math.round(net).toLocaleString()),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } },
                        r.length,
                        " empleados")),
                React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr", gap: 5 } }, items.map(item => (React.createElement("div", { key: item.l, style: { padding: "5px 8px", background: DS.bgAlt, border: `1px solid ${DS.border}`, display: "flex", justifyContent: "space-between" } },
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, item.l),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, fontWeight: 700, color } }, item.v)))))));
        })),
        React.createElement(Panel, { noPad: true },
            React.createElement("div", { style: { padding: "12px 18px", borderBottom: `1px solid ${DS.border}`, display: "flex", justifyContent: "space-between", alignItems: "center" } },
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                    React.createElement(ClipboardList, { size: 13, color: DS.glow }),
                    React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textMid, letterSpacing: "0.1em" } }, "C\u00C1LCULO POR EMPLEADO")),
                React.createElement("div", { style: { display: "flex", gap: 6 } }, [["all", "TODOS"], ["MX", "🇲🇽 MX"], ["US", "🇺🇸 US"], ["RD", "🇩🇴 RD"], ["SV", "🇸🇻 SV"]].map(([v, l]) => (React.createElement("button", { key: v, onClick: () => setFilterCountry(v), style: {
                        padding: "4px 12px", border: "none", cursor: "pointer", fontFamily: DS.mono, fontSize: 9, fontWeight: 700,
                        background: filterCountry === v ? `${DS.glow}22` : "transparent",
                        color: filterCountry === v ? DS.glow : DS.textDim,
                        borderBottom: filterCountry === v ? `2px solid ${DS.glow}` : "2px solid transparent",
                    } }, l))))),
            React.createElement(Table, { cols: [
                    { key: "name", label: "Empleado", render: row => {
                            const dept = db.departments.find(d => d.id === row.dept);
                            return React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } },
                                React.createElement(Avatar, { initials: row.avatar, color: (dept === null || dept === void 0 ? void 0 : dept.color) || DS.glow, size: 28 }),
                                React.createElement("div", null,
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: DS.text } }, row.name),
                                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, row.payroll)));
                        } },
                    { key: "regime", label: "Régimen", render: row => {
                            const color = row.country === "MX" ? DS.glowGreen : row.country === "RD" ? DS.glowAmber : row.country === "SV" ? DS.glowPurple : DS.glow;
                            const label = row.country === "MX" ? "SAT MX" : row.country === "RD" ? "DGII RD" : row.country === "SV" ? "MH SV" : "IRS+CA";
                            return React.createElement(Chip, { color: color }, label);
                        } },
                    { key: "loc", label: "Ubicación", render: row => { const loc = db.locations.find(l => l.id === row.location); return React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textMid } }, (loc === null || loc === void 0 ? void 0 : loc.name) || "—"); } },
                    { key: "gross", label: "Bruto", render: row => { const c = calcPayroll(row); return React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, color: DS.text } },
                            c.currency,
                            " $",
                            c.base.toLocaleString()); } },
                    { key: "ded", label: "Deduc.", render: row => { const c = calcPayroll(row); return React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, color: DS.glowRed } },
                            "-$",
                            c.totalDed.toLocaleString()); } },
                    { key: "net", label: "Neto", render: row => { const c = calcPayroll(row); return React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 13, fontWeight: 800, color: DS.glowGreen } },
                            "$",
                            c.net.toLocaleString()); } },
                    { key: "rate", label: "Tasa Ef.", render: row => { const c = calcPayroll(row); return React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } },
                            React.createElement("div", { style: { width: 40, height: 3, background: DS.bg } },
                                React.createElement("div", { style: { height: "100%", width: `${c.effectiveRate}%`, background: DS.glowAmber } })),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.glowAmber } },
                                c.effectiveRate,
                                "%")); } },
                ], rows: filtered })),
        React.createElement(Panel, { style: { marginTop: 16 } },
            React.createElement(SectionHeader, { icon: FileText, label: "Historial de Cortes" }),
            React.createElement(Table, { cols: [
                    { key: "period", label: "Período", render: row => React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.text } }, row.period) },
                    { key: "type", label: "Tipo", render: row => React.createElement(Chip, { color: DS.glowAmber }, row.type) },
                    { key: "country", label: "Régimen", render: row => {
                            const color = row.country === "MX" ? DS.glowGreen : row.country === "US" ? DS.glow : row.country === "RD" ? DS.glowAmber : row.country === "SV" ? DS.glowPurple : DS.textMid;
                            const label = row.country === "all" ? "GLOBAL" : row.country === "MX" ? "SAT MX" : row.country === "RD" ? "DGII RD" : row.country === "SV" ? "MH SV" : "IRS+CA";
                            return React.createElement(Chip, { color: color }, label);
                        } },
                    { key: "employees", label: "Emp.", mono: true },
                    { key: "grossTotal", label: "Bruto", render: row => React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, color: DS.text } },
                            "$",
                            row.grossTotal.toLocaleString()) },
                    { key: "totalDed", label: "Deduc.", render: row => React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, color: DS.glowRed } },
                            "-$",
                            row.totalDed.toLocaleString()) },
                    { key: "netTotal", label: "Neto", render: row => React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 13, fontWeight: 800, color: DS.glowGreen } },
                            "$",
                            row.netTotal.toLocaleString()) },
                    { key: "status", label: "Estado", render: row => React.createElement("div", { style: { display: "flex", gap: 5, alignItems: "center" } },
                            React.createElement(StatusDot, { status: row.status }),
                            React.createElement(Chip, { color: row.status === "pagado" ? DS.glowGreen : DS.glowAmber }, row.status.toUpperCase())) },
                    { key: "date", label: "Fecha", mono: true },
                ], rows: db.payrollCuts })),
        showCut && (React.createElement(Modal, { title: "CONFIGURAR CORTE DE N\u00D3MINA", onClose: () => setShowCut(false) },
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 } },
                React.createElement(Input, { label: "Pa\u00EDs / R\u00E9gimen", type: "select", value: cutForm.country, onChange: v => setCutForm(p => (Object.assign(Object.assign({}, p), { country: v }))), options: [{ v: "MX", l: "🇲🇽 México (SAT)" }, { v: "US", l: "🇺🇸 California (IRS+FTB)" }, { v: "RD", l: "🇩🇴 República Dominicana (DGII)" }, { v: "SV", l: "🇸🇻 El Salvador (MH)" }, { v: "all", l: "🌎 Todos los países" }] }),
                React.createElement(Input, { label: "Tipo de N\u00F3mina", type: "select", value: cutForm.type, onChange: v => setCutForm(p => (Object.assign(Object.assign({}, p), { type: v }))), options: [{ v: "semanal", l: "Semanal" }, { v: "quincenal", l: "Quincenal" }, { v: "biweekly", l: "Biweekly (US)" }, { v: "mensual", l: "Mensual" }, { v: "all", l: "Todos" }] }),
                React.createElement(Input, { label: "Fecha Inicio", type: "date", value: cutForm.from, onChange: v => setCutForm(p => (Object.assign(Object.assign({}, p), { from: v }))) }),
                React.createElement(Input, { label: "Fecha Fin", type: "date", value: cutForm.to, onChange: v => setCutForm(p => (Object.assign(Object.assign({}, p), { to: v }))) })),
            React.createElement("div", { style: { margin: "16px 0", background: DS.bgAlt, border: `1px solid ${DS.border}`, padding: "12px 16px" } },
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.1em", marginBottom: 10 } }, "PREVISUALIZACI\u00D3N"),
                [
                    { c: "MX", l: "🇲🇽 SAT MX", col: DS.glowGreen, curr: "MXN" },
                    { c: "US", l: "🇺🇸 IRS+CA", col: DS.glow, curr: "USD" },
                    { c: "RD", l: "🇩🇴 DGII RD", col: DS.glowAmber, curr: "DOP" },
                    { c: "SV", l: "🇸🇻 MH SV", col: DS.glowPurple, curr: "USD" },
                ].map(({ c, l, col, curr }) => {
                    if (cutForm.country !== "all" && cutForm.country !== c)
                        return null;
                    const emps = activeEmps.filter(e => e.country === c && (cutForm.type === "all" || e.payroll === cutForm.type));
                    const net = emps.reduce((s, e) => s + calcPayroll(e).net, 0);
                    const gross = emps.reduce((s, e) => s + calcPayroll(e).base, 0);
                    const ded = emps.reduce((s, e) => s + calcPayroll(e).totalDed, 0);
                    return (React.createElement("div", { key: c, style: { display: "flex", justifyContent: "space-between", alignItems: "center", padding: "8px 0", borderBottom: `1px solid ${DS.border}33` } },
                        React.createElement("div", { style: { display: "flex", gap: 8, alignItems: "center" } },
                            React.createElement(Chip, { color: col }, l),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim } },
                                emps.length,
                                " emp.")),
                        React.createElement("div", { style: { display: "flex", gap: 16 } },
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.text } },
                                curr,
                                " $",
                                Math.round(gross).toLocaleString()),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowRed } },
                                "-$",
                                Math.round(ded).toLocaleString()),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 12, fontWeight: 800, color: DS.glowGreen } },
                                "$",
                                Math.round(net).toLocaleString()))));
                })),
            React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "flex-end" } },
                React.createElement(Btn, { onClick: () => setShowCut(false), color: DS.textDim, variant: "ghost", icon: X }, "CANCELAR"),
                React.createElement(Btn, { onClick: handleProcess, icon: Zap, color: DS.glowAmber }, "PROCESAR CORTE")))),
        payrollResult && React.createElement(PayrollResultModal, { data: payrollResult, onClose: () => setPayrollResult(null), savePayrollCut: savePayrollCut })));
};
const ViewBI = ({ db }) => {
    if (!db)
        return null;
    const depts = db.departments;
    const empsByDept = depts.map(d => ({ dept: d, count: db.employees.filter(e => e.dept === d.id && e.status === "active").length }));
    const totalNet = db.employees.filter(e => e.status === "active").reduce((s, e) => s + calcPayroll(e).net, 0);
    const totalGross = db.employees.filter(e => e.status === "active").reduce((s, e) => s + calcPayroll(e).base, 0);
    return (React.createElement("div", null,
        React.createElement(SectionHeader, { icon: BarChart3, label: "Reportes de Inteligencia", action: React.createElement("div", { style: { display: "flex", gap: 8 } },
                React.createElement(Btn, { icon: Download, color: DS.textDim, variant: "ghost", size: "sm" }, "CSV"),
                React.createElement(Btn, { icon: FileText, color: DS.textDim, variant: "ghost", size: "sm" }, "PDF")) }),
        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 14, marginBottom: 20 } },
            React.createElement(KpiCard, { icon: Activity, label: "Horas Semana", value: "2,448h", sub: "Todas las sedes", color: DS.glow, trend: 3 }),
            React.createElement(KpiCard, { icon: TrendingUp, label: "Asistencia Promedio", value: "89.2%", sub: "vs 87.4% sem. ant.", color: DS.glowGreen, trend: 2 }),
            React.createElement(KpiCard, { icon: AlertCircle, label: "Incidencias", value: "31", sub: "tardanzas + ausencias", color: DS.glowAmber, trend: -8 }),
            React.createElement(KpiCard, { icon: DollarSign, label: "Costo Total N\u00F3mina", value: `$${Math.round(totalNet / 1000)}k`, sub: "per\u00EDodo actual", color: DS.glowPurple })),
        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16, marginBottom: 16 } },
            React.createElement(Panel, null,
                React.createElement(SectionHeader, { icon: Building2, label: "Empleados por Departamento" }),
                empsByDept.sort((a, b) => b.count - a.count).map(({ dept, count }) => {
                    const maxC = Math.max(...empsByDept.map(x => x.count));
                    return (React.createElement("div", { key: dept.id, style: { marginBottom: 12 } },
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 4 } },
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid } }, dept.name),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: dept.color } },
                                count,
                                " EMP.")),
                        React.createElement("div", { style: { height: 4, background: DS.bgAlt } },
                            React.createElement("div", { style: { height: "100%", width: `${(count / maxC) * 100}%`, background: dept.color, boxShadow: `0 0 8px ${dept.color}66`, transition: "width 1s" } }))));
                })),
            React.createElement(Panel, null,
                React.createElement(SectionHeader, { icon: DollarSign, label: "Costo de N\u00F3mina por Depto." }),
                depts.map(dept => {
                    const emps = db.employees.filter(e => e.dept === dept.id && e.status === "active");
                    const netDept = emps.reduce((s, e) => s + calcPayroll(e).net, 0);
                    const pct = totalNet > 0 ? ((netDept / totalNet) * 100).toFixed(0) : 0;
                    return (React.createElement("div", { key: dept.id, style: { marginBottom: 12 } },
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 4 } },
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid } }, dept.name),
                            React.createElement("div", { style: { display: "flex", gap: 10 } },
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, color: DS.textDim } },
                                    pct,
                                    "%"),
                                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: dept.color } },
                                    "$",
                                    Math.round(netDept).toLocaleString()))),
                        React.createElement("div", { style: { height: 4, background: DS.bgAlt } },
                            React.createElement("div", { style: { height: "100%", width: `${pct}%`, background: dept.color, boxShadow: `0 0 6px ${dept.color}55` } }))));
                }))),
        React.createElement(Panel, null,
            React.createElement(SectionHeader, { icon: CalendarDays, label: "Asistencia Semanal por D\u00EDa" }),
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(5,1fr)", gap: 10 } }, [
                { d: "LUN", p: 58, a: 4, t: 3 }, { d: "MAR", p: 61, a: 2, t: 2 }, { d: "MIÉ", p: 55, a: 7, t: 3 },
                { d: "JUE", p: 60, a: 3, t: 2 }, { d: "VIE", p: 52, a: 8, t: 5 },
            ].map(day => {
                const total = day.p + day.a + day.t;
                return (React.createElement("div", { key: day.d, style: { background: DS.bgAlt, border: `1px solid ${DS.border}`, padding: "14px 12px" } },
                    React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 800, color: DS.text, letterSpacing: "0.1em", marginBottom: 10 } }, day.d),
                    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 4 } }, [{ l: "PRES.", v: day.p, c: DS.glowGreen }, { l: "AUS.", v: day.a, c: DS.glowRed }, { l: "TARD.", v: day.t, c: DS.glowAmber }].map(s => (React.createElement("div", { key: s.l },
                        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 2 } },
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, s.l),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, fontWeight: 700, color: s.c } }, s.v)),
                        React.createElement("div", { style: { height: 2, background: DS.bg } },
                            React.createElement("div", { style: { height: "100%", width: `${(s.v / total) * 100}%`, background: s.c } }))))))));
            }))),
        React.createElement(Panel, { style: { marginTop: 16 }, glowColor: DS.glowAmber },
            React.createElement(SectionHeader, { icon: CreditCard, label: "An\u00E1lisis Fiscal Global" }),
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 14 } }, [
                { l: "Total Bruto", v: `$${Math.round(totalGross).toLocaleString()}`, c: DS.text, i: Briefcase },
                { l: "Total Impuestos", v: `-$${Math.round(totalGross - totalNet).toLocaleString()}`, c: DS.glowRed, i: Shield },
                { l: "Total Neto", v: `$${Math.round(totalNet).toLocaleString()}`, c: DS.glowGreen, i: CreditCard },
            ].map(k => (React.createElement("div", { key: k.l, style: { padding: "16px", background: DS.bgAlt, border: `1px solid ${DS.border}`, display: "flex", gap: 12, alignItems: "center" } },
                React.createElement(k.i, { size: 22, color: k.c }),
                React.createElement("div", null,
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, letterSpacing: "0.1em" } }, k.l),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 18, fontWeight: 900, color: k.c, marginTop: 4 } }, k.v)))))))));
};
// ═══════════════════════════════════════════════
//  SIDEBAR NAV
// ═══════════════════════════════════════════════
// ═══════════════════════════════════════════════
//  VIEW DEPARTMENTS — CATÁLOGO COMPLETO
// ═══════════════════════════════════════════════
const COLOR_OPTIONS = [
    { label: "Cyan", value: "#00d4ff" },
    { label: "Verde", value: "#00ff88" },
    { label: "Ámbar", value: "#ffaa00" },
    { label: "Rojo", value: "#ff3366" },
    { label: "Morado", value: "#a855f7" },
    { label: "Rosa", value: "#f472b6" },
    { label: "Naranja", value: "#f97316" },
    { label: "Lima", value: "#84cc16" },
];
const DeptModalOverlay = ({ onClose, children }) => (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.9)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000, backdropFilter: "blur(8px)" }, onClick: onClose },
    React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.borderHi}`, borderRadius: 2, width: 560, maxHeight: "90vh", overflowY: "auto", padding: 28, position: "relative", boxShadow: `0 0 40px ${DS.glow}18` }, onClick: e => e.stopPropagation() },
        React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "tr", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "bl", color: DS.glow, size: 12 }),
        React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 12 }),
        children)));
const ViewDepartments = ({ db, upsertDepartment, deleteDepartment }) => {
    const [modal, setModal] = useState(false);
    const [editMode, setEditMode] = useState(false);
    const [form, setForm] = useState({});
    const [confirm, setConfirm] = useState(null);
    const [saved, setSaved] = useState(false);
    const [error, setError] = useState("");
    const openNew = () => {
        setError("");
        setForm({ name: "", color: "#00d4ff", budget: "", head_id: "" });
        setEditMode(false);
        setModal(true);
    };
    const openEdit = (dept) => {
        setError("");
        setForm(Object.assign(Object.assign({}, dept), { budget: String(dept.budget || "") }));
        setEditMode(true);
        setModal(true);
    };
    const handleSave = () => {
        if (!form.name.trim()) {
            setError("El nombre del departamento es requerido.");
            return;
        }
        setError("");
        const record = Object.assign(Object.assign(Object.assign({}, form), { budget: Number(form.budget) || 0 }), (editMode && form.id ? { id: form.id } : {}));
        upsertDepartment(record);
        setSaved(true);
        setTimeout(() => setSaved(false), 2500);
        setModal(false);
    };
    const handleDelete = (id) => {
        deleteDepartment(id);
        setConfirm(null);
    };
    const headOpts = [{ v: "", l: "— Sin jefe asignado —" }, ...((db === null || db === void 0 ? void 0 : db.employees) || []).filter(e => e.status === "active").map(e => ({ v: e.id, l: e.name }))];
    return (React.createElement("div", null,
        React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 20 } },
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                React.createElement("div", { style: { width: 2, height: 18, background: DS.glow, boxShadow: glow(DS.glow, 4) } }),
                React.createElement(Building2, { size: 15, color: DS.glow }),
                React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 16, fontWeight: 700, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, "Cat\u00E1logo de Departamentos"),
                React.createElement(Chip, { color: DS.textDim },
                    ((db === null || db === void 0 ? void 0 : db.departments) || []).length,
                    " DEPTOS.")),
            React.createElement("button", { onClick: openNew, style: { display: "inline-flex", alignItems: "center", gap: 8, padding: "9px 18px", borderRadius: 1, cursor: "pointer", fontSize: 12, fontFamily: DS.mono, fontWeight: 700, letterSpacing: "0.06em", border: `1px solid ${DS.glow}66`, background: `${DS.glow}18`, color: DS.glow, boxShadow: `0 0 12px ${DS.glow}18` } },
                React.createElement(Plus, { size: 14 }),
                " NUEVO DEPARTAMENTO")),
        saved && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 16px", background: `${DS.glowGreen}10`, border: `1px solid ${DS.glowGreen}44`, display: "flex", gap: 8, alignItems: "center" } },
            React.createElement(CheckCircle, { size: 13, color: DS.glowGreen }),
            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowGreen } }, "DEPARTAMENTO GUARDADO CORRECTAMENTE"))),
        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 14, marginBottom: 20 } },
            React.createElement(KpiCard, { icon: Building2, label: "Total Deptos.", value: ((db === null || db === void 0 ? void 0 : db.departments) || []).length, color: DS.glow }),
            React.createElement(KpiCard, { icon: Users, label: "Empleados Activos", value: ((db === null || db === void 0 ? void 0 : db.employees) || []).filter(e => e.status === "active").length, color: DS.glowGreen }),
            React.createElement(KpiCard, { icon: DollarSign, label: "Presupuesto Total", value: `$${Math.round(((db === null || db === void 0 ? void 0 : db.departments) || []).reduce((s, d) => s + (d.budget || 0), 0) / 1000)}k`, color: DS.glowAmber }),
            React.createElement(KpiCard, { icon: Briefcase, label: "Deptos. con Jefe", value: ((db === null || db === void 0 ? void 0 : db.departments) || []).filter(d => d.head_id || d.head).length, color: DS.glowPurple })),
        ((db === null || db === void 0 ? void 0 : db.departments) || []).length === 0 ? (React.createElement("div", { style: { padding: "48px", textAlign: "center", border: `1px dashed ${DS.border}`, background: DS.surface } },
            React.createElement(Building2, { size: 36, color: DS.textDim, style: { margin: "0 auto 14px" } }),
            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textDim, marginBottom: 16 } }, "SIN DEPARTAMENTOS REGISTRADOS"),
            React.createElement("button", { onClick: openNew, style: { padding: "9px 22px", background: `${DS.glow}18`, border: `1px solid ${DS.glow}44`, color: DS.glow, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer", borderRadius: 1 } }, "+ CREAR PRIMER DEPARTAMENTO"))) : (React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(320px, 1fr))", gap: 14 } }, (db.departments).map(dept => {
            var _a, _b;
            const color = dept.color || DS.glow;
            const members = (db.employees || []).filter(e => (e.dept_id || e.dept) === dept.id && e.status === "active");
            const headEmp = dept.head_id ? db.employees.find(e => e.id === dept.head_id) : dept.head ? db.employees.find(e => e.id === dept.head) : null;
            const netCost = members.reduce((s, e) => s + calcPayroll(e).net, 0);
            const budgetPct = dept.budget > 0 ? Math.min(100, Math.round((netCost / dept.budget) * 100)) : 0;
            return (React.createElement("div", { key: dept.id, style: { background: DS.surface, border: `1px solid ${DS.border}`, borderTop: `3px solid ${color}`, position: "relative", padding: "20px 22px", boxShadow: `inset 0 0 20px ${color}06, 0 4px 20px rgba(0,0,0,.35)` } },
                React.createElement(HudCorner, { pos: "tl", color: color, size: 8 }),
                React.createElement(HudCorner, { pos: "br", color: color, size: 8 }),
                React.createElement("div", { style: { display: "flex", alignItems: "flex-start", justifyContent: "space-between", marginBottom: 14 } },
                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12 } },
                        React.createElement("div", { style: { width: 40, height: 40, borderRadius: 1, background: `${color}18`, border: `1px solid ${color}55`, display: "flex", alignItems: "center", justifyContent: "center", boxShadow: `0 0 14px ${color}22` } },
                            React.createElement("div", { style: { width: 16, height: 16, borderRadius: "50%", background: color, boxShadow: `0 0 8px ${color}` } })),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 17, fontWeight: 800, color: DS.text, letterSpacing: "0.08em", textTransform: "uppercase" } }, dept.name),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginTop: 1 } },
                                "ID: ",
                                ((_b = (_a = dept.id) === null || _a === void 0 ? void 0 : _a.slice) === null || _b === void 0 ? void 0 : _b.call(_a, 0, 8)) || dept.id))),
                    React.createElement("div", { style: { display: "flex", gap: 6 } },
                        React.createElement("button", { onClick: () => openEdit(dept), style: { display: "inline-flex", alignItems: "center", gap: 4, padding: "4px 10px", border: `1px solid ${DS.glow}44`, background: `${DS.glow}10`, color: DS.glow, fontFamily: DS.mono, fontSize: 9, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                            React.createElement(Edit, { size: 9 }),
                            " EDITAR"),
                        React.createElement("button", { onClick: () => setConfirm(dept), style: { display: "inline-flex", alignItems: "center", gap: 4, padding: "4px 10px", border: `1px solid ${DS.glowRed}44`, background: `${DS.glowRed}08`, color: DS.glowRed, fontFamily: DS.mono, fontSize: 9, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                            React.createElement(Trash2, { size: 9 })))),
                React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 14 } },
                    React.createElement("div", { style: { padding: "10px 12px", background: DS.bgAlt, border: `1px solid ${DS.border}` } },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.1em" } }, "MIEMBROS ACTIVOS"),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 22, fontWeight: 900, color, marginTop: 4, lineHeight: 1 } }, members.length),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginTop: 2 } }, "empleados")),
                    React.createElement("div", { style: { padding: "10px 12px", background: DS.bgAlt, border: `1px solid ${DS.border}` } },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.1em" } }, "PRESUPUESTO"),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 16, fontWeight: 900, color: DS.glowAmber, marginTop: 4, lineHeight: 1 } },
                            "$",
                            (dept.budget || 0).toLocaleString()),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginTop: 2 } }, "MXN/per\u00EDodo"))),
                dept.budget > 0 && (React.createElement("div", { style: { marginBottom: 14 } },
                    React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 4 } },
                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "COSTO N\u00D3MINA vs PRESUPUESTO"),
                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, fontWeight: 700, color: budgetPct > 90 ? DS.glowRed : budgetPct > 70 ? DS.glowAmber : DS.glowGreen } },
                            budgetPct,
                            "%")),
                    React.createElement("div", { style: { height: 4, background: DS.bg, borderRadius: 0 } },
                        React.createElement("div", { style: { height: "100%", width: `${budgetPct}%`, background: budgetPct > 90 ? DS.glowRed : budgetPct > 70 ? DS.glowAmber : DS.glowGreen, boxShadow: `0 0 6px ${budgetPct > 90 ? DS.glowRed : DS.glowGreen}66`, transition: "width 1s" } })),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim, marginTop: 3 } },
                        "Costo neto: $",
                        Math.round(netCost).toLocaleString(),
                        " de $",
                        (dept.budget || 0).toLocaleString()))),
                React.createElement("div", { style: { borderTop: `1px solid ${DS.border}`, paddingTop: 12 } },
                    headEmp && (React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, marginBottom: 10 } },
                        React.createElement(Shield, { size: 10, color: color }),
                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "JEFE:"),
                        React.createElement(Avatar, { initials: headEmp.avatar || "??", color: color, size: 20 }),
                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 10, fontWeight: 700, color: DS.text } }, headEmp.name))),
                    members.length > 0 && (React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, flexWrap: "wrap" } },
                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "EQUIPO:"),
                        members.slice(0, 6).map(e => (React.createElement("div", { key: e.id, title: e.name },
                            React.createElement(Avatar, { initials: e.avatar || "??", color: color, size: 24 })))),
                        members.length > 6 && (React.createElement("div", { style: { width: 24, height: 24, borderRadius: 1, background: `${color}18`, border: `1px solid ${color}44`, display: "flex", alignItems: "center", justifyContent: "center", fontFamily: DS.mono, fontSize: 9, color, fontWeight: 700 } },
                            "+",
                            members.length - 6)))),
                    !headEmp && members.length === 0 && (React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "SIN MIEMBROS ASIGNADOS")))));
        }))),
        modal && (React.createElement(DeptModalOverlay, { onClose: () => setModal(false) },
            React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 } },
                React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                    React.createElement("div", { style: { width: 2, height: 16, background: DS.glow, boxShadow: glow(DS.glow) } }),
                    React.createElement(Building2, { size: 14, color: DS.glow }),
                    React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.text, letterSpacing: "0.12em", textTransform: "uppercase" } }, editMode ? "EDITAR DEPARTAMENTO" : "NUEVO DEPARTAMENTO")),
                React.createElement("button", { onClick: () => setModal(false), style: { background: "none", border: "none", color: DS.textDim, cursor: "pointer", display: "flex" } },
                    React.createElement(X, { size: 16 }))),
            error && (React.createElement("div", { style: { marginBottom: 14, padding: "10px 14px", background: `${DS.glowRed}10`, border: `1px solid ${DS.glowRed}44`, display: "flex", gap: 8, alignItems: "center" } },
                React.createElement(AlertCircle, { size: 12, color: DS.glowRed }),
                React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.glowRed } }, error))),
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 } },
                React.createElement("div", { style: { gridColumn: "1/-1" } },
                    React.createElement(Input, { label: "Nombre del Departamento *", value: form.name || "", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { name: v }))), placeholder: "Ej: Tecnolog\u00EDa, Recursos Humanos...", required: true })),
                React.createElement("div", { style: { gridColumn: "1/-1" } },
                    React.createElement("label", { style: { fontSize: 9, color: DS.textDim, fontFamily: DS.mono, letterSpacing: "0.1em", textTransform: "uppercase", display: "block", marginBottom: 8 } }, "COLOR IDENTIFICADOR"),
                    React.createElement("div", { style: { display: "flex", gap: 10, flexWrap: "wrap" } },
                        COLOR_OPTIONS.map(c => (React.createElement("button", { key: c.value, onClick: () => setForm(p => (Object.assign(Object.assign({}, p), { color: c.value }))), title: c.label, style: {
                                width: 36, height: 36, borderRadius: 1, cursor: "pointer",
                                background: `${c.value}22`,
                                border: form.color === c.value ? `2px solid ${c.value}` : `1px solid ${c.value}44`,
                                display: "flex", alignItems: "center", justifyContent: "center",
                                boxShadow: form.color === c.value ? `0 0 12px ${c.value}88` : "none",
                                transition: "all .15s",
                            } },
                            React.createElement("div", { style: { width: 16, height: 16, borderRadius: "50%", background: c.value, boxShadow: `0 0 6px ${c.value}` } })))),
                        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, padding: "0 10px", border: `1px solid ${DS.border}`, background: DS.bg } },
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 9, color: DS.textDim } }, "HEX"),
                            React.createElement("input", { type: "color", value: form.color || "#00d4ff", onChange: e => setForm(p => (Object.assign(Object.assign({}, p), { color: e.target.value }))), style: { width: 28, height: 28, border: "none", background: "none", cursor: "pointer", padding: 0 } }))),
                    React.createElement("div", { style: { marginTop: 10, padding: "8px 14px", background: `${form.color || DS.glow}10`, border: `1px solid ${form.color || DS.glow}44`, display: "flex", alignItems: "center", gap: 10 } },
                        React.createElement("div", { style: { width: 10, height: 10, borderRadius: "50%", background: form.color || DS.glow, boxShadow: `0 0 8px ${form.color || DS.glow}` } }),
                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 11, fontWeight: 700, color: form.color || DS.glow } }, form.name || "NOMBRE DEL DEPARTAMENTO"))),
                React.createElement(Input, { label: "Presupuesto de N\u00F3mina (MXN/per\u00EDodo)", type: "number", value: form.budget || "", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { budget: v }))), placeholder: "Ej: 150000" }),
                React.createElement(Input, { label: "Jefe de Departamento", type: "select", value: form.head_id || form.head || "", onChange: v => setForm(p => (Object.assign(Object.assign({}, p), { head_id: v, head: v }))), options: headOpts })),
            React.createElement("div", { style: { marginTop: 20, display: "flex", gap: 10, justifyContent: "flex-end" } },
                React.createElement("button", { onClick: () => setModal(false), style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "9px 18px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                    React.createElement(X, { size: 13 }),
                    " CANCELAR"),
                React.createElement("button", { onClick: handleSave, style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "9px 18px", border: `1px solid ${DS.glowGreen}66`, background: `${DS.glowGreen}18`, color: DS.glowGreen, fontFamily: DS.mono, fontSize: 12, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                    React.createElement(CheckCircle, { size: 13 }),
                    " ",
                    editMode ? "ACTUALIZAR" : "CREAR DEPARTAMENTO")))),
        confirm && (React.createElement("div", { style: { position: "fixed", inset: 0, background: "rgba(3,7,18,.88)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1001, backdropFilter: "blur(8px)" }, onClick: () => setConfirm(null) },
            React.createElement("div", { style: { background: DS.bgAlt, border: `1px solid ${DS.glowRed}55`, padding: 28, width: 420, position: "relative" }, onClick: e => e.stopPropagation() },
                React.createElement(HudCorner, { pos: "tl", color: DS.glowRed, size: 10 }),
                React.createElement(HudCorner, { pos: "br", color: DS.glowRed, size: 10 }),
                React.createElement("div", { style: { display: "flex", gap: 10, alignItems: "center", marginBottom: 12 } },
                    React.createElement(AlertTriangle, { size: 16, color: DS.glowRed }),
                    React.createElement("span", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.glowRed, letterSpacing: "0.1em" } }, "ELIMINAR DEPARTAMENTO")),
                React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 11, color: DS.textMid, lineHeight: 1.8, marginBottom: 20 } },
                    "\u00BFEliminar el departamento ",
                    React.createElement("span", { style: { color: confirm.color || DS.glowRed, fontWeight: 700 } }, confirm.name),
                    "?",
                    React.createElement("br", null),
                    "Los empleados asignados quedar\u00E1n sin departamento."),
                React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "flex-end" } },
                    React.createElement("button", { onClick: () => setConfirm(null), style: { padding: "8px 18px", border: `1px solid ${DS.textDim}44`, background: "transparent", color: DS.textDim, fontFamily: DS.mono, fontSize: 11, cursor: "pointer", borderRadius: 1 } }, "CANCELAR"),
                    React.createElement("button", { onClick: () => handleDelete(confirm.id), style: { display: "inline-flex", alignItems: "center", gap: 6, padding: "8px 18px", border: `1px solid ${DS.glowRed}66`, background: `${DS.glowRed}18`, color: DS.glowRed, fontFamily: DS.mono, fontSize: 11, fontWeight: 700, cursor: "pointer", borderRadius: 1 } },
                        React.createElement(Trash2, { size: 11 }),
                        " ELIMINAR")))))));
};
const NAV = [
    { id: "dashboard", icon: LayoutDashboard, label: "DASHBOARD" },
    { id: "departments", icon: Building2, label: "DEPARTAMENTOS" },
    { id: "employees", icon: Users, label: "EMPLEADOS" },
    { id: "time", icon: Clock, label: "CONTROL TIEMPO" },
    { id: "locations", icon: MapPin, label: "GEOCERCAS" },
    { id: "payroll", icon: DollarSign, label: "NÓMINA" },
    { id: "reports", icon: BarChart3, label: "REPORTES BI" },
];
// ═══════════════════════════════════════════════
//  ROOT APP
// ═══════════════════════════════════════════════
function App() {
    var _a, _b, _c, _d, _e, _f;
    const [view, setView] = useState("dashboard");
    const { db, loading, upsertEmployee, deleteEmployee, upsertLocation, deleteLocation, upsertDepartment, deleteDepartment, addTimeRecord, updateTimeRecord, savePayrollCut, resetDB } = useDB();
    const { session, loginAdmin, loginEmployee, logout } = useAuth();
    // Shared styles/animations wrapper (always rendered)
    const Shell = ({ children }) => (React.createElement("div", { style: { background: DS.bg, minHeight: "100vh", fontFamily: DS.sans, color: DS.text } },
        React.createElement("style", null, `
        * { box-sizing:border-box; margin:0; padding:0; }
        ::-webkit-scrollbar { width:4px; height:4px; }
        ::-webkit-scrollbar-track { background:${DS.bg}; }
        ::-webkit-scrollbar-thumb { background:${DS.border}; }
        input, select, textarea { font-family:${DS.mono} !important; color-scheme:dark; }
        @keyframes spin { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
        @keyframes ping { 0%,100%{transform:scale(1);opacity:.7} 50%{transform:scale(1.6);opacity:0} }
        @keyframes scanline { 0%{transform:translateY(-100%)} 100%{transform:translateY(100vh)} }
        body { background:${DS.bg}; }
      `),
        children));
    if (loading)
        return (React.createElement(Shell, null,
            React.createElement("div", { style: { minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center" } },
                React.createElement("div", { style: { textAlign: "center" } },
                    React.createElement(Loader2, { size: 32, color: DS.glow, style: { animation: "spin 1s linear infinite", marginBottom: 16 } }),
                    React.createElement("div", { style: { color: DS.textDim, fontSize: 11, letterSpacing: "0.2em", fontFamily: DS.mono } }, "INICIALIZANDO...")))));
    // Not logged in → Login screen
    if (!session)
        return (React.createElement(Shell, null,
            React.createElement(LoginScreen, { db: db, onLoginAdmin: loginAdmin, onLoginEmployee: loginEmployee })));
    // Employee session → Employee Portal only
    if (session.type === "employee")
        return (React.createElement(Shell, null,
            React.createElement(EmployeePortal, { db: db, session: session, addTimeRecord: addTimeRecord, updateTimeRecord: updateTimeRecord, onLogout: logout })));
    // Admin session → Full system
    return (React.createElement(Shell, null,
        React.createElement("div", { style: { background: DS.bg, minHeight: "100vh", display: "flex", fontFamily: DS.sans, color: DS.text, position: "relative" } },
            React.createElement("div", { style: { position: "fixed", inset: 0, pointerEvents: "none", zIndex: 9999, overflow: "hidden" } },
                React.createElement("div", { style: { position: "absolute", left: 0, right: 0, height: 2, background: `linear-gradient(transparent,${DS.glow}08,transparent)`, animation: "scanline 6s linear infinite" } })),
            React.createElement("div", { style: { position: "fixed", inset: 0, pointerEvents: "none", zIndex: 0, backgroundImage: `linear-gradient(${DS.border}18 1px,transparent 1px),linear-gradient(90deg,${DS.border}18 1px,transparent 1px)`, backgroundSize: "40px 40px" } }),
            React.createElement("div", { style: { width: 220, background: DS.bgAlt, borderRight: `1px solid ${DS.border}`, display: "flex", flexDirection: "column", position: "sticky", top: 0, height: "100vh", zIndex: 10, flexShrink: 0 } },
                React.createElement("div", { style: { padding: "20px 18px 16px", borderBottom: `1px solid ${DS.border}` } },
                    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } },
                        React.createElement("div", { style: { width: 32, height: 32, border: `1px solid ${DS.glow}88`, display: "flex", alignItems: "center", justifyContent: "center", boxShadow: glow(DS.glow, 6), position: "relative" } },
                            React.createElement(HudCorner, { pos: "tl", color: DS.glow, size: 6 }),
                            React.createElement(HudCorner, { pos: "br", color: DS.glow, size: 6 }),
                            React.createElement(Cpu, { size: 16, color: DS.glow })),
                        React.createElement("div", null,
                            React.createElement("div", { style: { fontFamily: DS.sans, fontSize: 14, fontWeight: 800, color: DS.text, letterSpacing: "0.15em" } }, "TIMECLOCK"),
                            React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim, letterSpacing: "0.1em" } }, "v2.0 // ENTERPRISE"))),
                    React.createElement("div", { style: { marginTop: 10, display: "flex", alignItems: "center", gap: 6 } },
                        React.createElement(StatusDot, { status: "active" }),
                        React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.glowGreen, letterSpacing: "0.08em" } }, "SISTEMA OPERATIVO"))),
                React.createElement("nav", { style: { flex: 1, padding: "12px 10px", display: "flex", flexDirection: "column", gap: 2 } }, NAV.map(n => {
                    const active = view === n.id;
                    return (React.createElement("button", { key: n.id, onClick: () => setView(n.id), style: {
                            width: "100%", display: "flex", alignItems: "center", gap: 10,
                            padding: "9px 10px", border: "none", cursor: "pointer", borderRadius: 1,
                            background: active ? `${DS.glow}14` : "transparent",
                            color: active ? DS.glow : DS.textDim,
                            fontFamily: DS.mono, fontSize: 10, fontWeight: active ? 700 : 400, letterSpacing: "0.08em",
                            textAlign: "left", transition: "all .15s",
                            borderLeft: active ? `2px solid ${DS.glow}` : `2px solid transparent`,
                        } },
                        React.createElement(n.icon, { size: 13 }),
                        n.label));
                })),
                React.createElement("div", { style: { padding: "10px 14px", borderTop: `1px solid ${DS.border}` } },
                    React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 8 } },
                        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } },
                            React.createElement(Database, { size: 10, color: DS.glowGreen }),
                            React.createElement("span", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.glowGreen, letterSpacing: "0.1em" } }, "DB CONECTADA")),
                        React.createElement("button", { onClick: resetDB, title: "Reset DB", style: { background: "none", border: "none", cursor: "pointer", color: DS.textDim, display: "flex" } },
                            React.createElement(RefreshCw, { size: 10 }))),
                    React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } },
                        ((_a = db === null || db === void 0 ? void 0 : db.employees) === null || _a === void 0 ? void 0 : _a.length) || 0,
                        " EMP \u00B7 ",
                        ((_b = db === null || db === void 0 ? void 0 : db.timeRecords) === null || _b === void 0 ? void 0 : _b.length) || 0,
                        " REG \u00B7 ",
                        ((_c = db === null || db === void 0 ? void 0 : db.payrollCuts) === null || _c === void 0 ? void 0 : _c.length) || 0,
                        " CORTES")),
                React.createElement("div", { style: { padding: "12px 14px", borderTop: `1px solid ${DS.border}`, display: "flex", alignItems: "center", gap: 10 } },
                    React.createElement("div", { style: { width: 30, height: 30, border: `1px solid ${DS.glowPurple}55`, display: "flex", alignItems: "center", justifyContent: "center" } },
                        React.createElement(Lock, { size: 12, color: DS.glowPurple })),
                    React.createElement("div", { style: { flex: 1, minWidth: 0 } },
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 10, fontWeight: 700, color: DS.text, textTransform: "uppercase", overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" } }, ((_d = session.user) === null || _d === void 0 ? void 0 : _d.name) || "ADMIN"),
                        React.createElement("div", { style: { fontFamily: DS.mono, fontSize: 8, color: DS.textDim } }, ((_f = (_e = session.user) === null || _e === void 0 ? void 0 : _e.role) === null || _f === void 0 ? void 0 : _f.toUpperCase()) || "SUPERUSUARIO")),
                    React.createElement("button", { onClick: logout, title: "Cerrar sesi\u00F3n", style: { background: "none", border: `1px solid ${DS.glowRed}33`, cursor: "pointer", color: DS.glowRed, display: "flex", padding: 4 } },
                        React.createElement(LogOut, { size: 11 })))),
            React.createElement("main", { style: { flex: 1, overflowY: "auto", padding: "28px 32px", position: "relative", zIndex: 1 } },
                view === "dashboard" && React.createElement(ViewDashboard, { db: db }),
                view === "departments" && React.createElement(ViewDepartments, { db: db, upsertDepartment: upsertDepartment, deleteDepartment: deleteDepartment }),
                view === "employees" && React.createElement(ViewEmployees, { db: db, upsertEmployee: upsertEmployee, deleteEmployee: deleteEmployee }),
                view === "time" && React.createElement(ViewTime, { db: db, addTimeRecord: addTimeRecord, updateTimeRecord: updateTimeRecord }),
                view === "locations" && React.createElement(ViewLocations, { db: db, upsertLocation: upsertLocation, deleteLocation: deleteLocation }),
                view === "payroll" && React.createElement(ViewPayroll, { db: db, savePayrollCut: savePayrollCut }),
                view === "reports" && React.createElement(ViewBI, { db: db })))));
}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>